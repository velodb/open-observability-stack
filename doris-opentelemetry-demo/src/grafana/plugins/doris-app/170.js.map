{"version":3,"file":"170.js?_cache=fe40abf35a66617f42f7","mappings":"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","sources":["webpack://doris-app/./components/AppConfig/AppConfig.tsx","webpack://doris-app/./constants.ts","webpack://doris-app/./components/testIds.ts"],"sourcesContent":["import React, { ChangeEvent, useState, useEffect } from 'react';\nimport { lastValueFrom } from 'rxjs';\nimport { css } from '@emotion/css';\nimport { AppPluginMeta, GrafanaTheme2, PluginConfigPageProps, PluginMeta, toDataFrame } from '@grafana/data';\nimport { getBackendSrv, DataSourcePicker } from '@grafana/runtime';\nimport { Button, Field, FieldSet, Input, SecretInput, useStyles2, Select } from '@grafana/ui';\nimport { useAtom } from 'jotai';\nimport { Subscription } from 'rxjs';\nimport { getDatabases, getTablesService } from 'services/metaservice';\nimport { testIds } from '../testIds';\nimport { settingDatabasesAtom, settingTablesAtom } from 'store/discover';\n\ntype LogsConfig = {\n  datasource?: any;\n  database?: string;\n  logsTable?: string;\n  targetTraceTable?: string;\n}\n\nexport type AppPluginSettings = {\n  apiUrl?: string;\n  logsConfig?: LogsConfig\n};\n\ntype State = {\n  // The URL to reach our custom API.\n  apiUrl: string;\n  // Tells us if the API key secret is set.\n  isApiKeySet: boolean;\n  // A secret key for our custom API.\n  apiKey: string;\n};\n\nexport interface AppConfigProps extends PluginConfigPageProps<AppPluginMeta<AppPluginSettings>> { }\n\nconst AppConfig = ({ plugin }: AppConfigProps) => {\n  const s = useStyles2(getStyles);\n  const { enabled, pinned, jsonData, secureJsonFields } = plugin.meta;\n  const [state, setState] = useState<State>({\n    apiUrl: jsonData?.apiUrl || '',\n    apiKey: '',\n    isApiKeySet: Boolean(secureJsonFields?.apiKey),\n  });\n  const logsConfig = jsonData?.logsConfig || {};\n\n  const [currentLogsConfig, setCurrentLogsConfig] = useState<LogsConfig>(logsConfig);\n  const [databases, setDatabases] = useAtom(settingDatabasesAtom);\n  const [tables, setTables] = useAtom(settingTablesAtom);\n\n  const isSubmitDisabled = Boolean(!state.apiUrl || (!state.isApiKeySet && !state.apiKey));\n\n  const fetchDatabases = React.useCallback((ds: any) => {\n    if (!ds) {\n      return undefined;\n    }\n\n    return getDatabases(ds).subscribe({\n      next: (resp: any) => {\n        const { data, ok } = resp;\n        if (ok) {\n          const frame = toDataFrame(data.results.getDatabases.frames[0]);\n          const values = Array.from(frame.fields[0].values);\n          const options = values.map((item: string) => ({ label: item, value: item }));\n          setDatabases(options);\n        }\n      },\n      error: (err: any) => console.log('Fetch Error', err),\n    });\n  }, [setDatabases]);\n\n  const fetchTables = React.useCallback((db: string) => {\n    if (!db) {\n      return undefined;\n    }\n    return getTablesService({\n      selectdbDS: currentLogsConfig.datasource,\n      database: db,\n    }).subscribe({\n      next: (resp: any) => {\n        const { data, ok } = resp;\n        if (ok) {\n          const frame = toDataFrame(data.results.getTables.frames[0]);\n          const values = Array.from(frame.fields[0].values);\n          const options = values.map((item: string) => ({ label: item, value: item }));\n          setTables(options);\n        }\n      },\n      error: (err: any) => console.log('Fetch Error', err),\n    });\n  }, [setTables,currentLogsConfig.datasource])\n\n  const onResetApiKey = () =>\n    setState({\n      ...state,\n      apiKey: '',\n      isApiKeySet: false,\n    });\n\n  const onChange = (event: ChangeEvent<HTMLInputElement>) => {\n    setState({\n      ...state,\n      [event.target.name]: event.target.value.trim(),\n    });\n  };\n\n  const onSubmit = () => {\n    if (isSubmitDisabled) {\n      return;\n    }\n\n    updatePluginAndReload(plugin.meta.id, {\n      enabled,\n      pinned,\n      jsonData: {\n        apiUrl: state.apiUrl,\n      },\n      // This cannot be queried later by the frontend.\n      // We don't want to override it in case it was set previously and left untouched now.\n      secureJsonData: state.isApiKeySet\n        ? undefined\n        : {\n          apiKey: state.apiKey,\n        },\n    });\n  };\n\n  const submitLogConfig = () => {\n    updatePluginAndReload(plugin.meta.id, {\n      enabled,\n      pinned,\n      jsonData: {\n        apiUrl: state.apiUrl,\n        logsConfig: { ...currentLogsConfig }\n      },\n      // This cannot be queried later by the frontend.\n      // We don't want to override it in case it was set previously and left untouched now.\n      secureJsonData: state.isApiKeySet\n        ? undefined\n        : {\n          apiKey: state.apiKey,\n        }\n    });\n  }\n\n  useEffect(() => {\n    if (!currentLogsConfig.datasource) {\n      return;\n    }\n\n    const subscription: Subscription | undefined = fetchDatabases(currentLogsConfig.datasource);\n\n    return () => subscription?.unsubscribe();\n  }, [currentLogsConfig.datasource, fetchDatabases]);\n\n  useEffect(() => {\n    if (!currentLogsConfig.database) {\n      return;\n    }\n    const subscription: Subscription | undefined = fetchTables(currentLogsConfig.database);\n\n    return () => subscription?.unsubscribe(); \n  }, [currentLogsConfig.database, fetchTables])\n\n  return (\n    <>\n      <form onSubmit={onSubmit}>\n        <FieldSet label=\"API Settings\">\n          <Field label=\"API Key\" description=\"A secret key for authenticating to our custom API\">\n            <SecretInput\n              width={60}\n              id=\"config-api-key\"\n              data-testid={testIds.appConfig.apiKey}\n              name=\"apiKey\"\n              value={state.apiKey}\n              isConfigured={state.isApiKeySet}\n              placeholder={'Your secret API key'}\n              onChange={onChange}\n              onReset={onResetApiKey}\n            />\n          </Field>\n\n          <Field label=\"API Url\" description=\"\" className={s.marginTop}>\n            <Input\n              width={60}\n              name=\"apiUrl\"\n              id=\"config-api-url\"\n              data-testid={testIds.appConfig.apiUrl}\n              value={state.apiUrl}\n              placeholder={`E.g.: http://mywebsite.com/api/v1`}\n              onChange={onChange}\n            />\n          </Field>\n\n          <div className={s.marginTop}>\n            <Button type=\"submit\" data-testid={testIds.appConfig.submit} disabled={isSubmitDisabled}>\n              Save API settings\n            </Button>\n          </div>\n        </FieldSet>\n      </form>\n      <form className={s.marginTop} onSubmit={submitLogConfig}>\n        <FieldSet label=\"Logs\">\n          <Field label=\"Datasource\">\n            <DataSourcePicker\n              width={20}\n              type={'mysql'}\n              current={currentLogsConfig.datasource}\n              placeholder=\"Choose\"\n              noDefault\n              filter={ds => ds.type === 'mysql'}\n              onChange={item => {\n                setCurrentLogsConfig({ ...currentLogsConfig, datasource: item });\n                // Always fetch databases even if the same datasource is selected\n                fetchDatabases(item);\n              }}\n            />\n          </Field>\n          <Field label=\"Database\">\n            <Select\n              width={60}\n              options={databases}\n              value={currentLogsConfig.database}\n              onChange={(selectedDatabase: any) => {\n                setCurrentLogsConfig({ ...currentLogsConfig, database: selectedDatabase.value })\n                fetchTables(selectedDatabase.value)\n              }}\n            ></Select>\n          </Field>\n          <Field label=\"Logs Table\">\n            <Select\n              options={tables}\n              width={60}\n              value={currentLogsConfig.logsTable}\n              onChange={(selectedTable: any) => {\n                setCurrentLogsConfig({\n                  ...currentLogsConfig,\n                  logsTable: selectedTable.value\n                })\n              }}\n            />\n          </Field>\n          <Field label=\"Trace Table\">\n            <Select\n              options={tables}\n              width={60}\n              value={currentLogsConfig.targetTraceTable}\n              onChange={(selectedTable: any) => {\n                setCurrentLogsConfig({\n                  ...currentLogsConfig,\n                  targetTraceTable: selectedTable.value\n                })\n              }}\n            />\n          </Field>\n          <div className={s.marginTop}>\n            <Button type='submit'>\n              Save Logs settings\n            </Button>\n          </div>\n        </FieldSet>\n      </form>\n    </>\n\n  );\n};\n\nexport default AppConfig;\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  colorWeak: css`\n    color: ${theme.colors.text.secondary};\n  `,\n  marginTop: css`\n    margin-top: ${theme.spacing(3)};\n  `,\n});\n\nconst updatePluginAndReload = async (pluginId: string, data: Partial<PluginMeta<AppPluginSettings>>) => {\n  try {\n    await updatePlugin(pluginId, data);\n\n    // Reloading the page as the changes made here wouldn't be propagated to the actual plugin otherwise.\n    // This is not ideal, however unfortunately currently there is no supported way for updating the plugin state.\n    window.location.reload();\n  } catch (e) {\n    console.error('Error while updating the plugin', e);\n  }\n};\n\nconst updatePlugin = async (pluginId: string, data: Partial<PluginMeta>) => {\n  const response = await getBackendSrv().fetch({\n    url: `/api/plugins/${pluginId}/settings`,\n    method: 'POST',\n    data,\n  });\n\n  return lastValueFrom(response);\n};\n","import { AutoInterval } from 'types/type';\nimport pluginJson from './plugin.json';\nimport { Dayjs } from 'dayjs';\nimport { groupBy } from 'lodash-es';\n\nexport const PLUGIN_BASE_URL = `/a/${pluginJson.id}`;\n\nexport enum ROUTES {\n  One = 'one',\n  Discover = 'discover',\n  Traces = 'traces',\n  Dashboard = 'dashboard',\n}\n\nexport const FORMAT_DATE = 'YYYY-MM-DD HH:mm:ss';\nexport enum IntervalEnum {\n    Auto = 'auto',\n    Day = 'day',\n    Week = 'week',\n    Month = 'month',\n    Year = 'year',\n    Hour = 'hour',\n    Minute = 'minute',\n    Second = 'second',\n}\n\nexport const DEFAULT_SERVICE = { value: 'all', label: 'ALL' };\nexport const DEFAULT_OPERATION = { value: 'all', label: 'ALL' };\n\nexport const AUTO_INTERVALS = [\n    {\n        current_date_range: 3,\n        current_type: 'year',\n        interval_unit: 'month',\n        interval_value: 1,\n    },\n    {\n        current_date_range: 1,\n        current_type: 'year',\n        interval_unit: 'week',\n        interval_value: 1,\n    },\n    {\n        current_date_range: 1,\n        current_type: 'month',\n        interval_unit: 'day',\n        interval_value: 1,\n    },\n    {\n        current_date_range: 1,\n        current_type: 'week',\n        interval_unit: 'hour',\n        interval_value: 12,\n    },\n    {\n        current_date_range: 4,\n        current_type: 'day',\n        interval_unit: 'hour',\n        interval_value: 3,\n    },\n    {\n        current_date_range: 1,\n        current_type: 'day',\n        interval_unit: 'hour',\n        interval_value: 1,\n    },\n    {\n        current_date_range: 16,\n        current_type: 'hour',\n        interval_unit: 'minute',\n        interval_value: 30,\n    },\n    {\n        current_date_range: 8,\n        current_type: 'hour',\n        interval_unit: 'minute',\n        interval_value: 10,\n    },\n    {\n        current_date_range: 2,\n        current_type: 'hour',\n        interval_unit: 'minute',\n        interval_value: 5,\n    },\n    {\n        current_date_range: 38,\n        current_type: 'minute',\n        interval_unit: 'minute',\n        interval_value: 1,\n    },\n    {\n        current_date_range: 13,\n        current_type: 'minute',\n        interval_unit: 'second',\n        interval_value: 30,\n    },\n    {\n        current_date_range: 6,\n        current_type: 'minute',\n        interval_unit: 'second',\n        interval_value: 10,\n    },\n    {\n        current_date_range: 4,\n        current_type: 'minute',\n        interval_unit: 'second',\n        interval_value: 5,\n    },\n    {\n        current_date_range: 1,\n        current_type: 'minute',\n        interval_unit: 'second',\n        interval_value: 1,\n    },\n];\n\nexport const CAN_SEARCH_FIELD_TYPE = ['STRING', 'ARRAY', 'NUMBER', 'VARIANT'];\nexport const ENABLE_SEARCH_FIELD_TYPE = ['DATETIME', 'TIMESTAMP', 'TIME'];\n\n\nexport function getAutoInterval(currentDate: [Dayjs, Dayjs]): AutoInterval {\n    const AUTO_INTERVALS_OBJ = groupBy(AUTO_INTERVALS, ({ current_type }) => current_type);\n    const [startDate, endDate] = currentDate;\n    const diffYear = endDate?.diff(startDate, 'year');\n    const diffMonth = endDate?.diff(startDate, 'month');\n    const diffWeek = endDate?.diff(startDate, 'week');\n    const diffDay = endDate?.diff(startDate, 'day');\n    const diffHour = endDate?.diff(startDate, 'hour');\n    const diffMinute = endDate?.diff(startDate, 'minute');\n\n    let intervalInfo: any = {};\n\n    if ((diffYear as number) >= 3) {\n        intervalInfo = AUTO_INTERVALS_OBJ['year'].find(item => {\n            return item.current_date_range === 3;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffYear as number) < 3 && (diffYear as number) >= 1) {\n        intervalInfo = AUTO_INTERVALS_OBJ['year'].find(item => {\n            return item.current_date_range === 1;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffMonth as number) >= 1) {\n        intervalInfo = AUTO_INTERVALS_OBJ['month'].find(item => {\n            return item.current_date_range === 1;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffWeek as number) >= 1) {\n        intervalInfo = AUTO_INTERVALS_OBJ['week'].find(item => {\n            return item.current_date_range === 1;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffDay as number) >= 4) {\n        intervalInfo = AUTO_INTERVALS_OBJ['day'].find(item => {\n            return item.current_date_range === 4;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffDay as number) >= 1 && (diffDay as number) < 4) {\n        intervalInfo = AUTO_INTERVALS_OBJ['day'].find(item => {\n            return item.current_date_range === 1;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffHour as number) >= 16) {\n        intervalInfo = AUTO_INTERVALS_OBJ['hour'].find(item => {\n            return item.current_date_range === 16;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffHour as number) >= 8) {\n        intervalInfo = AUTO_INTERVALS_OBJ['hour'].find(item => {\n            return item.current_date_range === 8;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffHour as number) >= 2) {\n        intervalInfo = AUTO_INTERVALS_OBJ['hour'].find(item => {\n            return item.current_date_range === 2;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffMinute as number) >= 38) {\n        intervalInfo = AUTO_INTERVALS_OBJ['minute'].find(item => {\n            return item.current_date_range === 38;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffMinute as number) >= 13) {\n        intervalInfo = AUTO_INTERVALS_OBJ['minute'].find(item => {\n            return item.current_date_range === 13;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffMinute as number) >= 6) {\n        intervalInfo = AUTO_INTERVALS_OBJ['minute'].find(item => {\n            return item.current_date_range === 6;\n        });\n        return intervalInfo as AutoInterval;\n    }\n\n    if ((diffMinute as number) >= 4) {\n        intervalInfo = AUTO_INTERVALS_OBJ['minute'].find(item => {\n            return item.current_date_range === 4;\n        });\n        return intervalInfo as AutoInterval;\n    }\n    if ((diffMinute as number) >= 1) {\n        intervalInfo = AUTO_INTERVALS_OBJ['minute'].find(item => {\n            return item.current_date_range === 1;\n        });\n        return intervalInfo as AutoInterval;\n    } else {\n        intervalInfo = AUTO_INTERVALS_OBJ['minute'].find(item => {\n            return item.current_date_range === 1;\n        });\n        return intervalInfo as AutoInterval;\n    }\n}\n\nexport function translationDateIntervalType(type: IntervalEnum): string {\n    if (type === 'auto') {return 'Auto';}\n    else if (type === 'second') {return 'Second';}\n    else if (type === 'minute') {return 'Minute';}\n    else if (type === 'hour') {return 'Hour';}\n    else if (type === 'day') {return 'Day';}\n    else if (type === 'week') {return 'Week';}\n    else if (type === 'month') {return 'Month';}\n\n    return 'Year';\n}\n\n","export const testIds = {\n  appConfig: {\n    apiKey: 'data-testid ac-api-key',\n    apiUrl: 'data-testid ac-api-url',\n    submit: 'data-testid ac-submit-form',\n  },\n  pageOne: {\n    container: 'data-testid pg-one-container',\n    navigateToFour: 'data-testid navigate-to-four',\n  },\n  pageTwo: {\n    container: 'data-testid pg-two-container',\n  },\n  pageThree: {\n    container: 'data-testid pg-three-container',\n  },\n  pageFour: {\n    container: 'data-testid pg-four-container',\n    navigateBack: 'data-testid navigate-back',\n  },\n};\n"],"names":["React","useState","useEffect","lastValueFrom","css","toDataFrame","getBackendSrv","DataSourcePicker","Button","Field","FieldSet","Input","SecretInput","useStyles2","Select","useAtom","getDatabases","getTablesService","testIds","settingDatabasesAtom","settingTablesAtom","AppConfig","plugin","s","getStyles","enabled","pinned","jsonData","secureJsonFields","meta","state","setState","apiUrl","apiKey","isApiKeySet","Boolean","logsConfig","currentLogsConfig","setCurrentLogsConfig","databases","setDatabases","tables","setTables","isSubmitDisabled","fetchDatabases","useCallback","ds","undefined","subscribe","next","resp","data","ok","frame","results","frames","values","Array","from","fields","options","map","item","label","value","error","err","console","log","fetchTables","db","selectdbDS","datasource","database","getTables","onResetApiKey","onChange","event","target","name","trim","onSubmit","updatePluginAndReload","id","secureJsonData","submitLogConfig","subscription","unsubscribe","form","description","width","data-testid","appConfig","isConfigured","placeholder","onReset","className","marginTop","div","type","submit","disabled","current","noDefault","filter","selectedDatabase","logsTable","selectedTable","targetTraceTable","theme","colorWeak","colors","text","secondary","spacing","pluginId","updatePlugin","window","location","reload","e","response","fetch","url","method","pluginJson","groupBy","PLUGIN_BASE_URL","ROUTES","FORMAT_DATE","IntervalEnum","DEFAULT_SERVICE","DEFAULT_OPERATION","AUTO_INTERVALS","current_date_range","current_type","interval_unit","interval_value","CAN_SEARCH_FIELD_TYPE","ENABLE_SEARCH_FIELD_TYPE","getAutoInterval","currentDate","AUTO_INTERVALS_OBJ","startDate","endDate","diffYear","diff","diffMonth","diffWeek","diffDay","diffHour","diffMinute","intervalInfo","find","translationDateIntervalType","pageOne","container","navigateToFour","pageTwo","pageThree","pageFour","navigateBack"],"sourceRoot":""}