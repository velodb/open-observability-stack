{"version":3,"file":"285.js?_cache=63ce448b9dbb60e51397","mappings":"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","sources":["webpack://doris-app/./components/trace-detail/index.tsx","webpack://doris-app/./services/traces.sql.ts","webpack://doris-app/./services/traces.ts","webpack://doris-app/./store/traces.ts","webpack://doris-app/./components/testIds.ts","webpack://doris-app/./components/discover-filter/discover-filter.style.ts","webpack://doris-app/./components/discover-filter/filter-content.tsx","webpack://doris-app/./components/discover-filter/index.tsx","webpack://doris-app/./utils/icon.tsx","webpack://doris-app/./utils/tailwind.ts","webpack://doris-app/./components/discover-sidebar/field-item/top-data/top-data.tsx","webpack://doris-app/./components/discover-sidebar/field-item/field-item.tsx","webpack://doris-app/./components/discover-sidebar/filter-content/filter-content.tsx","webpack://doris-app/./components/discover-sidebar/index.tsx","webpack://doris-app/./components/discover-histogram/index.tsx","webpack://doris-app/./components/selectdb-ui/sd-collapsible-table/index.tsx","webpack://doris-app/./components/discover-content/discover-content.style.ts","webpack://doris-app/./components/discover-content/content-table-actions.tsx","webpack://doris-app/./components/discover-content/content-item.tsx","webpack://doris-app/./components/surrounding-logs/surrounding-content-item.tsx","webpack://doris-app/./components/surrounding-logs/logs-actions.tsx","webpack://doris-app/./components/surrounding-logs/discover-filter/discover-filter.style.ts","webpack://doris-app/./components/surrounding-logs/discover-filter/filter-content.tsx","webpack://doris-app/./components/surrounding-logs/discover-filter/index.tsx","webpack://doris-app/./services/sql.ts","webpack://doris-app/./services/discover.ts","webpack://doris-app/./components/surrounding-logs/content/content-table-actions.tsx","webpack://doris-app/./components/surrounding-logs/index.tsx","webpack://doris-app/./components/discover-content/index.tsx","webpack://doris-app/./components/discover-header/discover-header.style.ts","webpack://doris-app/./components/discover-header/search-type.tsx","webpack://doris-app/./components/discover-header/sql-search.tsx","webpack://doris-app/./components/discover-header/lucene.tsx","webpack://doris-app/./components/discover-header/index.tsx","webpack://doris-app/./utils/query-parser/tokenUtils.ts","webpack://doris-app/./utils/query-parser/constants.ts","webpack://doris-app/./utils/query-parser/sqlstring-browser.ts","webpack://doris-app/./utils/query-parser/enums.ts","webpack://doris-app/./utils/query-parser/utils.ts","webpack://doris-app/./utils/query-parser/serializers.ts","webpack://doris-app/./utils/query-parser/ast.ts","webpack://doris-app/./utils/query-parser/query-parser.ts","webpack://doris-app/./services/lucene.ts","webpack://doris-app/./pages/PageDiscover/useLuceneWhereClause.ts","webpack://doris-app/./pages/PageDiscover/useDiscoverData.ts","webpack://doris-app/./pages/PageDiscover.tsx"],"sourcesContent":["import { LoadingState } from '@grafana/data';\nimport { PanelRenderer } from '@grafana/runtime';\nimport { Drawer, LoadingPlaceholder } from '@grafana/ui';\nimport { useAtom, useAtomValue } from 'jotai';\nimport React, { useEffect } from 'react';\nimport { getTableDataTraceService } from 'services/traces';\nimport { currentCatalogAtom, currentDatabaseAtom, tableTracesDataAtom, selectedDatasourceAtom, selectedRowAtom } from 'store/discover';\nimport { currentTraceTableAtom } from 'store/traces';\nimport { formatTracesResData } from 'utils/data';\n\nexport default function TraceDetail(props: { onClose?: () => void; open: boolean; traceId?: string; traceTable?: string }) {\n    const currentTable = useAtomValue(currentTraceTableAtom);\n    const currentCatalog = useAtomValue(currentCatalogAtom);\n    const currentDatabase = useAtomValue(currentDatabaseAtom);\n    const [traceData, setTraceData] = useAtom(tableTracesDataAtom);\n    const selectedRow = useAtomValue(selectedRowAtom);\n    const selectdbDS = useAtomValue(selectedDatasourceAtom);\n    const traceTable = props?.traceTable || currentTable || 'otel_traces';\n    const [loading, setLoading] = React.useState(false);\n\n    const { open, traceId } = props;\n\n    const getTraceData = React.useCallback(() => {\n        let payload: any = {\n            catalog: currentCatalog,\n            database: currentDatabase,\n            table: traceTable,\n            cluster: '',\n            sort: 'DESC',\n            trace_id: traceId || '',\n        };\n        setLoading(true);\n\n        getTableDataTraceService({\n            selectdbDS,\n            ...payload,\n        }).subscribe({\n            next: ({ data, ok }: any) => {\n                setLoading(false);\n                if (ok) {\n                    const formatedData = formatTracesResData(data.results.getTableDataTrace.frames[0]);\n                    setTraceData(formatedData);\n                }\n            },\n            error: (err: any) => {\n                setLoading(false);\n                console.log('Fetch Error', err);\n            },\n        });\n    }, [currentCatalog, currentDatabase, traceTable, selectdbDS, setTraceData, traceId]);\n\n    useEffect(() => {\n        if (traceId) {\n            getTraceData();\n        }\n    }, [selectedRow.trace_id, currentCatalog, currentDatabase, selectdbDS, setTraceData, getTraceData, traceId]);\n\n    function renderTracePanel() {\n        if (traceData) {\n            return (\n                <PanelRenderer\n                    title=\"trace panel\"\n                    width={200}\n                    height={300}\n                    pluginId=\"traces\"\n                    options={{}}\n                    data={{\n                        state: loading ? LoadingState.Loading : LoadingState.Done,\n                        series: [traceData],\n                        timeRange: {\n                            from: new Date(Date.now() - 15 * 60 * 1000) as any, // 15 \n                            to: new Date() as any,\n                            raw: {\n                                from: 'now-15m',\n                                to: 'now',\n                            },\n                        },\n                    }}\n                />\n            );\n        }\n        return null;\n    }\n\n    return (\n        <>\n            {open && (\n                <Drawer\n                    title=\"Trace Panel\"\n                    onClose={() => {\n                        props?.onClose?.();\n                    }}\n                    size=\"lg\"\n                >\n                    {loading ? <LoadingPlaceholder text={`Loading`} /> : renderTracePanel()}\n                </Drawer>\n            )}\n        </>\n    );\n}\n","import { QueryTracesParams, TracesOperationsParams, TracesServicesParams } from 'types/type';\n\ninterface QueryTraceDetailParams {\n    database: string;\n    table: string;\n    trace_id: string;\n}\n\n// TableTrace\nexport function getQueryTableTraceSQL(params: QueryTraceDetailParams): string {\n    const { table, trace_id, database } = params;\n\n    const sql = `\n      SELECT\n        trace_id AS traceID,\n        span_id AS spanID,\n        parent_span_id AS parentSpanID,\n        span_name AS operationName,\n        service_name AS serviceName,\n        CONCAT(\n          '[',\n          array_join(\n            array_map(\n              (x, y) -> json_object('key', x, 'value', y),\n              map_keys(CAST(CAST(resource_attributes AS TEXT) AS MAP<STRING, STRING>)),\n              map_values(CAST(CAST(resource_attributes AS TEXT) AS MAP<STRING, STRING>))\n            ),\n            ','\n          ),\n          ']'\n        ) AS serviceTags,\n        UNIX_TIMESTAMP(timestamp) * 1000 AS startTime,\n        duration / 1000 AS duration,\n        CONCAT(\n          '[',\n          array_join(\n            array_map(\n              (x, y) -> json_object('key', x, 'value', y),\n              map_keys(CAST(CAST(span_attributes AS TEXT) AS MAP<STRING, STRING>)),\n              map_values(CAST(CAST(span_attributes AS TEXT) AS MAP<STRING, STRING>))\n            ),\n            ','\n          ),\n          ']'\n        ) AS tags,\n        span_kind AS kind,\n        CASE status_code\n          WHEN 'STATUS_CODE_OK' THEN 1\n          WHEN 'STATUS_CODE_ERROR' THEN 2\n          ELSE 0\n        END AS statusCode,\n        status_message AS statusMessage,\n        scope_name AS instrumentationLibraryName,\n        scope_version AS instrumentationLibraryVersion,\n        trace_state AS traceState\n      FROM ${database}.\\`${table}\\`\n      WHERE trace_id = '${trace_id}';\n    `;\n\n    return sql;\n}\n\nfunction parseDuration(input?: string): number {\n    if (!input) {\n        return 0;\n    }\n\n    if (input.endsWith('ms')) {\n        return parseFloat(input.replace('ms', ''));\n    } else if (input.endsWith('us')) {\n        return parseFloat(input.replace('us', '')) / 1000;\n    } else if (input.endsWith('s')) {\n        return parseFloat(input.replace('s', '')) * 1000;\n    }\n    return 0;\n}\n\nfunction tagsToDorisSQLConditions(tags?: string): string {\n    if (!tags) {\n        return '1=1';\n    }\n    const conditions: string[] = [];\n\n    const regex = /([\\w.]+)=(?:\"([^\"]+)\"|'([^']+)'|([^\\s]+))/g;\n    let match: RegExpExecArray | null;\n    while ((match = regex.exec(tags)) !== null) {\n        const key = match[1];\n        const val = match[2] || match[3] || match[4];\n        conditions.push(`span_attributes['${key}'] = '${val}'`);\n    }\n\n    return conditions.length > 0 ? conditions.join(' AND ') : '1=1';\n}\n\nexport function buildTraceAggSQLFromParams(params: QueryTracesParams): string {\n    const timeFilter = `${params.timeField} >= '${params.startDate}' AND ${params.timeField} < '${params.endDate}'`;\n\n    const serviceFilter = params.service_name && params.service_name !== 'all' ? `service_name = '${params.service_name}'` : '1=1';\n\n    const operationFilter = params.operation && params.operation !== 'all' ? `span_name = '${params.operation}'` : '1=1';\n\n    const statusFilter = params.statusCode && params.statusCode !== 'all' ? `status_code = '${params.statusCode}'` : '1=1';\n\n    const minDuration = parseDuration(params.minDuration);\n    const maxDuration = parseDuration(params.maxDuration);\n\n    let durationFilter = '1=1';\n    if (minDuration > 0 && maxDuration > 0) {\n        durationFilter = `trace_duration BETWEEN ${minDuration} AND ${maxDuration}`;\n    } else if (minDuration > 0) {\n        durationFilter = `trace_duration >= ${minDuration}`;\n    } else if (maxDuration > 0) {\n        durationFilter = `trace_duration <= ${maxDuration}`;\n    }\n\n    const tagsFilter = tagsToDorisSQLConditions(params.tags);\n\n    let rootSpansFilter = '1=1';\n    if (params.service_name && params.service_name !== 'all') {\n        rootSpansFilter = `service_name = '${params.service_name}'`;\n    }\n    if (params.operation && params.operation !== 'all') {\n        rootSpansFilter += ` AND span_name = '${params.operation}'`;\n    }\n\n    const limit = params.page_size ?? 1000;\n    const offset = Math.max(((params.page ?? 1) - 1) * limit, 0);\n\n    let rowNumberOrderBy = 'time DESC';\n    switch (params.sortBy) {\n        case 'longest-duration':\n            rowNumberOrderBy = 'trace_duration_ms DESC';\n            break;\n        case 'shortest-duration':\n            rowNumberOrderBy = 'trace_duration_ms ASC';\n            break;\n        case 'most-spans':\n            rowNumberOrderBy = 'spans DESC';\n            break;\n        case 'least-spans':\n            rowNumberOrderBy = 'spans ASC';\n            break;\n        case 'most-recent':\n            rowNumberOrderBy = 'time DESC';\n            break;\n    }\n\n    const query = `\nUSE ${params.database};\n\nWITH\n  trace_durations AS (\n    SELECT\n      trace_id,\n      (UNIX_TIMESTAMP(MAX(end_time)) - UNIX_TIMESTAMP(MIN(timestamp))) * 1000 AS trace_duration\n    FROM ${params.table}\n    WHERE ${timeFilter}\n    GROUP BY trace_id\n  ),\n  all_trace_ids AS (\n    SELECT\n      t.trace_id,\n      MIN(t.${params.timeField}) AS time,\n      d.trace_duration\n    FROM ${params.table} t\n    JOIN trace_durations d ON t.trace_id = d.trace_id\n    WHERE\n      ${timeFilter}\n      AND ${serviceFilter}\n      AND ${operationFilter}\n      AND ${statusFilter}\n      AND ${tagsFilter}\n      AND 1=1\n      AND ${durationFilter}\n    GROUP BY t.trace_id, d.trace_duration\n  ),\n  root_spans AS (\n    SELECT\n      trace_id,\n      span_name AS operation,\n      service_name AS root_service\n    FROM ${params.table}\n    WHERE (parent_span_id IS NULL OR parent_span_id = '') AND ${rootSpansFilter} AND ${timeFilter}\n  ),\n  aggregated AS (\n    SELECT\n      UNIX_TIMESTAMP(MIN(t.${params.timeField})) AS time,\n      t.trace_id,\n      r.operation,\n      r.root_service,\n      COLLECT_SET(t.service_name) AS services,\n      COUNT(*) AS spans,\n      SUM(IF(status_code = 'STATUS_CODE_ERROR', 1, 0)) AS error_spans,\n      MAX(duration) / 1000 AS max_span_duration_ms,\n      MAX(UNIX_TIMESTAMP(t.timestamp) * 1000 + duration / 1000) - MIN(UNIX_TIMESTAMP(t.timestamp) * 1000) AS trace_duration_ms,\n      MAX(IF(t.parent_span_id IS NULL OR t.parent_span_id = '', duration, 0)) / 1000 AS root_span_duration_ms\n    FROM ${params.table} t\n    JOIN all_trace_ids a ON t.trace_id = a.trace_id\n    JOIN root_spans r ON t.trace_id = r.trace_id\n    GROUP BY t.trace_id, r.operation, r.root_service\n  ),\n  numbered AS (\n    SELECT\n      a.*,\n      COUNT(*) OVER() AS total_count,\n      ROW_NUMBER() OVER(ORDER BY ${rowNumberOrderBy}) AS rn\n    FROM aggregated a\n  )\n\nSELECT\n  *,\n  total_count AS total\nFROM numbered\nWHERE rn > ${offset} AND rn <= ${offset + limit}\nORDER BY ${rowNumberOrderBy};\n`;\n\n    return query;\n}\n\nexport function getServiceListSQL(params: TracesServicesParams): string {\n    return `\n    SELECT DISTINCT service_name \n    FROM ${params.table} \n    WHERE ${params.timeField} BETWEEN '${params.startDate}' AND '${params.endDate}' \n    ORDER BY service_name ASC\n  `;\n}\n\nexport function getOperationListSQL(params: TracesOperationsParams): string {\n    return `\n    SELECT DISTINCT span_name \n    FROM ${params.table} \n    WHERE ${params.timeField} BETWEEN '${params.startDate}' AND '${params.endDate}' \n    AND service_name = '${params.service_name}'\n    ORDER BY span_name ASC\n  `;\n}\n","import { getBackendSrv } from \"@grafana/runtime\";\nimport { buildTraceAggSQLFromParams, getOperationListSQL, getQueryTableTraceSQL, getServiceListSQL } from \"./traces.sql\";\n\n// tableTrace\nexport function getTableDataTraceService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const traceSQL = getQueryTableTraceSQL(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getTableDataTrace',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: traceSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n// Traces\nexport function getTracesService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const getTracesSQL = buildTraceAggSQLFromParams(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getTraces',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: getTracesSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n// Trace Services\nexport function getServiceListService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const serviceListSQL = getServiceListSQL(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getServiceList',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: serviceListSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n// Trace Operations\nexport function getOperationListService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const operationListSQL = getOperationListSQL(rest);\n    return getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getOperationList',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: operationListSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n}\n\n\n\n","import { DEFAULT_OPERATION, DEFAULT_SERVICE } from '../constants';\nimport { atom } from 'jotai';\n\n\nexport const currentTraceTableAtom = atom<string>('');\nexport const currentServiceAtom = atom<any>(DEFAULT_SERVICE);\nexport const currentOperationAtom = atom<any>(DEFAULT_OPERATION);\nexport const currentSortAtom = atom<any>('most-recent');\nexport const tagsAtom = atom<string>('');\nexport const tracesAtom = atom<any>([]);\nexport const tracesServicesAtom = atom<any>([]);\nexport const traceOperationsAtom = atom<any>([]);\nexport const minDurationAtom = atom<any>('');\nexport const maxDurationAtom = atom<any>('');\n","export const testIds = {\n  appConfig: {\n    apiKey: 'data-testid ac-api-key',\n    apiUrl: 'data-testid ac-api-url',\n    submit: 'data-testid ac-submit-form',\n  },\n  pageOne: {\n    container: 'data-testid pg-one-container',\n    navigateToFour: 'data-testid navigate-to-four',\n  },\n  pageTwo: {\n    container: 'data-testid pg-two-container',\n  },\n  pageThree: {\n    container: 'data-testid pg-three-container',\n  },\n  pageFour: {\n    container: 'data-testid pg-four-container',\n    navigateBack: 'data-testid navigate-back',\n  },\n};\n","import { css } from '@emotion/css';\nimport styled from '@emotion/styled';\n\nexport const DiscoverFilterWrapper = styled.div`\n    display: flex;\n    align-items: center;\n    .filter {\n        align-self: flex-start;\n        margin-top: 3px;\n        margin-right: 8px;\n        font-weight: 500;\n        font-size: 14px;\n        font-style: normal;\n        line-height: 18px;\n    }\n    .filter-tag {\n        display: flex;\n        flex: 1;\n        flex-wrap: wrap;\n        align-items: center;\n        row-gap: 8px;\n        column-gap: 8px;\n        padding: 0 8px;\n        .tag {\n            display: flex;\n            align-items: center;\n            max-width: 400px;\n            height: 24px;\n            padding: 2px 8px;\n            font-weight: 400;\n            font-size: 12px;\n            font-style: normal;\n            line-height: 18px;\n            border: 0px;\n            border-radius: 6px;\n            .text {\n                overflow: hidden;\n                white-space: nowrap;\n                text-overflow: ellipsis;\n            }\n        }\n    }\n`;\n\nexport const containerStyle = css`\n    width: 320px;\n`;\n\nexport const rowStyle = css`\n    display: flex;\n    gap: 8px;\n    margin-bottom: 12px;\n`;\n\nexport const colStyle = css`\n    flex: 1;\n`;\n\nexport const footerStyle = css`\n    display: flex;\n    justify-content: flex-end;\n    gap: 8px;\n    margin-top: 16px;\n\n    & button {\n        flex: 1;\n        display: block;\n        text-align: center;\n        \n        span {\n            display: inline;\n        }\n    }\n`;\n","import { useAtom, useAtomValue } from 'jotai';\nimport React from 'react';\nimport { nanoid } from 'nanoid';\nimport { Select, InlineField, InlineFieldRow, InlineSwitch, Button, Input, Field } from '@grafana/ui';\nimport { tableFieldsAtom, dataFilterAtom, tableFieldValuesAtom, tableDataAtom } from 'store/discover';\nimport { DataFilterType, Operator } from 'types/type';\nimport { OPERATORS, getFieldType } from 'utils/data';\nimport { Controller, useForm } from 'react-hook-form';\nimport { containerStyle, rowStyle, colStyle, footerStyle } from './discover-filter.style';\nimport { uniqBy } from 'lodash-es';\n\nexport function FilterContent({ onHide, dataFilterValue }: { onHide: () => void; dataFilterValue?: DataFilterType }) {\n    const tableFields = useAtomValue(tableFieldsAtom);\n    const [dataFilter, setDataFilter] = useAtom(dataFilterAtom);\n    const [tableFieldValue, setTableFieldValue] = useAtom(tableFieldValuesAtom);\n    const tableData = useAtomValue(tableDataAtom);\n\n    const {\n        control,\n        handleSubmit,\n        watch,\n        register,\n        setValue,\n        formState: { errors },\n    } = useForm({\n        defaultValues: {\n            field: {\n                label: dataFilterValue?.fieldName,\n                value: dataFilterValue?.fieldName\n            },\n            operator: {\n                label: dataFilterValue?.operator,\n                value: dataFilterValue?.operator\n            },\n            value: dataFilterValue?.value,\n            minValue: Array.isArray(dataFilterValue?.value) ? dataFilterValue?.value[0] : '',\n            maxValue: Array.isArray(dataFilterValue?.value) ? dataFilterValue?.value[1] : '',\n            label: dataFilterValue?.label || '',\n            showLabel: !!dataFilterValue?.label, // Initialize based on dataFilterValue\n        },\n    });\n\n    const field: any = watch('field');\n    const operator: any = watch('operator');\n    const showLabel: any = watch('showLabel');\n\n    // When user turns off the Custom Label switch, clear the label form value so it won't persist.\n    React.useEffect(() => {\n        if (!showLabel) {\n            // Clear the label in the form state so it won't be saved or re-displayed.\n            setValue('label', '');\n\n            // If we're editing an existing filter, also remove the label from the stored filter\n            // so the filter chip/list updates immediately and the switch remains off when reopened.\n            if (dataFilterValue?.id) {\n                setDataFilter(prev => {\n                    let changed = false;\n                    const updated = prev.map(f => {\n                        if (f.id === dataFilterValue.id) {\n                            if (f.label) {\n                                changed = true;\n                                return { ...f, label: '' };\n                            }\n                            return f;\n                        }\n                        return f;\n                    });\n                    return changed ? updated : prev;\n                });\n            }\n        }\n    }, [showLabel, setValue, dataFilterValue?.id, setDataFilter]);\n\n    // use centralized getFieldType from utils\n    const selectedFieldType = React.useMemo(() => {\n        const fieldName = typeof field === 'string' ? field : field?.value;\n        if (!fieldName) {\n            return '';\n        }\n        const tf = tableFields.find((f: any) => f.Field === fieldName);\n        return getFieldType(tf?.Type);\n    }, [field, tableFields]);\n\n    const isNumberField = selectedFieldType === 'NUMBER';\n    const isBooleanField = selectedFieldType === 'BOOLEAN';\n    const isTimeField = selectedFieldType === 'DATE';\n\n    // Normalize OPERATORS to the form {label, value} and filter out inapplicable operators based on field type.\n    const operatorOptions = React.useMemo(() => {\n        const normalized = ((OPERATORS || []) as any[]).map(op => ({ label: (op && op.label) || op, value: (op && op.value) || op }));\n        // text matching ops to remove for numeric fields\n        const textMatchOps = ['like', 'not like', 'match_all', 'match_any', 'match_phrase', 'match_phrase_prefix'];\n\n        if (isBooleanField) {\n            // BOOLEAN should only allow equality and null checks\n            const allowed = new Set(['=', '!=', 'is null', 'is not null']);\n            return normalized.filter(opItem => allowed.has(String(opItem.value)));\n        }\n\n        const isNumberOrTime = isNumberField || isTimeField;\n        if (isNumberOrTime) {\n            // remove text match ops for number or time fields\n            return normalized.filter(opItem => {\n                const v = String(opItem.value).toLowerCase();\n                return !textMatchOps.includes(v);\n            });\n        }\n\n        // non-number, non-boolean, non-time fields: keep full list\n        return normalized;\n     }, [isNumberField, isBooleanField, isTimeField]);\n\n    const getValue = (value: string): string | number => (isNaN(+value) ? value : +value);\n\n    // Convert an input value according to current field type.\n    // Preserve explicit empty string ('') so users can set an empty-string value.\n    const convertValue = (v: any): any => {\n        // Preserve explicit empty string so the user can set ''\n        if (v === '')  {\n            return '';\n        }\n        if (v === undefined || v === null) {\n            return v;\n        }\n\n        // If array, convert each element\n        if (Array.isArray(v)) {\n            return v.map(convertValue);\n        }\n\n        // Handle booleans\n        if (v === true || v === 'true') {\n            return true;\n        }\n        if (v === false || v === 'false') {\n            return false;\n        }\n\n        // Prefer field-type-based conversion when possible\n        if (isNumberField) {\n            return getValue(String(v));\n        }\n\n        // NOTE: removed previous fallback that converted numeric-looking strings to Number for\n        // non-number fields. Now we only convert to Number when the field type is numeric.\n\n        return v;\n    };\n\n    const onSubmit = (formValues: any) => {\n        const { field, operator: opField, value, minValue, maxValue, label, showLabel } = formValues;\n        const current = dataFilter.find(f => f.id === dataFilterValue?.id);\n        const id = dataFilterValue?.id || nanoid();\n\n        // The compatible operator could be string or {label, value}.\n        const opValue = typeof opField === 'string' ? opField : opField?.value;\n\n        let newValue: any[] = [];\n\n        if (opValue === 'between' || opValue === 'not between') {\n            // Use convertValue so numbers/booleans are properly typed; preserve empty strings if provided\n            if ((minValue !== undefined && minValue !== '') && (maxValue !== undefined && maxValue !== '')) {\n                newValue = [convertValue(minValue), convertValue(maxValue)];\n            }\n        } else if (value !== undefined) {\n            // accept empty string, 0 and other falsy numeric values.\n            if (Array.isArray(value)) {\n                newValue = value.map(v => convertValue(v));\n            } else {\n                newValue = [convertValue(value)];\n            }\n        }\n\n        const newItem = {\n            id,\n            fieldName: field.value,\n            operator: opValue,\n            // Only persist label when showLabel is true. Otherwise ensure it's empty.\n            label: showLabel ? label : '',\n            value: newValue,\n        };\n        if (current) {\n            const updated = dataFilter.map(f => (f.id === id ? newItem : f));\n            setDataFilter(updated);\n        } else {\n            setDataFilter([...dataFilter, newItem]);\n        }\n\n        onHide();\n    };\n\n    function renderFiledComponent() {\n        // const currentField = field.value;\n        // console.log(operator);\n        console.log(operator);\n        const currentOperator = (typeof operator === 'string' ? operator : operator?.value) as Operator | undefined;\n        if (currentOperator && currentOperator !== 'is null' && currentOperator !== 'is not null' && (currentOperator === 'between' || currentOperator === 'not between')) {\n            return (\n                <div className={rowStyle}>\n                    <div className={colStyle}>\n                        <Field label=\"Min Value\" invalid={!!errors.minValue} error={errors.minValue?.message}>\n                            <Input {...register('minValue', { required: 'Enter the minValue' })} />\n                        </Field>\n                    </div>\n                    <div className={colStyle}>\n                        <Field label=\"Max Value\" invalid={!!errors.maxValue} error={errors.maxValue?.message}>\n                            <Input {...register('maxValue', { required: 'Enter the maxValue' })} />\n                        </Field>\n                    </div>\n                </div>\n            );\n        }\n        console.log('currentOperator', currentOperator);\n        if (\n            currentOperator === '=' ||\n            currentOperator === '!=' ||\n            currentOperator === 'like' ||\n            currentOperator === 'not like' ||\n            currentOperator === 'match_all' ||\n            currentOperator === 'match_any' ||\n            currentOperator === 'match_phrase' ||\n            currentOperator === 'match_phrase_prefix'\n        ) {\n            return (\n                <>\n                    <Field label=\"Value\" invalid={!!errors.value} error={(errors.value as any)?.message}>\n                        {/* Allow empty string as a valid value: treat undefined as missing but accept '' */}\n                        <Input {...register('value', { validate: (v: any) => v !== undefined || 'Enter the value' })} />\n                    </Field>\n                </>\n            );\n        }\n        if (currentOperator === 'in' || currentOperator === 'not in') {\n            return (\n                <Field label=\"Value\" invalid={!!errors.value} error={(errors.value as any)?.message}>\n                    <Controller\n                        name=\"value\"\n                        control={control}\n                        rules={{ required: 'Enter the value' }}\n                        render={({ field }) => (\n                            <Select\n                                {...field}\n                                isMulti={true}\n                                options={tableFieldValue.map(item => ({\n                                    label: item.value,\n                                    value: item.value,\n                                }))}\n                                placeholder=\"Select value\"\n                                onChange={selected => field.onChange(selected ? selected.map((s: any) => s.value) : [])}\n                                value={tableFieldValue\n                                    .filter(item => Array.isArray(field.value) && field.value.includes(item.value))\n                                    .map(item => ({\n                                        label: item.value,\n                                        value: item.value,\n                                    }))}\n                            />\n                        )}\n                    />\n                </Field>\n            );\n        }\n        return <></>;\n    }\n\n    return (\n        <form onSubmit={handleSubmit(onSubmit)} className={containerStyle}>\n            <div className={rowStyle}>\n                <div className={colStyle}>\n                    <Field label=\"Columns\" invalid={!!errors.field} error={(errors.field as any)?.message}>\n                        <Controller\n                            name=\"field\"\n                            control={control}\n                            rules={{ required: 'Select Field' }}\n\n                            render={({ field }) => (\n                                <Select\n                                    {...field}\n                                    onChange={(selected) => {\n                                        // Only update tableFieldValue when we actually have table data and a selected field\n                                        if (selected?.value && Array.isArray(tableData) && tableData.length > 0) {\n                                            setTableFieldValue(\n                                                uniqBy(\n                                                    tableData.map((item) => ({\n                                                        label: selected.value,\n                                                        value: item._original[selected.value],\n                                                    })),\n                                                    'value',\n                                                ),\n                                            );\n                                        } else {\n                                            setTableFieldValue([]);\n                                        }\n                                        field.onChange(selected)\n                                    }}\n\n                                    options={tableFields.map(f => ({\n                                        label: f.Field,\n                                        value: f.Field,\n                                    }))}\n                                />\n                            )}\n                        />\n                    </Field>\n                </div>\n                <div className={colStyle}>\n                    <Field label=\"Operator\" invalid={!!errors.operator} error={(errors.operator as any)?.message}>\n                        <Controller\n                            name=\"operator\"\n                            control={control}\n                            rules={{ required: 'Select Operator' }}\n                            render={({ field }) => (\n                                <Select\n                                    {...field}\n                                    options={operatorOptions}\n                                />\n                            )}\n                        />\n                    </Field>\n                </div>\n            </div>\n\n            {renderFiledComponent()}\n\n            <InlineFieldRow>\n                <InlineField label=\"Custom Label\">\n                    <Controller name=\"showLabel\" control={control} render={({ field }) => <InlineSwitch {...field} />}></Controller>\n                </InlineField>\n            </InlineFieldRow>\n\n            {showLabel && (\n                <Field invalid={!!errors.label} error={errors.label?.message}>\n                    <Input {...register('label', { required: 'Please enter label' })} />\n                </Field>\n            )}\n\n            <div className={footerStyle}>\n                <Button\n                    variant=\"secondary\"\n                    onClick={e => {\n                        e.preventDefault();\n                        onHide();\n                    }}\n                >\n                    Cancel\n                </Button>\n                <Button type=\"submit\">Confirm</Button>\n            </div>\n        </form>\n    );\n}\n","import React, { useRef, useState } from 'react';\nimport { DiscoverFilterWrapper } from './discover-filter.style';\nimport { useTranslation } from 'react-i18next';\nimport { useAtom } from 'jotai';\nimport { FilterContent } from './filter-content';\nimport { dataFilterAtom, locationAtom } from 'store/discover';\nimport { getFilterSQL } from 'utils/data';\nimport { css } from '@emotion/css';\nimport { Badge, Icon, IconButton, Toggletip, useTheme2 } from '@grafana/ui';\n// import { set } from 'lodash-es';\n\nexport default function DiscoverFilter() {\n    const [dataFilter, setDataFilter] = useAtom(dataFilterAtom);\n    const [open, setOpen] = useState<boolean>(false);\n    const [dataFilterOpen, setDataFilterOpen] = useState<any>({});\n    const discoverFilterRef = useRef(null);\n    const { t } = useTranslation();\n    const [_loc, setLoc] = useAtom(locationAtom);\n    const theme = useTheme2();\n\n    return (\n        //  className=\"mt-px rounded-b-sm bg-n8 p-4 pb-6\"\n        <DiscoverFilterWrapper\n            ref={discoverFilterRef}\n            className={css`\n                background-color: ${theme.isDark ? 'rgb(24, 27, 31)' : '#FFF'};\n                padding: 1rem;\n                padding-bottom: 1.5rem;\n                margin-top: 1px;\n                border-radius: 0 0 0.25rem 0.25rem;\n            `}\n        >\n            <div className=\"text-xs font-medium\">{t`Filter`}</div>\n            <div className=\"filter-tag\">\n                {dataFilter.map((dataFilterValue, index) => {\n                    return (\n                        <div\n                            key={index.toString()}\n                            className={css`\n                                margin: '0 4px';\n                            `}\n                        >\n                            <Toggletip\n                                show={dataFilterOpen[dataFilterValue.id]}\n                                onOpen={() => {\n                                    setDataFilterOpen({\n                                        ...dataFilterOpen,\n                                        [dataFilterValue.id]: true,\n                                    });\n                                }}\n                                onClose={() => {\n                                    setDataFilterOpen({\n                                        ...dataFilterOpen,\n                                        [dataFilterValue.id]: false,\n                                    });\n                                }}\n                                closeButton={true}\n                                content={\n                                    <FilterContent\n                                        onHide={() => {\n                                            setDataFilterOpen({\n                                                ...dataFilterOpen,\n                                                [dataFilterValue.id]: false,\n                                            });\n                                        }}\n                                        dataFilterValue={dataFilterValue}\n                                    />\n                                }\n                                placement=\"bottom\"\n                            >\n                                <div>\n                                    <Badge\n                                        // className=\"mx-1 rounded px-2 py-[2px] text-xs leading-[18px] text-n3 first:ml-2 hover:border-b7 group-data-[state=open]:border-b7 dark:hover:border-b3 dark:group-data-[state=open]:border-b3\"\n                                        key={index}\n                                        text={\n                                            <div\n                                                className={css`\n                                                    display: flex;\n                                                    align-items: center;\n                                                    justify-content: space-between;\n                                                `}\n                                            >\n                                                <span>{dataFilterValue.label ? <span>{dataFilterValue.label}</span> : <span>{getFilterSQL(dataFilterValue)}</span>}</span>\n                                                <div\n                                                    className={css`\n                                                        margin-left: 0.5rem;\n                                                        cursor: pointer;\n                                                    `}\n                                                    onClick={() => {\n                                                        const data_filters = dataFilter.filter(e => e !== dataFilterValue);\n                                                        setDataFilter(data_filters);\n                                                        setLoc(prev => {\n                                                            const searchParams = prev.searchParams;\n                                                            searchParams?.set('data_filters', JSON.stringify(data_filters));\n                                                            return {\n                                                                ...prev,\n                                                                searchParams,\n                                                            };\n                                                        });\n                                                    }}\n                                                >\n                                                    <Icon name=\"times\" />\n                                                </div>\n                                            </div>\n                                        }\n                                        color=\"blue\"\n                                    ></Badge>\n                                </div>\n                            </Toggletip>\n                        </div>\n                    );\n                })}\n                <Toggletip\n                    show={open}\n                    closeButton={false}\n                    onOpen={() => {\n                        setOpen(true);\n                    }}\n                    content={\n                        <FilterContent\n                            onHide={() => {\n                                console.log('onHide');\n                                setOpen(false);\n                            }}\n                        />\n                    }\n                    placement=\"bottom\"\n                >\n                    <IconButton name=\"plus\" tooltip=\"Add filter\" style={{marginLeft: 10}} />\n                </Toggletip>\n            </div>\n        </DiscoverFilterWrapper>\n    );\n}\n","import { Icon } from \"@grafana/ui\";\nimport React from \"react\";\n\n\nexport const FIELD_TYPES = [\n    {\n        key: 'STRING',\n        value: ['VARCHAR', 'STRING', 'CHAR', 'TEXT'],\n        icon: <Icon name=\"text-fields\" />\n    },\n    {\n        key: 'NUMBER',\n        value: ['INT', 'LARGEINT', 'SMALLINT', 'TINYINT', 'DECIMAL', 'BIGINT', 'FLOAT', 'DOUBLE'],\n        icon: <Icon name=\"percentage\" />,\n    },\n    {\n        key: 'DATE',\n        value: ['DATE', 'DATETIME', 'DATEV2', 'DATETIMEV2'],\n        icon: <Icon name=\"clock-nine\" />,\n    },\n    {\n        key: 'JSONB',\n        value: ['JSONB'],\n        icon: <Icon name=\"brackets-curly\" />,\n        complex: true,\n    },\n    {\n        key: 'ARRAY',\n        value: ['ARRAY'],\n        icon: <Icon name=\"list-ul\" />,\n        complex: true,\n    },\n    {\n        key: 'BOOLEAN',\n        value: ['BOOLEAN'],\n        icon: <Icon name=\"toggle-on\" />\n    },\n    {\n        key: 'BITMAP',\n        value: ['BITMAP'],\n        icon: <Icon name=\"building\" />,\n        complex: true,\n    },\n    {\n        key: 'HLL',\n        value: ['HLL'],\n        icon: <Icon name=\"draggabledots\" />,\n        complex: true,\n    },\n    {\n        key: 'VARIANT',\n        value: ['VARIANT'],\n        icon: <Icon name=\"brackets-curly\" />,\n        complex: true,\n    },\n    {\n        key: 'JSON',\n        value: ['JSON'],\n        icon: <Icon name=\"brackets-curly\" />,\n        complex: true,\n    },\n];\n\nexport const getFieldIcon = (columnType: string) => {\n    const currentColumnType = FIELD_TYPES.find(item => item.value.some(val => columnType.toLocaleUpperCase().includes(val)));\n    return currentColumnType?.icon;\n};\n","import { type ClassValue, clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nexport function cn(...inputs: ClassValue[]) {\n    return twMerge(clsx(inputs));\n}","import { css } from '@emotion/css';\nimport { IconButton } from '@grafana/ui';\nimport { Progress } from 'antd';\nimport { useAtom, useAtomValue } from 'jotai';\nimport { get } from 'lodash-es';\nimport { nanoid } from 'nanoid';\nimport React from 'react';\nimport { topDataAtom, tableTotalCountAtom, dataFilterAtom } from 'store/discover';\nimport { isComplexType } from 'utils/data';\ninterface JsonObject {\n    [key: string]: any;\n}\nfunction countValueDistribution(jsonArray: JsonObject[], key: string): { [value: string]: number } {\n    const valueCountMap = new Map<string, number>();\n\n    jsonArray.forEach(obj => {\n        let value = get(obj, key);\n        if (value === undefined) {\n            value = '';\n        }\n        valueCountMap.set(value, (valueCountMap.get(value) || 0) + 1);\n    });\n\n    const result: { [value: string]: number } = {};\n    valueCountMap.forEach((times, valueStr) => {\n        const value = valueStr;\n        result[value] = times;\n    });\n\n    return result;\n}\n\nexport function TopData({ field }: any) {\n    console.log(field);\n    const topData = useAtomValue(topDataAtom);\n    const tableTotalCount = useAtomValue(tableTotalCountAtom);\n    const [dataFilter, setDataFilter] = useAtom(dataFilterAtom);\n    const canDisplayTopData = field?.Type?.toUpperCase() !== 'VARIANT';\n    const res = Object.entries(countValueDistribution(topData, field.Field)).sort((a: any, b: any) => b[1].count - a[1].count);\n\n    return (\n        <div\n            className={css`\n                max-height: 400px;\n                overflow-y: auto;\n                padding: 8px;\n            `}\n        >\n            <div className=\"mb-2 mt-2 break-words text-xs text-n5\">\n                <span className=\"mr-2\">{field.Field}</span>\n                <span>({field.Type})</span>\n            </div>\n            <div\n                className={css`\n                    display: flex;\n                    align-items: center;\n                    justify-content: space-between;\n                `}\n            >\n                <div\n                    className={css`\n                        font-size: 16px;\n                        margin: 8px 0;\n                    `}\n                >\n                    TOP5\n                </div>\n                <small className=\"text-n2\">{tableTotalCount >= 500 ? 500 : tableTotalCount} Items</small>\n            </div>\n            {canDisplayTopData ? (\n                <div className=\"mt-3 space-y-3 text-n5\">\n                    {res.map(\n                        ([value, count], index) =>\n                            index < 5 && (\n                                <div key={index} className=\"flex items-center justify-between\">\n                                    <div\n                                        className={css`\n                                            overflow: hidden;\n                                            text-overflow: ellipsis;\n                                            white-space: nowrap;\n                                        `}\n                                    >\n                                        <div\n                                            className={css`\n                                                display: flex;\n                                                align-items: center;\n                                                width: 180px;\n                                                justify-content: space-between;\n                                            `}\n                                        >\n                                            <div\n                                                className={css`\n                                                    flex: 1 1 0%;\n                                                    overflow: hidden;\n                                                    text-overflow: ellipsis;\n                                                    white-space: nowrap;\n                                                `}\n                                            >\n                                                {value}\n                                            </div>\n                                            <div\n                                                className={css`\n                                                    margin-left: 20px;\n                                                    flex-shrink: 0;\n                                                `}\n                                            >\n                                                {+((count * 100) / topData.length).toFixed(1)}%\n                                            </div>\n                                        </div>\n                                        <Progress\n                                            size={4}\n                                            className={css`\n                                                .ant-progress-outer {\n                                                    .ant-progress-inner {\n                                                        position: absolute;\n                                                        top: 0px;\n                                                    }\n                                                }\n                                            `}\n                                            style={{ width: '100%', height: '0px' }}\n                                            percent={+((count * 100) / topData.length).toFixed(1)}\n                                            status=\"normal\"\n                                            showInfo={false}\n                                        />\n                                    </div>\n                                    {!isComplexType(field.Type) && (\n                                        <div\n                                            className={css`\n                                                margin-left: 30px;\n                                            `}\n                                        >\n                                            <IconButton\n                                                name=\"plus-circle\"\n                                                onClick={e => {\n                                                    console.log(value);\n                                                    setDataFilter([\n                                                        ...dataFilter,\n                                                        {\n                                                            fieldName: field.Field,\n                                                            operator: '=',\n                                                            value: [typeof value === 'string' ? value : +value],\n                                                            id: nanoid(),\n                                                        },\n                                                    ]);\n                                                    e.stopPropagation();\n                                                }}\n                                                tooltip=\"Equivalent filtration\"\n                                            />\n                                            <IconButton\n                                                name=\"minus-circle\"\n                                                style={{ marginLeft: '4px' }}\n                                                tooltip=\"Nonequivalent filtration\"\n                                                onClick={e => {\n                                                    setDataFilter([\n                                                        ...dataFilter,\n                                                        {\n                                                            fieldName: field.Field,\n                                                            operator: '!=',\n                                                            value: [typeof value ? value : +value],\n                                                            id: nanoid(),\n                                                        },\n                                                    ]);\n                                                    e.stopPropagation();\n                                                }}\n                                            />\n                                        </div>\n                                    )}\n                                </div>\n                            ),\n                    )}\n                </div>\n            ) : (\n                <div className=\"mt-2 text-xs text-n5\">Does not supported</div>\n            )}\n        </div>\n    );\n}\n","import React from 'react';\nimport { getFieldIcon } from 'utils/icon';\nimport { IconButton, Toggletip, useTheme2 } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { cn } from 'utils/tailwind';\nimport { TopData } from './top-data/top-data';\n\ninterface FieldItemProps {\n    field: any;\n    onAdd?: (field: any) => void;\n    onRemove?: (field: any) => void;\n    type: 'add' | 'remove';\n}\n\nexport default function FieldItem(props: FieldItemProps) {\n    const theme = useTheme2();\n    const { field } = props;\n    field.key = field.Field;\n    if (field.children) {\n        field.icon = <div className=\"w-4 text-sm leading-8 text-n4\">{}</div>;\n        return (\n            <div className=\"-ml-3 flex\">\n                Tree\n                {/* <Tree showIcon className={`${TreeStyle} ${DiscoverTreeStyle}`} treeData={[field]} switcherIcon={<SDIcon type=\"icon-arrow-down\" className=\"dark:text-n6\" />} /> */}\n            </div>\n        );\n    }\n    return (\n        <div>\n            <Toggletip placement='right' content={<TopData field={field} />}>\n                <div\n                    className={css`\n                        width: 100%;\n                        text-align: left;\n                        display: flex;\n                        align-items: center;\n                        justify-content: space-between;\n                        height: 32px;\n                        padding: 0 8px;\n                        cursor: pointer;\n                        &:hover .icon-wrapper {\n                            opacity: 1;\n                        }\n                        &:hover {\n                            background-color: ${theme.colors.background.secondary};\n                        }\n                    `}\n                >\n                    <div className=\"flex\">\n                        <div>{getFieldIcon(field['Type'])}</div>\n                        <div\n                            className={css`\n                                display: flex;\n                                margin-left: 4px;\n                                overflow: hidden;\n                                text-overflow: ellipsis;\n                                white-space: nowrap;\n                                max-width: 130px;\n                            `}\n                        >\n                            {field['Field']}\n                        </div>\n                    </div>\n                    <div\n                        className={cn(\n                            'icon-wrapper',\n                            css`\n                                opacity: 0;\n                                transition: opacity 0.2s;\n                                margin-left: auto;\n                                display: flex;\n                                align-items: center;\n                                color: ${theme.colors.text.secondary};\n                                &:hover {\n                                    color: ${theme.colors.text.primary};\n                                }\n                            `,\n                        )}\n                    >\n                        {props.type === 'add' ? (\n                            <IconButton\n                                name=\"plus\"\n                                tooltip=\"Add to table\"\n                                onClick={e => {\n                                    props?.onAdd?.(field);\n                                    e.stopPropagation();\n                                }}\n                            />\n                        ) : (\n                            <IconButton\n                                name=\"minus\"\n                                tooltip=\"Delete from table\"\n                                onClick={(e: any) => {\n                                    props?.onRemove?.(field);\n                                    e.stopPropagation();\n                                }}\n                            />\n                        )}\n                    </div>\n                </div>\n            </Toggletip>\n        </div>\n    );\n}\n","import { useTranslation } from 'react-i18next';\nimport { useAtom } from 'jotai';\nimport React from 'react';\nimport { searchableAtom, aggregatableAtom, fieldTypeAtom } from 'store/discover';\nimport { AggregatableEnum, AGGREGATABLE, SearchableEnum, SEARCHABLE } from 'utils/data';\nimport { Select, RadioButtonGroup } from '@grafana/ui';\nimport { css } from '@emotion/css';\n\nexport function FilterContent() {\n  const { t } = useTranslation();\n  const [searchable, setSearchable] = useAtom(searchableAtom);\n  const [aggregatable, setAggregatable] = useAtom(aggregatableAtom);\n  const [fieldType, setFieldType] = useAtom(fieldTypeAtom);\n  return (\n    //  className=\"w-auto divide-y rounded-md dark:divide-gray-700\"\n    <div className={css`\n      width: auto;\n      border-radius: 0.375rem;\n    `}>\n      {/* className=\"title dark:text-n2\" */}\n      <div className={css`\n        font-size: 1.125rem;\n        font-weight: 500;\n        `}>{`Field Filter`}</div>\n      <div className={css`\n          margin-top: 1rem;\n          border: none;\n        `}>\n        <div className={css`\n          font-size: 0.875rem;\n          margin-bottom: 0.5rem;\n          `} >{t`Aggregatable`}</div>\n        <div>\n          <RadioButtonGroup\n            //   name=\"aggregatable\"\n            options={AGGREGATABLE}\n            value={aggregatable}\n            onChange={(val) => {\n              setAggregatable(val as AggregatableEnum);\n            }}\n          />\n        </div>\n      </div>\n      <div className={css`\n          margin-top: 1rem;\n          border: none;\n        `}>\n        <div className={css`\n          font-size: 0.875rem;\n          margin-bottom: 0.5rem;\n          `} >{t`Searchable`}</div>\n        <div>\n          <RadioButtonGroup\n            //   name=\"searchable\"\n            options={SEARCHABLE}\n            value={searchable}\n            onChange={(val) => {\n              setSearchable(val as SearchableEnum);\n            }}\n          />\n        </div>\n      </div>\n      <div className={css`\n          margin-top: 1rem;\n          border: none;\n        `}>\n        <div className={css`\n          font-size: 0.875rem;\n          margin-bottom: 0.5rem;\n          `} >{t`Type`}</div>\n        <Select\n          value={fieldType as any}\n          onChange={(value) => {\n            setFieldType(value as any);\n          }}\n          options={[\n            {\n              value: 'ANY',\n              label: 'Any',\n            },\n            {\n              value: 'STRING',\n              label: 'String',\n            },\n            {\n              value: 'NUMBER',\n              label: 'Number',\n            },\n            {\n              value: 'DATE',\n              label: 'Date',\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n}\n","import { useAtom, useAtomValue } from 'jotai';\nimport React, { useState } from 'react';\nimport FieldItem from './field-item/field-item';\nimport { FilterContent } from './filter-content/filter-content';\nimport { selectedFieldsAtom, tableFieldsAtom, searchableAtom, aggregatableAtom, fieldTypeAtom, indexesAtom, surroundingSelectedFieldsAtom } from 'store/discover';\nimport { AggregatableEnum, getFieldType, SearchableEnum, FieldTypeEnum } from 'utils/data';\nimport { Button, CollapsableSection, Icon, Input, useTheme2, Toggletip } from '@grafana/ui';\nimport { css } from '@emotion/css';\n\nexport default function DiscoverSidebar() {\n    const [selectedFields, setSelectedFields] = useAtom(selectedFieldsAtom);\n    const [selectedSurroundingFields, setSelectedSurroundingFields] = useAtom(surroundingSelectedFieldsAtom);\n    const tableFields = useAtomValue(tableFieldsAtom);\n    const [searchable, _setSearchable] = useAtom(searchableAtom);\n    const [aggregatable, _setAggregatable] = useAtom(aggregatableAtom);\n    const [fieldType, _setFieldType] = useAtom(fieldTypeAtom);\n    const [searchValue, setSearchValue] = useState('');\n    const indexes = useAtomValue(indexesAtom);\n    const theme = useTheme2();\n    const filteredFields = tableFields\n        .filter(field => {\n            if (aggregatable === AggregatableEnum.ANY) {\n                return true;\n            }\n            if (aggregatable === AggregatableEnum.YES) {\n                return getFieldType(field.Type) === 'NUMBER';\n            }\n            if (aggregatable === AggregatableEnum.NO) {\n                return getFieldType(field.Type) !== 'NUMBER';\n            }\n            return false;\n        })\n        .filter((field: any) => {\n            if (searchable === SearchableEnum.ANY) {\n                return true;\n            }\n            if (searchable === SearchableEnum.YES) {\n                return indexes.some(index => field.Field === index.Field);\n            }\n            if (searchable === SearchableEnum.NO) {\n                return !indexes.some(index => field.Field === index.Field);\n            }\n            return false;\n        })\n        .filter(field => {\n            if (fieldType === FieldTypeEnum.ANY) {\n                return true;\n            }\n            return getFieldType(field.Type) === fieldType;\n        });\n    const hasSelectedFields = selectedFields.length > 0;\n    const availableFields = filteredFields.filter(filed => {\n        if (selectedFields.find(item => filed['Field'] === item['Field'])) {\n            return false;\n        }\n        return true;\n    });\n\n    function handleAdd(field: any) {\n        setSelectedFields([...selectedFields, field] as any);\n        setSelectedSurroundingFields([...selectedSurroundingFields, field] as any)\n    }\n\n    function handleRemove(field: any) {\n        const index = selectedFields.findIndex((item: any) => item.Field === field.Field);\n        selectedFields.splice(index, 1);\n\n        const surIndex = selectedSurroundingFields.findIndex((item: any) => item.Field === field.Field);\n        selectedSurroundingFields.splice(surIndex, 1);\n        setSelectedFields([...selectedFields]);\n        setSelectedSurroundingFields([...selectedSurroundingFields]);\n    }\n\n    return (\n        <div\n            className={css`\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n            `}\n        >\n            <div\n                className={css`\n                    display: flex;\n                    background-color: ${theme.isDark ? 'rgb(24, 27, 31)' : '#FFF'};\n                    padding: 1rem 0.5rem;\n                    border-raduis: 0.25rem 0;\n                    align-items: center;\n                    column-gap: 0.5rem;\n                `}\n            >\n                <Icon name=\"search\" />\n                <Input\n                    placeholder={`Search`}\n                    className={css`\n                        border: none;\n                    `}\n                    value={searchValue}\n                    onChange={(e: any) => setSearchValue(e.target.value)}\n                />\n                <Toggletip content={<FilterContent />}>\n                    <Icon name=\"filter\" />\n                </Toggletip>\n            </div>\n            <div\n                className={css`\n                    margin-top: 1px;\n                    flex: 1;\n                    padding: 0.5rem 1rem 0.5rem 1rem;\n                    background-color: ${theme.isDark ? 'rgb(24, 27, 31)' : '#FFF'};\n                    height: 100%;\n                    overflow: auto;\n                `}\n            >\n                <CollapsableSection label={<span className={css`\n                        margin-left: 4px;\n                        font-size: 14px;\n                        line-height: 32px;\n                    `}>Selected fields</span>} isOpen={true}>\n                    <div\n                        className={css`\n                            width: 100%;\n                        `}\n                    >\n                        {hasSelectedFields ? (\n                            <div\n                                className={css`\n                                    width: 100%;\n                                `}\n                            >\n                                {selectedFields\n                                    .filter((field: any) => {\n                                        return field['Field'].toLowerCase().includes(searchValue.toLowerCase());\n                                    })\n                                    .map((field: any, index) => (\n                                        <FieldItem type=\"remove\" key={index} field={field} onRemove={field => handleRemove(field)} />\n                                    ))}\n                            </div>\n                        ) : (\n                            <Button\n                                icon=\"arrow\"\n                                size=\"sm\"\n                                variant=\"secondary\"\n                                fill=\"text\"\n                                fullWidth={true}\n                                className={css`\n                                    width: 100%;\n                                    text-align: left;\n                                    justify-content: flex-start;\n                                `}\n                            >\n                                _source\n                            </Button>\n                        )}\n                    </div>\n                </CollapsableSection>\n                <CollapsableSection label={<span className={css`\n                        margin-left: 4px;\n                        font-size: 14px;\n                        line-height: 32px;\n                    `}>Available fields</span>}  isOpen={true}>\n                    <div\n                        className={css`\n                            width: 100%;\n                        `}\n                    >\n                        {availableFields\n                            .filter((field: any) => {\n                                return field['Field'].toLowerCase().includes(searchValue.toLowerCase());\n                            })\n                            .map((field: any, index) => (\n                                <FieldItem type=\"add\" field={field} key={index} onAdd={field => handleAdd(field)} />\n                            ))}\n                    </div>\n                </CollapsableSection>\n            </div>\n        </div>\n    );\n}\n","import ReactECharts from 'echarts-for-react';\nimport { useAtom, useAtomValue, useSetAtom } from 'jotai';\nimport React, { useEffect, useRef, useState } from 'react';\nimport dayjs from 'dayjs';\nimport { Select, useTheme2 } from '@grafana/ui';\nimport { IntervalEnum } from 'types/type';\nimport { TIME_INTERVALS } from 'utils/data';\nimport { getAutoInterval, FORMAT_DATE, translationDateIntervalType } from '../../constants';\nimport { currentDateAtom, discoverCurrentAtom, activeShortcutAtom, tableDataChartsAtom, intervalAtom, tableTotalCountAtom, pageSizeAtom, pageAtom, timeRangeAtom } from 'store/discover';\nimport { css } from '@emotion/css';\n\nexport function DiscoverHistogram() {\n    const theme = useTheme2().isDark ? 'dark' : 'light';\n    const [currentDate, setCurrentDate] = useAtom(currentDateAtom);\n    const ReactEChartsInstance = useRef<ReactECharts>(null);\n    const [discoverCurrent, setDiscoverCurrent] = useAtom(discoverCurrentAtom);\n    const setActiveItem = useSetAtom(activeShortcutAtom);\n\n    const tableDataCharts = useAtomValue(tableDataChartsAtom);\n    if (process.env.NODE_ENV !== 'production') {\n        tableDataChartsAtom.debugLabel = 'tableDataCharts';\n    }\n    const [interval_value, setInterval_value] = useState(1);\n    const [interval, setInterval] = useAtom(intervalAtom);\n    if (process.env.NODE_ENV !== 'production') {\n        intervalAtom.debugLabel = 'interval';\n    }\n    const tableTotalCount = useAtomValue(tableTotalCountAtom);\n    const [_timeRange, setTimeRange] = useAtom(timeRangeAtom);\n    const [_pageSize, setPageSize] = useAtom(pageSizeAtom);\n    const setPage = useSetAtom(pageAtom);\n\n    useEffect(() => {\n        const v = getAutoInterval(currentDate as any).interval_value;\n        setInterval_value(v);\n    }, [currentDate]);\n\n    const timeInterval = interval === IntervalEnum.Auto ? translationDateIntervalType(interval) : `${interval_value} ${translationDateIntervalType(interval)}`;\n\n    let base = +new Date(1988, 9, 3);\n    let oneDay = 24 * 3600 * 1000;\n    let data = [[base, Math.random() * 300]];\n    for (let i = 1; i < 20000; i++) {\n        let now = new Date((base += oneDay));\n        data.push([+now, Math.round((Math.random() - 0.5) * 20 + data[i - 1][1])]);\n    }\n\n    const options: any = {\n        title: {\n            subtext: `${`Time Interval`}: ${timeInterval}`,\n            left: 'right',\n            top: 12,\n        },\n        grid: {\n            left: '32px',\n            right: '32px',\n            bottom: '0px',\n            containLabel: true,\n        },\n        color: theme === 'light' ? ['#608DFF'] : ['#608DFF'],\n        xAxis: {\n            type: 'category',\n            data: tableDataCharts.map(e => e['TT']),\n            axisLabel: {\n                fontSize: '12px', // \n                fontStyle: 'normal',\n                fontWeight: 400,\n                color: theme === 'light' ? '#9F9FA2' : '#5F5F64',\n            },\n            axisLine: {\n                lineStyle: {\n                    width: 0.5,\n                    color: theme === 'light' ? '#BFBFC1' : '#3F3F45',\n                },\n            },\n            axisTick: {\n                show: false,\n            },\n        },\n        toolbox: {\n            show: false,\n        },\n        brush: {\n            xAxisIndex: 0,\n        },\n        yAxis: {\n            name: `Count`,\n            nameTextStyle: {\n                align: 'right',\n                padding: [5, 0],\n            },\n            type: 'value',\n            splitLine: {\n                show: true,\n                lineStyle: {\n                    width: 0.5, // \n                    color: theme === 'light' ? '#BFBFC1' : '#3F3F45',\n                },\n            },\n            axisLabel: {\n                fontSize: '12px',\n                fontStyle: 'normal',\n                fontWeight: 400,\n            },\n        },\n        tooltip: {\n            trigger: 'axis',\n            axisPointer: {\n                type: 'line',\n            },\n            padding: 0,\n            borderWidth: 0,\n            backgroundColor: theme === 'light' ? '#ffffff' : 'rgba(63, 63, 69, 0.64)',\n            formatter: function (params: any) {\n                const html = `<div className=\"text-n2\"\n                                       style=\"\n                                          padding: 8px;\n                                          min-width: 120px;\n                                          border-radius: 6px;\n                                          backdrop-filter: blur(12px);\n                                          color: ${theme === 'light' ? '#1F1F26' : '#EFEFF0'};\n                                        \">\n                                      <div style=\"padding-bottom: 4px; border-bottom: 1px solid ${theme === 'light' ? '#DFDFE0' : '#3F3F45'};\">${[params[0].name]}</div>\n                                      <div style=\"padding-top:4px;display: flex;justify-content: space-between;\"><span>Count:</span><span style=\"font-family:DIN Alternate;font-size:14;font-weight:500;\">${[\n                        params[0].value || 0,\n                    ]}</span></div>\n                                  </div>`;\n                return html;\n            },\n        },\n\n        series: [\n            {\n                data: tableDataCharts.map(e => e['sum(cnt)']),\n                type: 'bar',\n                barWidth: '99.3%',\n            },\n        ],\n\n        animation: false,\n    };\n\n    useEffect(() => {\n        const chart = ReactEChartsInstance.current;\n        if (chart && tableDataCharts.length > 0) {\n            const handler = ({ areas }: any) => {\n                if (!areas.length) {\n                    return;\n                }\n                setPage(1);\n                setPageSize(50);\n                setActiveItem(undefined);\n                const [startIndex, endIndex] = (areas[0] as any).coordRange as [startIndex: number, endIndex: number];\n                const timeInterval = interval === IntervalEnum.Auto ? getAutoInterval(currentDate as any).interval_unit : interval;\n                const chartsEndDate = dayjs(new Date(tableDataCharts[endIndex]['TT'])).add(interval_value, timeInterval);\n                console.log('aaa',discoverCurrent);\n                \n                setDiscoverCurrent({\n                    ...discoverCurrent,\n                    date: [dayjs(tableDataCharts[startIndex]['TT']), chartsEndDate],\n                });\n\n                setCurrentDate([dayjs(tableDataCharts[startIndex]['TT']), chartsEndDate]);\n                const timeRange = {\n                    from: dayjs(tableDataCharts[startIndex]['TT']).format(FORMAT_DATE),\n                    to: chartsEndDate.format(FORMAT_DATE),\n                    raw: {\n                        from: dayjs(tableDataCharts[startIndex]['TT']).format(FORMAT_DATE),\n                        to: chartsEndDate.format(FORMAT_DATE),\n                    },\n                };\n                setTimeRange(timeRange);\n                chart.getEchartsInstance().dispatchAction({\n                    type: 'brush',\n                    command: 'clear',\n                    areas: [],\n                });\n            };\n\n            if (chart.ele) {\n                chart.getEchartsInstance().dispatchAction({\n                    type: 'takeGlobalCursor',\n                    key: 'brush',\n                    brushOption: {\n                        brushType: 'lineX',\n                    },\n                });\n                chart.getEchartsInstance().on('brushEnd', handler);\n\n                return () => {\n                    if (chart.ele) {\n                        chart.getEchartsInstance().off('brushEnd', handler);\n                    }\n                };\n            }\n        }\n        return undefined;\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [tableDataCharts]);\n    return (\n        <div className={css`padding: 0 16px;`}>\n            <div\n                className={css`\n                    display: flex;\n                    align-items: center;\n                    justify-content: space-between;\n                `}\n            >\n                <div>\n                    <span className={css`\n                            font-size: 24px;\n                            font-weight: 600;\n                        `}\n                    >\n                        {tableTotalCount ? tableTotalCount.toString().replace(/(\\d)(?=(?:\\d{3})+$)/g, '$1,') : '0'}\n                    </span>{' '}\n                    <span className={css`font-size: 12px;`}>{`hits`}</span>\n                </div>\n                <div className={css`\n                        font-size: 14px;\n                        color: rgb(190,190,193)\n                    `}\n                >{currentDate && `${currentDate[0]?.format(FORMAT_DATE)} ~ ${currentDate[1]?.format(FORMAT_DATE)} `}</div>\n                <div\n                    className={css`\n                        width: 160px;\n                    `}\n                >\n                    <Select\n                        value={interval}\n                        onChange={selectdbInterval => {\n                            setInterval(selectdbInterval.value as any);\n                        }}\n                        options={TIME_INTERVALS}\n                    />\n                </div>\n            </div>\n            <div\n                className={css`\n                    height: 300px;\n                `}\n            >\n                <ReactECharts option={options} ref={ReactEChartsInstance}></ReactECharts>\n            </div>\n        </div>\n    );\n}\n","import React, { Fragment } from 'react';\nimport { ColumnDef, Row, flexRender, getCoreRowModel, getExpandedRowModel, useReactTable } from '@tanstack/react-table';\nimport { EmptySearchResult, useTheme2 } from '@grafana/ui';\nimport { css } from '@emotion/css';\n\ninterface SDCollapsibleTableProps<TData> {\n    data: TData[];\n    columns: Array<ColumnDef<TData>>;\n    renderSubComponent: (props: { row: Row<TData> }) => React.ReactElement;\n    getRowCanExpand: (row: Row<TData>) => boolean;\n    className?: string;\n}\n\nexport default function SDCollapsibleTable<T>(props: SDCollapsibleTableProps<T>) {\n    const { data, columns, renderSubComponent, getRowCanExpand, className } = props;\n    const theme = useTheme2();\n    const table = useReactTable<any>({\n        data,\n        columns,\n        getRowCanExpand,\n        getCoreRowModel: getCoreRowModel(),\n        getExpandedRowModel: getExpandedRowModel(),\n    });\n\n    return (\n        <table className={className}>\n            <thead>\n                {table.getHeaderGroups().map(headerGroup => (\n                    <tr key={headerGroup.id} className={css`${theme.isDark ? 'border-bottom: 1px solid hsl(var(--border-dark));' : 'border-bottom: 1px solid hsl(var(--border));'} `}>\n                        {headerGroup.headers.map(header => {\n                            return (\n                                <th\n                                    key={header.id}\n                                    colSpan={header.colSpan}\n                                    className={css`\n                                            position: sticky;\n                                            top: 0;\n                                            z-index: 2;\n                                            height: 48px; \n                                            white-space: nowrap;\n                                            background-color: ${theme.isLight ? 'hsl(var(--table-header-background)' : 'hsl(var(--table-header-background-dark)'} ); \n                                            padding-left: 16px; \n                                            padding-right: 16px;\n                                            text-align: left;\n                                            vertical-align: middle;\n                                            font-size: 14px;\n                                            font-weight: 500;    \n                                            color: hsl(var(--n2)}  \n\n                                            &:has([role=\"checkbox\"]) {\n                                                padding-right: 0;\n                                            }\n                                        `}\n                                >\n                                    {header.isPlaceholder ? null : flexRender(header.column.columnDef.header, header.getContext())}\n                                </th>\n                            );\n                        })}\n                    </tr>\n                ))}\n            </thead>\n            <tbody\n                className={css`\n                    #selected {\n                        background-color: #3f3f46cc;\n                    }\n                `}\n            >\n                {table.getRowModel().rows.length > 0 ? (\n                    table.getRowModel().rows.map(row => {\n                        return (\n                            <Fragment key={row.id}>\n                                <tr\n                                    id={row.original.selected ? 'selected' : ''}\n                                    // className={classNames(\n                                    //     'transition-colors dark:hover:bg-n7/80 hover:bg-b1/80 data-[state=selected]:bg-muted',\n                                    //     row.getIsExpanded() ? 'border-none' : 'border-b',\n                                    //     row.original.selected ? 'dark:bg-n7 bg-b1/60' : 'hsl(val(--n8))',\n                                    // )}\n                                    className={css`\n                                        ${row.getIsExpanded() ? `border:none;` : `${theme.isDark ? 'border-bottom: 1px solid hsl(var(--border-dark));' : 'border-bottom: 1px solid hsl(var(--border));'} `}\n\n                                        ${theme.isLight ? `\n                                             background-color: ${row.original.selected ? 'hsl(var(--b1) / 0.6)' : 'hsl(val(--n8))'}; \n                                        &:hover {\n                                            background-color: hsl(var(--b1) / 0.8);\n                                        }\n                                            `\n                                            :\n                                            `\n                                            background-color: ${row.original.selected ? 'hsl(var(--n7))' : 'hsl(val(--n8))'}; \n                                            &:hover {\n                                                    background-color: hsl(var(--n7) / 0.8);\n                                                }\n                                            }\n                                            `\n                                        }\n                                    `}\n                                >\n                                    {row.getVisibleCells().map(cell => {\n                                        return (\n                                            <td key={cell.id} className={css`\n                                                height: 48px;\n                                                padding: 0 16px;\n                                                font-size: 14px;\n                                            `} >\n                                                {cell.getContext().getValue() !== null ? flexRender(cell.column.columnDef.cell, cell.getContext()) : '-'}\n                                            </td>\n                                        );\n                                    })}\n                                </tr>\n                                {row.getIsExpanded() && (\n                                    <tr\n                                        //  className=\"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\"\n                                        className={css`\n                                        border-bottom: 1px solid rgb(63,63,70);\n                                        transition-property: background-color, border-color, color, fill, stroke;\n                                        transition-duration: 150ms;\n                                        transition-timing-function: ease-in-out;\n                                        \n                                        &:hover {\n                                            background-color: hsl(var(--muted) / 0.5);\n                                        }\n                                        \n                                        [data-state=\"selected\"] {\n                                            background-color: hsl(var(--muted))\n                                        }\n                                    `}\n                                    >\n                                        <td colSpan={row.getVisibleCells().length} className={css`\n                                                height: 32px;\n                                                padding: 0;\n                                            `}>\n                                            {renderSubComponent({ row })}\n                                        </td>\n                                    </tr>\n                                )}\n                            </Fragment>\n                        );\n                    })\n                ) : (\n                    <tr >\n                        <td colSpan={columns.length}>\n                            <EmptySearchResult>{`No Data`}</EmptySearchResult>\n                        </td>\n                    </tr>\n                )}\n            </tbody>\n        </table>\n    );\n}\n","import { css } from '@emotion/css';\nimport styled from '@emotion/styled';\n\nexport const HoverStyle = css`\n    &:hover {\n        .filter-content {\n            visibility: visible;\n        }\n    }\n`;\n\nexport const ColumnStyleWrapper = styled.div`\n    .field-key {\n        padding: 0px 4px 2px;\n        margin-right: 4px;\n        border-radius: 4px;\n    }\n`;\n","import { IconButton } from '@grafana/ui';\nimport { useAtom, useAtomValue } from 'jotai';\nimport { nanoid } from 'nanoid';\nimport React from 'react';\nimport { selectedFieldsAtom, dataFilterAtom, tableFieldsAtom } from 'store/discover';\nimport { isComplexType } from 'utils/data';\n\nexport function ContentTableActions({ fieldName, fieldValue }: any) {\n    const [selectedFields, setSelectedFields] = useAtom(selectedFieldsAtom);\n    const [dataFilter, setDataFilter] = useAtom(dataFilterAtom);\n    const tableFields = useAtomValue(tableFieldsAtom);\n    const fieldType = tableFields.find(field => field.Field === fieldName)?.Type;\n    const hasField = selectedFields.some((item: any) => item.Field === fieldName);\n    const filterValue = typeof fieldValue === 'object' ? JSON.stringify(fieldValue) : fieldValue;\n    return (\n        <>\n            <div className=\"icons\" style={{ display: 'flex', justifyContent: 'flex-end' }}>\n                {!isComplexType(fieldType) && (\n                    <>\n                        <IconButton\n                            name=\"plus-circle\"\n                            tooltip=\"Equivalent filtration\"\n                            onClick={() => {\n                                setDataFilter([...dataFilter, { fieldName: fieldName, operator: '=', value: [filterValue], id: nanoid() }]);\n                            }}\n                        />\n                        <IconButton\n                            name=\"minus-circle\"\n                            tooltip=\"Nonequivalent filtration\"\n                            onClick={() => {\n                                setDataFilter([...dataFilter, { fieldName: fieldName, operator: '!=', value: [filterValue], id: nanoid() }]);\n                            }}\n                        />\n                    </>\n                )}\n                <IconButton\n                        name=\"plus\"\n                        tooltip={hasField ? 'Delete From Table' : 'Add To Table'}\n                        onClick={() => {\n                            const field = tableFields.find(field => field.Field === fieldName);\n                            if (hasField) {\n                                const index = selectedFields.findIndex((item: any) => item.Field === fieldName);\n                                selectedFields.splice(index, 1);\n                                setSelectedFields([...selectedFields]);\n                            } else {\n                                setSelectedFields([...selectedFields, field]);\n                            }\n                        }}\n                    />\n            </div>\n        </>\n    );\n}\n","import { useAtom } from 'jotai';\nimport { css } from '@emotion/css';\nimport { nanoid } from 'nanoid';\nimport { dataFilterAtom } from 'store/discover';\nimport React from 'react';\nimport { isComplexType } from 'utils/data';\nimport { IconButton } from '@grafana/ui';\n\ninterface ContentItemProps {\n    fieldName: string;\n    fieldValue: string | number;\n    fieldType: string;\n}\n\nexport function ContentItem({ fieldName, fieldValue, fieldType }: ContentItemProps) {\n    const [dataFilter, setDataFilter] = useAtom(dataFilterAtom);\n    return (\n        <div>\n            {!isComplexType(fieldType) && (\n                <div className={css`\n                    display: flex;\n                    alignItems: 'center';\n                    margin-left: 10px;\n                `}>\n                    <IconButton\n                        name=\"plus-circle\"\n                        onClick={e => {\n                            setDataFilter([...dataFilter, { fieldName, operator: '=', value: [fieldValue], id: nanoid() }]);\n                            e.stopPropagation();\n                        }}\n                        tooltip=\"Equivalent filtration\"\n                    />\n                    <IconButton\n                        name=\"minus-circle\"\n                        style={{ marginLeft: '4px' }}\n                        onClick={e => {\n                            setDataFilter([\n                                ...dataFilter,\n                                {\n                                    fieldName,\n                                    operator: '!=',\n                                    value: [fieldValue],\n                                    id: nanoid(),\n                                },\n                            ]);\n                            e.stopPropagation();\n                        }}\n                        tooltip=\"Nonequivalent filtration\"\n                    />\n                </div>\n            )}\n        </div>\n    );\n}\n","import { useAtom } from 'jotai';\nimport { nanoid } from 'nanoid';\nimport { isComplexType } from 'utils/data';\nimport { IconButton } from '@grafana/ui';\nimport React from 'react';\nimport { css } from '@emotion/css';\nimport { surroundingDataFilterAtom } from 'store/discover';\n\ninterface ContentItemProps {\n    fieldName: string;\n    fieldValue: string | number;\n    fieldType: string;\n}\n\nexport function SurroundingContentItem({ fieldName, fieldValue, fieldType }: ContentItemProps) {\n    const [surroundingDataFilter, setSurroundingDataFilter] = useAtom(surroundingDataFilterAtom);\n    return (\n        <div>\n            {!isComplexType(fieldType) && (\n                <div className={css`\n                    display: flex;\n                    alignItems: 'center';\n                    margin-left: 10px;\n                `}>\n                    <IconButton\n                        name=\"plus-circle\"\n                        onClick={e => {\n                            setSurroundingDataFilter([...surroundingDataFilter, { fieldName, operator: '=', value: [fieldValue], id: nanoid() }]);\n                            e.stopPropagation();\n                        }}\n                        tooltip=\"Equivalent filtration\"\n                    />\n                    <IconButton\n                        name=\"minus-circle\"\n                        style={{ marginLeft: '4px' }}\n                        onClick={e => {\n                            setSurroundingDataFilter([\n                                ...surroundingDataFilter,\n                                {\n                                    fieldName,\n                                    operator: '!=',\n                                    value: [fieldValue],\n                                    id: nanoid(),\n                                },\n                            ]);\n                            e.stopPropagation();\n                        }}\n                        tooltip=\"Nonequivalent filtration\"\n                    />\n                </div>\n            )}\n        </div>\n    );\n}\n","import { css } from '@emotion/css';\nimport { Button, IconButton } from '@grafana/ui';\nimport React from 'react';\nimport { useTranslation } from 'react-i18next';\n\ninterface SurroundingLogsActionsProps {\n    getSurroundingData: (params: { time: string }) => void;\n    getSurroundingDataLoading: boolean;\n    time: string;\n    timeFieldPageSize: number;\n    setTimeFieldPageSize: (value: number) => void;\n    tips: string;\n    count: number;\n    type: 'before' | 'after';\n}\n\nexport function SurroundingLogsActions(props: SurroundingLogsActionsProps) {\n    const { getSurroundingData, getSurroundingDataLoading, time, timeFieldPageSize, tips, count, type } = props;\n    const { t } = useTranslation();\n    return (\n        <div\n            className={css`\n                display: flex;\n                align-items: center;\n                justify-content: flex-start;\n            `}\n        >\n            <Button\n                // loading={getSurroundingDataLoading}\n                className=\"font-normal text-n2 hover:text-b7 hover:no-underline\"\n                onClick={() => {\n                    getSurroundingData({ time: time });\n                }}\n                type=\"reset\"\n            >\n                {!getSurroundingDataLoading && (\n                    <>{type === 'before' ? <IconButton name=\"arrow-up\" aria-label={`Load After`} /> : <IconButton name=\"arrow-down\" aria-label={`Load Before`} />}</>\n                )}\n                {`Load`} {timeFieldPageSize} {t`Items`}\n            </Button>\n            <div\n                className={css`\n                    margin-left: 8px;\n                `}\n            >\n                {count} {`Items`} {` `}\n                {tips}\n            </div>\n        </div>\n    );\n}\n","import { css } from '@emotion/css';\nimport styled from '@emotion/styled';\n\nexport const DiscoverFilterWrapper = styled.div`\n    display: flex;\n    align-items: center;\n    .filter {\n        align-self: flex-start;\n        margin-top: 3px;\n        margin-right: 8px;\n        font-weight: 500;\n        font-size: 14px;\n        font-style: normal;\n        line-height: 18px;\n    }\n    .filter-tag {\n        display: flex;\n        flex: 1;\n        flex-wrap: wrap;\n        align-items: center;\n        row-gap: 8px;\n        .tag {\n            display: flex;\n            align-items: center;\n            max-width: 400px;\n            height: 24px;\n            padding: 2px 8px;\n            font-weight: 400;\n            font-size: 12px;\n            font-style: normal;\n            line-height: 18px;\n            border: 0px;\n            border-radius: 6px;\n            .text {\n                overflow: hidden;\n                white-space: nowrap;\n                text-overflow: ellipsis;\n            }\n        }\n    }\n`;\n\nexport const containerStyle = css`\n    width: 320px;\n`;\n\nexport const rowStyle = css`\n    display: flex;\n    gap: 8px;\n    margin-bottom: 12px;\n`;\n\nexport const colStyle = css`\n    flex: 1;\n`;\n\nexport const footerStyle = css`\n    display: flex;\n    justify-content: flex-end;\n    gap: 8px;\n    margin-top: 16px;\n`;\n","import { useAtom, useAtomValue } from 'jotai';\nimport React from 'react';\nimport { nanoid } from 'nanoid';\nimport { Select, InlineField, InlineFieldRow, InlineSwitch, Button, Input, Field } from '@grafana/ui';\nimport { tableFieldsAtom, tableFieldValuesAtom, surroundingDataFilterAtom, tableDataAtom } from 'store/discover';\nimport { Operator } from 'types/type';\nimport { OPERATORS, getFieldType } from 'utils/data';\nimport { Controller, useForm } from 'react-hook-form';\nimport { containerStyle, rowStyle, colStyle, footerStyle } from './discover-filter.style';\nimport { FilterContentProps } from '../types';\nimport { uniqBy } from 'lodash-es';\n\nexport function FilterContent(props: FilterContentProps) {\n    const { onHide, dataFilterValue } = props;\n    const [surroundingDataFilter, setSurroundingDataFilter] = useAtom(surroundingDataFilterAtom);\n    const tableFields = useAtomValue(tableFieldsAtom);\n    if (process.env.NODE_ENV !== 'production') {\n        // add a debug label for dev to help with jotai debugging\n        // @ts-ignore\n        surroundingDataFilterAtom.debugLabel = 'surroundingDataFilter';\n    }\n    const [tableFieldValue, setTableFieldValue] = useAtom(tableFieldValuesAtom);\n    const tableData = useAtomValue(tableDataAtom);\n\n    const {\n        control,\n        handleSubmit,\n        watch,\n        register,\n        setValue,\n        formState: { errors },\n    } = useForm({\n        defaultValues: {\n            field: {\n                label: dataFilterValue?.fieldName,\n                value: dataFilterValue?.fieldName,\n            },\n            operator: {\n                label: dataFilterValue?.operator,\n                value: dataFilterValue?.operator,\n            },\n            value: dataFilterValue?.value,\n            minValue: Array.isArray(dataFilterValue?.value) ? dataFilterValue?.value[0] : '',\n            maxValue: Array.isArray(dataFilterValue?.value) ? dataFilterValue?.value[1] : '',\n            label: dataFilterValue?.label || '',\n            showLabel: !!dataFilterValue?.label, // Initialize based on dataFilterValue\n        },\n    });\n    const field: any = watch('field');\n    const operator: any = watch('operator');\n    const showLabel: any = watch('showLabel');\n\n\n    const getValue = (value: string): string | number => (isNaN(+value) ? value : +value);\n\n    // use centralized getFieldType from utils\n    const selectedFieldType = React.useMemo(() => {\n        const fieldName = typeof field === 'string' ? field : field?.value;\n        if (!fieldName) {\n            return '';\n        }\n        const tf = tableFields.find((f: any) => f.Field === fieldName);\n        return getFieldType(tf?.Type);\n    }, [field, tableFields]);\n\n    const isNumberField = selectedFieldType === 'NUMBER';\n    const isBooleanField = selectedFieldType === 'BOOLEAN';\n    const isTimeField = selectedFieldType === 'DATE';\n\n    // Normalize OPERATORS to the form {label, value} and filter out inapplicable operators based on field type.\n    const operatorOptions = React.useMemo(() => {\n        const normalized = ((OPERATORS || []) as any[]).map(op => ({ label: (op && op.label) || op, value: (op && op.value) || op }));\n        // text matching ops to remove for numeric fields\n        const textMatchOps = ['like', 'not like', 'match_all', 'match_any', 'match_phrase', 'match_phrase_prefix'];\n\n        if (isBooleanField) {\n            // BOOLEAN should only allow equality and null checks\n            const allowed = new Set(['=', '!=', 'is null', 'is not null']);\n            return normalized.filter(opItem => allowed.has(String(opItem.value)));\n        }\n\n        const isNumberOrTime = isNumberField || isTimeField;\n        if (isNumberOrTime) {\n            // remove text match ops for number or time fields\n            return normalized.filter(opItem => {\n                const v = String(opItem.value).toLowerCase();\n                return !textMatchOps.includes(v);\n            });\n        }\n\n        // non-number, non-boolean, non-time fields: keep full list\n        return normalized;\n     }, [isNumberField, isBooleanField, isTimeField]);\n\n    // Convert an input value according to current field type.\n    // Preserve explicit empty string ('') so users can set an empty-string value.\n    const convertValue = (v: any): any => {\n        // Preserve explicit empty string so the user can set ''\n        if (v === '')  {\n            return '';\n        }\n        if (v === undefined || v === null) {\n            return v;\n        }\n\n        // If array, convert each element\n        if (Array.isArray(v)) {\n            return v.map(convertValue);\n        }\n\n        // Handle booleans\n        if (v === true || v === 'true') {\n            return true;\n        }\n        if (v === false || v === 'false') {\n            return false;\n        }\n\n        // Prefer field-type-based conversion when possible\n        if (isNumberField) {\n            return getValue(String(v));\n        }\n\n        // NOTE: only convert to Number when the field type is numeric. For non-number fields\n        // preserve the original string so values like '00123' remain strings.\n\n        return v;\n    };\n\n    const onSubmit = (formValues: any) => {\n        const { field, operator: opField, value, minValue, maxValue, label, showLabel } = formValues;\n        const current = surroundingDataFilter.find(f => f.id === dataFilterValue?.id);\n        const id = dataFilterValue?.id || nanoid();\n\n        // The compatible operator could be string or {label, value}.\n        const opValue = typeof opField === 'string' ? opField : opField?.value;\n\n        let newValue: any[] = [];\n\n        if (opValue === 'between' || opValue === 'not between') {\n            // Use convertValue so numbers/booleans are properly typed; preserve empty strings if provided\n            if ((minValue !== undefined && minValue !== '') && (maxValue !== undefined && maxValue !== '')) {\n                newValue = [convertValue(minValue), convertValue(maxValue)];\n            }\n        } else if (value !== undefined) {\n            // accept empty string, 0 and other falsy numeric values.\n            if (Array.isArray(value)) {\n                newValue = value.map(v => convertValue(v));\n            } else {\n                newValue = [convertValue(value)];\n            }\n        }\n\n        const newItem = {\n            id,\n            fieldName: field.value,\n            operator: opValue,\n            // Only persist label when showLabel is true. Otherwise ensure it's empty.\n            label: showLabel ? label : '',\n            value: newValue,\n        };\n\n        if (current) {\n            const updated = surroundingDataFilter.map(f => (f.id === id ? newItem : f));\n            setSurroundingDataFilter(updated);\n        } else {\n            setSurroundingDataFilter([...surroundingDataFilter, newItem]);\n        }\n\n        onHide();\n    };\n\n    // When user turns off the Custom Label switch, clear the label form value so it won't persist.\n    React.useEffect(() => {\n        // watch 'showLabel' via the form's watch above; this effect runs when showLabel changes\n        // but we need access to the current 'showLabel' value - use watch above.\n        const currentShowLabel = (watch as any)('showLabel');\n        if (!currentShowLabel) {\n            // Clear the label in the form state so it won't be saved or re-displayed.\n            setValue('label', '');\n\n            // If we're editing an existing filter, also remove the label from the stored filter\n            // so the filter chip/list updates immediately and the switch remains off when reopened.\n            if (dataFilterValue?.id) {\n                setSurroundingDataFilter(prev => {\n                    let changed = false;\n                    const updated = prev.map(f => {\n                        if (f.id === dataFilterValue.id) {\n                            if (f.label) {\n                                changed = true;\n                                return { ...f, label: '' };\n                            }\n                            return f;\n                        }\n                        return f;\n                    });\n                    return changed ? updated : prev;\n                });\n            }\n        }\n        // We only want this effect to run when the form's showLabel changes or when editing a different filter\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [watch, setValue, dataFilterValue?.id, setSurroundingDataFilter]);\n\n    function renderFiledComponent() {\n        const currentOperator = (typeof operator === 'string' ? operator : operator?.value) as Operator | undefined;\n        if (currentOperator && currentOperator !== 'is null' && currentOperator !== 'is not null' && (currentOperator === 'between' || currentOperator === 'not between')) {\n            return (\n                <div className={rowStyle}>\n                    <div className={colStyle}>\n                        <Field label=\"Min Value\" invalid={!!errors.minValue} error={errors.minValue?.message}>\n                            <Input {...register('minValue', { required: 'Enter the minValue' })} />\n                        </Field>\n                    </div>\n                    <div className={colStyle}>\n                        <Field label=\"Max Value\" invalid={!!errors.maxValue} error={errors.maxValue?.message}>\n                            <Input {...register('maxValue', { required: 'Enter the maxValue' })} />\n                        </Field>\n                    </div>\n                </div>\n            );\n        }\n        if (\n            currentOperator === '=' ||\n            currentOperator === '!=' ||\n            currentOperator === 'like' ||\n            currentOperator === 'not like' ||\n            currentOperator === 'match_all' ||\n            currentOperator === 'match_any' ||\n            currentOperator === 'match_phrase' ||\n            currentOperator === 'match_phrase_prefix'\n        ) {\n            return (\n                <>\n                    <Field label=\"Value\" invalid={!!errors.value} error={(errors.value as any)?.message}>\n                        {/* Allow empty string as a valid value: treat undefined as missing but accept '' */}\n                        <Input {...register('value', { validate: (v: any) => v !== undefined || 'Enter the value' })} />\n                    </Field>\n                 </>\n            );\n        }\n        if (currentOperator === 'in' || currentOperator === 'not in') {\n            return (\n                <Field label=\"Value\" invalid={!!errors.value} error={(errors.value as any)?.message}>\n                    <Controller\n                        name=\"value\"\n                        control={control}\n                        rules={{ required: 'Enter the value' }}\n                        render={({ field }) => (\n                            <Select\n                                {...field}\n                                isMulti={true}\n                                options={tableFieldValue.map(item => ({\n                                    label: item.value,\n                                    value: item.value,\n                                }))}\n                                placeholder=\"Select value\"\n                                onChange={selected => field.onChange(selected ? selected.map((s: any) => s.value) : [])}\n                                value={tableFieldValue\n                                    .filter(item => Array.isArray(field.value) && field.value.includes(item.value))\n                                    .map(item => ({\n                                        label: item.value,\n                                        value: item.value,\n                                    }))}\n                            />\n                        )}\n                    />\n                </Field>\n            );\n        }\n        return <></>;\n    }\n\n    return (\n        <form onSubmit={handleSubmit(onSubmit)} className={containerStyle}>\n            <div className={rowStyle}>\n                <div className={colStyle}>\n                    <Field label=\"Columns\" invalid={!!errors.field} error={(errors.field as any)?.message}>\n                        <Controller\n                            name=\"field\"\n                            control={control}\n                            rules={{ required: 'Select Field' }}\n                            render={({ field }) => (\n                                <Select\n                                    {...field}\n                                    onChange={(selected) => {\n                                        // Only update tableFieldValue when we actually have table data and a selected field\n                                        if (selected?.value && Array.isArray(tableData) && tableData.length > 0) {\n                                            setTableFieldValue(\n                                                uniqBy(\n                                                    tableData.map((item) => ({\n                                                        label: selected.value,\n                                                        value: item._original[selected.value],\n                                                    })),\n                                                    'value',\n                                                ),\n                                            );\n                                        } else {\n                                            setTableFieldValue([]);\n                                        }\n                                        field.onChange(selected);\n                                    }}\n                                    options={tableFields.map(f => ({\n                                        label: f.Field,\n                                        value: f.Field,\n                                    }))}\n                                />\n                            )}\n                        />\n                    </Field>\n                </div>\n                <div className={colStyle}>\n                    <Field label=\"Operator\" invalid={!!errors.operator} error={(errors.operator as any)?.message}>\n                        <Controller\n                            name=\"operator\"\n                            control={control}\n                            rules={{ required: 'Select Operator' }}\n                            render={({ field }) => (\n                                <Select\n                                    {...field}\n                                    options={operatorOptions}\n                                />\n                            )}\n                        />\n                    </Field>\n                </div>\n            </div>\n\n            {renderFiledComponent()}\n\n            <InlineFieldRow>\n                <InlineField label=\"Custom Label\">\n                    <Controller name=\"showLabel\" control={control} render={({ field }) => <InlineSwitch {...field} />}></Controller>\n                </InlineField>\n            </InlineFieldRow>\n\n            {showLabel && (\n                <Field invalid={!!errors.label} error={errors.label?.message}>\n                    <Input {...register('label', { required: 'Please enter label' })} />\n                </Field>\n            )}\n\n            <div className={footerStyle}>\n                <Button\n                    variant=\"secondary\"\n                    onClick={e => {\n                        e.preventDefault();\n                        onHide();\n                    }}\n                >\n                    Cancel\n                </Button>\n                <Button type=\"submit\">Confirm</Button>\n            </div>\n        </form>\n    );\n}\n\n","import React, { useRef, useState } from 'react';\nimport { DiscoverFilterWrapper } from './discover-filter.style';\nimport { useTranslation } from 'react-i18next';\nimport { useAtom } from 'jotai';\nimport { FilterContent } from './filter-content';\nimport { surroundingDataFilterAtom } from 'store/discover';\nimport { getFilterSQL } from 'utils/data';\nimport { css } from '@emotion/css';\nimport { Badge, Icon, IconButton, Toggletip, useTheme2 } from '@grafana/ui';\nimport { DiscoverFilterProps } from '../types';\n\nexport default function SurroundingDiscoverFilter(props: DiscoverFilterProps) {\n    const [surroundingDataFilter, setSurroundingDataFilter] = useAtom(surroundingDataFilterAtom);\n    const [open, setOpen] = useState<boolean>(false);\n    const [dataFilterOpen, setDataFilterOpen] = useState<any>({});\n    const discoverFilterRef = useRef(null);\n    const { t } = useTranslation();\n    const theme = useTheme2();\n\n    console.log('surroundingDataFilter', surroundingDataFilter);\n\n    return (\n        <DiscoverFilterWrapper\n            ref={discoverFilterRef}\n            className={css`\n                background-color: ${theme.isDark ? 'rgb(24, 27, 31)' : '#FFF'};\n                padding: 1rem;\n                padding-bottom: 1.5rem;\n                margin-top: 1px;\n                border-radius: 0 0 0.25rem 0.25rem;\n            `}\n        >\n            <div className=\"text-xs font-medium\">{t`Filter`}</div>\n            <div className=\"filter-tag\">\n                {surroundingDataFilter.map((dataFilterValue, index) => {\n                    return (\n                        <div\n                            key={index.toString()}\n                            className={css`\n                                margin-left: 8px;\n                            `}\n                        >\n                            <Toggletip\n                                show={dataFilterOpen[dataFilterValue.id]}\n                                onOpen={() => {\n                                    setDataFilterOpen({\n                                        ...dataFilterOpen,\n                                        [dataFilterValue.id]: true,\n                                    });\n                                }}\n                                onClose={() => {\n                                    setDataFilterOpen({\n                                        ...dataFilterOpen,\n                                        [dataFilterValue.id]: false,\n                                    });\n                                }}\n                                closeButton={true}\n                                content={\n                                    <FilterContent\n                                        onHide={() => {\n                                            setDataFilterOpen({\n                                                ...dataFilterOpen,\n                                                [dataFilterValue.id]: false,\n                                            });\n                                        }}\n                                        dataFilterValue={dataFilterValue}\n                                    />\n                                }\n                                placement=\"bottom\"\n                            >\n                                <div>\n                                    <Badge\n                                        key={index}\n                                        text={\n                                            <div\n                                                className={css`\n                                                    display: flex;\n                                                    align-items: center;\n                                                    justify-content: space-between;\n                                                `}\n                                            >\n                                                <span>{dataFilterValue.label ? <span>{dataFilterValue.label}</span> : <span>{getFilterSQL(dataFilterValue)}</span>}</span>\n                                                <div\n                                                    className={css`\n                                                        margin-left: 0.5rem;\n                                                        cursor: pointer;\n                                                    `}\n                                                    onClick={() => {\n                                                        const data_filters = surroundingDataFilter.filter(e => e !== dataFilterValue) || [];\n                                                        console.log('data_filters', data_filters);\n                                                        setSurroundingDataFilter(data_filters);\n                                                        // setLoc(prev => {\n                                                        //     const searchParams = prev.searchParams;\n                                                        //     searchParams?.set('data_filters', JSON.stringify(data_filters));\n                                                        //     return {\n                                                        //         ...prev,\n                                                        //         searchParams,\n                                                        //     };\n                                                        // });\n                                                    }}\n                                                >\n                                                    <Icon name=\"times\" />\n                                                </div>\n                                            </div>\n                                        }\n                                        color=\"blue\"\n                                    ></Badge>\n                                </div>\n                            </Toggletip>\n                        </div>\n                    );\n                })}\n                <Toggletip\n                    show={open}\n                    closeButton={false}\n                    onOpen={() => {\n                        setOpen(true);\n                    }}\n                    content={\n                        <FilterContent\n                            onHide={() => {\n                                console.log('onHide');\n                                setOpen(false);\n                            }}\n                        />\n                    }\n                    placement=\"bottom\"\n                >\n                    <IconButton name=\"plus\" tooltip=\"Add filter\" style={{ marginLeft: 10 }} />\n                </Toggletip>\n            </div>\n        </DiscoverFilterWrapper>\n    );\n}\n","import { QueryTableDataParams, DataFilterType, SurroundingParams } from 'types/type';\n\nexport function getQueryTableResultSQL(params: QueryTableDataParams) {\n    const indexesStatement = params.indexes_statement;\n    let statement = `SELECT * FROM \\`${params.database}\\`.\\`${params.table}\\` WHERE`;\n\n    if (indexesStatement && params.search_type === 'Search') {\n        statement += ` (${indexesStatement}) AND`;\n    }\n\n    // timeField \n    statement += ` (\\`${params.timeField}\\` BETWEEN '${params.startDate}' AND '${params.endDate}') `;\n\n    statement = params.data_filters.reduce((prev, curr) => {\n        return addSqlFilter(prev, curr);\n    }, statement);\n\n    if (params.search_type === 'SQL' && params.search_value) {\n        statement = statement + ` AND ${params.search_value}`;\n    }\n\n    if (params.search_type === 'Lucene' && params.lucene_where) {\n        statement = statement + ` AND (${params.lucene_where})`;\n    }\n\n    // ORDER BY  timeField \n    statement = statement + ` ORDER BY \\`${params.timeField}\\` DESC LIMIT ${+params.page_size} OFFSET ${(+params?.page - 1) * params.page_size} `;\n\n    return statement;\n}\n\nexport function getQueryTableChartsSQL(params: QueryTableDataParams) {\n    const indexes = params.indexes;\n    let statement = `SELECT ${params.interval}_FLOOR(table_per_time.T,${params.interval_value}) as TT,sum(table_per_time.cnt) FROM (SELECT ${params.interval}_FLOOR(${params.timeField}) as T,count(*) as cnt FROM \\`${params.database}\\`.\\`${params.table}\\` WHERE`;\n    if (indexes && params.search_type === 'Search') {\n        statement += ` (${indexes}) AND`;\n    }\n    statement += ` (\\`${params.timeField}\\` between '${params.startDate}' AND '${params.endDate}') `;\n    if (params.data_filters.length > 0) {\n        statement = params.data_filters.reduce((prev, curr) => {\n            return addSqlFilter(prev, curr);\n        }, statement);\n    }\n    if (params.search_type === 'SQL' && params.search_value) {\n        statement = statement + ` ` + `AND ${params.search_value}`;\n    }\n\n    if (params.search_type === 'Lucene' && params.lucene_where) {\n        statement = statement + ` AND (${params.lucene_where})`;\n    }\n    statement = statement + ` ` + `GROUP BY T ORDER BY T) as table_per_time GROUP BY TT ORDER BY TT`;\n\n    return statement;\n}\n\nexport function getQueryTableResultCountSQL(params: QueryTableDataParams) {\n    const indexes = params.indexes;\n    let statement = `SELECT SUM(table_per_time.cnt) AS total_count\n        FROM (\n          SELECT ${params.interval}_FLOOR(${params.timeField}) as T, COUNT(*) as cnt\n          FROM \\`${params.database}\\`.\\`${params.table}\\`\n          WHERE`;\n    if (indexes && params.search_type === 'Search') {\n        statement += ` (${indexes}) AND`;\n    }\n    statement += ` (\\`${params.timeField}\\` between '${params.startDate}' AND '${params.endDate}')`;\n\n    if (params.data_filters.length > 0) {\n        statement = params.data_filters.reduce((prev, curr) => {\n            return addSqlFilter(prev, curr);\n        }, statement);\n    }\n    if (params.search_type === 'SQL' && params.search_value) {\n        statement = statement + ` ` + `AND ${params.search_value}`;\n    }\n\n    if (params.search_type === 'Lucene' && params.lucene_where) {\n        statement = statement + ` AND (${params.lucene_where})`;\n    }\n    statement = statement + ` ` + `GROUP BY T) AS table_per_time;`;\n    return statement;\n}\n\nexport function getSurroundingSQL(params: SurroundingParams) {\n    let statement = `SELECT * FROM \\`${params.database}\\`.\\`${params.table}\\` WHERE`;\n    statement += ` (\\`${params.timeField}\\` ${params.operator} '${params.time}')`;\n    statement = params.data_filters.reduce((prev: any, curr: any) => {\n        return addSqlFilter(prev, curr);\n    }, statement);\n    const orderSymbol = params.operator === '<' ? 'DESC' : 'ASC';\n    statement = statement + ` ` + `ORDER BY \\`${params.timeField}\\` ${orderSymbol} LIMIT ${+params.pageSize}`;\n    return statement;\n}\n\nexport function getFilterSQL({ fieldName, operator, value }: DataFilterType): string {\n    const valueString = value.map(e => {\n        if (typeof e === 'string') {\n            return `'${e}'`;\n        } else {\n            return e;\n        }\n    });\n\n    const transformedFieldName = transformFieldPath(fieldName);\n\n    if (\n        operator === '=' ||\n        operator === '!=' ||\n        operator === 'like' ||\n        operator === 'not like' ||\n        operator === 'match_all' ||\n        operator === 'match_any' ||\n        operator === 'match_phrase' ||\n        operator === 'match_phrase_prefix'\n    ) {\n        return `${transformedFieldName} ${operator} ${valueString[0]}`;\n    }\n\n    if (operator === 'is null' || operator === 'is not null') {\n        return `${transformedFieldName} ${operator}`;\n    }\n\n    if (operator === 'between' || operator === 'not between') {\n        return `${transformedFieldName} ${operator} ${valueString[0]} AND ${valueString[1]}`;\n    }\n\n    if (operator === 'in' || operator === 'not in') {\n        return `${transformedFieldName} ${operator} ('${valueString}')`;\n    }\n\n    return '';\n}\n\nexport function addSqlFilter(sql: string, dataFilterValue: DataFilterType): string {\n    let result = sql;\n    if (!sql.toUpperCase().includes('WHERE')) {\n        result += ' WHERE';\n    } else {\n        result += ' AND';\n    }\n\n    result += ` (${getFilterSQL(dataFilterValue)})`;\n\n    return result;\n}\n\nexport function transformFieldPath(fieldPath: string): string {\n    const parts = fieldPath.split('.');\n    return (\n        parts[0] +\n        parts\n            .slice(1)\n            .map(part => `['${part}']`)\n            .join('')\n    );\n}\n","import { getBackendSrv } from '@grafana/runtime';\nimport { getQueryTableChartsSQL, getQueryTableResultCountSQL, getQueryTableResultSQL, getSurroundingSQL } from './sql';\n\nexport function getTableDataService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const QueryTableResultSQL = getQueryTableResultSQL(rest);\n    const response = getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getTableData',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: QueryTableResultSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n    return response;\n}\n\nexport function getTableDataChartsService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const QueryTableChartsSQL = getQueryTableChartsSQL(rest);\n    const response = getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getTableDataCharts',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: QueryTableChartsSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n    return response;\n}\n\nexport function getTopDataService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const QueryTableResultSQL = getQueryTableResultSQL(rest);\n    const response = getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getTableTopData',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: QueryTableResultSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n    return response;\n}\n\nexport function getTableDataCountService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const QueryTableResultCountSQL = getQueryTableResultCountSQL(rest);\n    const response = getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getTableCountData',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: QueryTableResultCountSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n    return response;\n}\n\n\nexport function getSurroundingDataService(payload: any) {\n    const { selectdbDS, ...rest } = payload;\n    const surroundingSQL = getSurroundingSQL(rest);\n    const response = getBackendSrv().fetch({\n        url: '/api/ds/query',\n        method: 'POST',\n        data: {\n            queries: [\n                {\n                    refId: 'getSurroundingData',\n                    datasource: {\n                        type: 'mysql',\n                        uid: selectdbDS.uid,\n                    },\n                    rawSql: surroundingSQL,\n                    format: 'table',\n                },\n            ],\n        },\n        credentials: 'include',\n    });\n    return response;\n}\n\n","\nimport { useAtom, useAtomValue } from 'jotai';\nimport { nanoid } from 'nanoid';\nimport { IconButton } from '@grafana/ui';\nimport React from 'react';\nimport { surroundingDataFilterAtom, tableFieldsAtom } from 'store/discover';\nimport { isComplexType } from 'utils/data';\nimport { css } from '@emotion/css';\n\nexport function SurroundingContentTableActions({ fieldName, fieldValue }: any) {\n    console.log(fieldName, fieldValue);\n    // const [selectedSurroundingFields, setSelectedSurroundingFields] = useAtom(surroundingSelectedFieldsAtom);\n    const [surroundingDataFilter, setSurroundingDataFilter] = useAtom(surroundingDataFilterAtom);\n    const tableFields = useAtomValue(tableFieldsAtom);\n    const fieldType = tableFields.find(field => field.Field === fieldName).Type;\n    // const hasField = selectedSurroundingFields.some((item: any) => item.Field === fieldName);\n    // const filterValue = typeof fieldValue === 'object' ? JSON.stringify(fieldValue) : fieldValue;\n    return (\n        <>\n            <div className=\"icons\" style={{ display: 'flex', justifyContent: 'flex-end' }}>\n                {!isComplexType(fieldType) && (\n                    <div\n                        className={css`\n                            display: flex;\n                            align-items: 'center';\n                            margin-left: 10px;\n                        `}\n                    >\n                        <IconButton\n                            name=\"plus-circle\"\n                            onClick={e => {\n                                console.log(e);\n                                setSurroundingDataFilter([...surroundingDataFilter, { fieldName, operator: '=', value: [fieldValue], id: nanoid() }]);\n                                e.stopPropagation();\n                            }}\n                            tooltip=\"Equivalent filtration\"\n                        />\n                        <IconButton\n                            name=\"minus-circle\"\n                            style={{ marginLeft: '4px' }}\n                            onClick={e => {\n                                console.log(e);\n                                setSurroundingDataFilter([\n                                    ...surroundingDataFilter,\n                                    {\n                                        fieldName,\n                                        operator: '!=',\n                                        value: [fieldValue],\n                                        id: nanoid(),\n                                    },\n                                ]);\n                                e.stopPropagation();\n                            }}\n                            tooltip=\"Nonequivalent filtration\"\n                        />\n                    </div>\n                )}\n            </div>\n        </>\n    );\n}\n","'use client';\n\nimport { Row, ColumnDef } from '@tanstack/react-table';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { ColumnStyleWrapper, HoverStyle } from '../discover-content/discover-content.style';\nimport { useAtom, useAtomValue } from 'jotai';\nimport { useRequest } from 'ahooks';\nimport { css } from '@emotion/css';\nimport { SurroundingContentItem } from './surrounding-content-item';\nimport { SurroundingLogsActions } from './logs-actions';\nimport SurroundingDiscoverFilter from './discover-filter';\nimport { Button, IconButton, LoadingBar, Tab, TabContent, TabsBar, useTheme2 } from '@grafana/ui';\nimport { SurroundingParams } from './types';\nimport SDCollapsibleTable from 'components/selectdb-ui/sd-collapsible-table';\nimport {\n    selectedRowAtom,\n    currentTimeFieldAtom,\n    currentClusterAtom,\n    currentTableAtom,\n    currentCatalogAtom,\n    currentDatabaseAtom,\n    surroundingTableDataAtom,\n    selectedDatasourceAtom,\n    afterCountAtom,\n    afterTimeAtom,\n    afterTimeFieldPageSizeAtom,\n    beforeCountAtom,\n    beforeTimeAtom,\n    beforeTimeFieldPageSizeAtom,\n    surroundingDataFilterAtom,\n    surroundingSelectedFieldsAtom,\n} from 'store/discover';\n// import dayjs from 'dayjs';\nimport { get, sortBy } from 'lodash-es';\nimport { getSurroundingDataService } from 'services/discover';\nimport { lastValueFrom } from 'rxjs';\nimport { convertColumnToRow, formatTimestampToDateTime } from 'utils/data';\nimport { generateTableDataUID } from 'utils/utils';\nimport { SurroundingContentTableActions } from './content/content-table-actions';\n\nexport default function SurroundingLogs() {\n    const theme = useTheme2();\n    const selectedRow = useAtomValue(selectedRowAtom);\n    const selectdbDS = useAtomValue(selectedDatasourceAtom);\n    const currentTimeField = useAtomValue(currentTimeFieldAtom);\n    const [selectedSurroundingFields, setSelectedSurroundingFields] = useAtom(surroundingSelectedFieldsAtom);\n    const [surroundingDataFilter] = useAtom<any>(surroundingDataFilterAtom);\n    const hasSelectedFields = selectedSurroundingFields.length > 0;\n    const [fields, setFields] = useState<any[]>([]);\n    const currentCluster = useAtomValue(currentClusterAtom);\n    const currentTable = useAtomValue(currentTableAtom);\n    const currentCatalog = useAtomValue(currentCatalogAtom);\n    const currentDatabase = useAtomValue(currentDatabaseAtom);\n    const [surroundingTableData, setSurroundingTableData] = useAtom(surroundingTableDataAtom);\n    const [beforeCount, setBeforeCount] = useAtom(beforeCountAtom);\n    const [afterCount, setAfterCount] = useAtom(afterCountAtom);\n    const [beforeTimeFieldPageSize, setBeforeTimeFieldPageSize] = useAtom(beforeTimeFieldPageSizeAtom);\n    const [afterTimeFieldPageSize, setAfterTimeFieldPageSize] = useAtom(afterTimeFieldPageSizeAtom);\n    const [beforeTime, setBeforeTime] = useAtom(beforeTimeAtom);\n    const [afterTime, setAfterTime] = useAtom(afterTimeAtom);\n    const [state, updateState] = useState([\n        {\n            label: 'Table',\n            value: 'Table',\n            active: true,\n        },\n        {\n            label: 'JSON',\n            value: 'JSON',\n            active: false,\n        },\n    ]);\n\n    function handleRemove(field: any) {\n        const index = selectedSurroundingFields.findIndex((item: any) => item.Field === field.Field);\n        selectedSurroundingFields.splice(index, 1);\n        setSelectedSurroundingFields([...selectedSurroundingFields]);\n    }\n\n    const getAfterResultWrap = (result: any[]) => {\n        const [_, ...newResult] = result;\n        return newResult;\n    }\n\n    const { loading: getAfterSurroundingDataLoading, run: getAfterSurroundingData } = useRequest(\n        ({ pageSize = afterTimeFieldPageSize, time = afterTime }: any) => {\n            console.log(time);\n            const params: SurroundingParams = getQueryParams({\n                pageSize: pageSize + 1,\n                operator: '>',\n                time,\n            });\n            console.log(params.time);\n\n            return lastValueFrom(\n                getSurroundingDataService({\n                    selectdbDS,\n                    ...params,\n                }),\n            );\n        },\n        {\n            manual: true,\n            onSuccess: async (res: any, params: any) => {\n                if (res.ok) {\n                    const rowsData = convertColumnToRow(res.data.results.getSurroundingData.frames[0]);\n                    const result = getAfterResultWrap(generateSurroundingResult(rowsData, currentTimeField));\n                    let data = [...surroundingTableData];\n                    data.push(...result);\n                    setAfterCount(afterCount + result.length);\n                    setAfterTime(result[result.length - 1]._original[currentTimeField]);\n                    setSurroundingTableData(data);\n                    // setTimeout(() => {\n                    //     scrollToSelectedRow();\n                    // }, 50);\n                }\n            },\n        },\n    );\n\n    function getQueryParams({ pageSize = 5, operator = '>', time = selectedRow.time }: any) {\n        const params: SurroundingParams = {\n            catalog: currentCatalog,\n            database: currentDatabase,\n            table: currentTable,\n            timeField: currentTimeField,\n            time,\n            data_filters: [],\n            pageSize,\n            operator,\n            cluster: currentCluster,\n            theme: theme.isDark ? 'dark' : 'light',\n        };\n        if (surroundingDataFilter.length > 0) {\n            params.data_filters = surroundingDataFilter;\n        }\n        return params;\n    }\n\n    const { loading: getBeforeSurroundingDataLoading, run: getBeforeSurroundingData } = useRequest(\n        ({ pageSize = beforeTimeFieldPageSize, time = selectedRow.time }: any) => {\n            const params: SurroundingParams = getQueryParams({\n                pageSize,\n                operator: '<',\n                time,\n            });\n\n            return lastValueFrom(\n                getSurroundingDataService({\n                    selectdbDS,\n                    ...params,\n                }),\n            );\n        },\n        {\n            manual: true,\n            onSuccess: async (res: any, params: any) => {\n                if (res.ok) {\n                    const rowsData = convertColumnToRow(res.data.results.getSurroundingData.frames[0]);\n                    const result = generateSurroundingResult(rowsData, currentTimeField);\n                    let data = [...surroundingTableData];\n                    data.unshift(...result);\n                    setBeforeCount(beforeCount + result.length);\n                    setBeforeTime(result[0]._original[currentTimeField]);\n                    setSurroundingTableData(data);\n                    // setTimeout(() => {\n                    //     scrollToSelectedRow();\n                    // }, 50);\n                }\n            },\n        },\n    );\n\n    function scrollToSelectedRow() {\n        const selectedElement = document.getElementById('selected');\n        if (selectedElement) {\n            selectedElement.scrollIntoView({ block: 'center', behavior: 'smooth' });\n        }\n    }\n\n    const { loading: initLoading } = useRequest(\n        () => {\n            const prevTimeParams: SurroundingParams = getQueryParams({\n                operator: '<',\n            });\n            const afterTimeParams: SurroundingParams = getQueryParams({\n                operator: '>',\n                pageSize: 6\n            });\n            return Promise.all([\n                lastValueFrom(\n                    getSurroundingDataService({\n                        selectdbDS,\n                        ...prevTimeParams,\n                    }),\n                ),\n                lastValueFrom(\n                    getSurroundingDataService({\n                        selectdbDS,\n                        ...afterTimeParams,\n                    }),\n                ),\n            ]);\n        },\n        {\n            refreshDeps: [surroundingDataFilter],\n            onSuccess: async (res: any) => {\n                if (res[0].ok && res[1].ok) {\n                    const rowsData1 = convertColumnToRow(res[0].data.results.getSurroundingData.frames[0]);\n                    const rowsData2 = convertColumnToRow(res[1].data.results.getSurroundingData.frames[0]);\n                    const result1 = generateSurroundingResult(rowsData1, currentTimeField);\n                    const result2 = getAfterResultWrap(generateSurroundingResult(rowsData2, currentTimeField));\n                    const selectedResult = generateSurroundingResult([selectedRow._original], currentTimeField);\n                    const data = [...result1, ...selectedResult, ...result2];\n                    const rowsDataWithUID = await generateTableDataUID(data);\n\n                    if (result1.length > 0) {\n                        setBeforeCount(result1.length);\n                        setBeforeTime(result1[0]._original[currentTimeField]);\n                    } else {\n                        setBeforeTime(selectedRow.time);\n                    }\n                    if (result2.length > 0) {\n                        setAfterCount(result2.length);\n                        setAfterTime(result2[result2.length - 1]._original[currentTimeField]);\n                    } else {\n                        setAfterTime(selectedRow.time);\n                    }\n                    setSurroundingTableData(rowsDataWithUID);\n                    setTimeout(() => {\n                        scrollToSelectedRow();\n                    }, 50);\n                } else {\n                    // toast.error(res[1].message);\n                }\n            },\n            onError: err => {\n                console.log(err);\n            },\n        },\n    );\n\n    useEffect(() => {\n        const data = surroundingTableData.map(item => {\n            return {\n                _original: item._original,\n                time: item._original?.[currentTimeField] || '',\n                _source: item._source,\n                _uid: item._uid,\n                selected: item._uid === selectedRow._uid,\n            };\n        });\n        setFields(data);\n    }, [surroundingTableData, currentTimeField, selectedRow._uid]);\n\n    const renderBeforeLoadingBar = () => {\n        if (initLoading || getBeforeSurroundingDataLoading) {\n            return (\n                <div\n                    className={css`\n                        position: absolute;\n                        bottom: 0;\n                        left: 0;\n                        width: 100%;\n                    `}\n                >\n                    <LoadingBar width={100} />\n                </div>\n            );\n        }\n        return null;\n    };\n\n    const renderAfterLoadingBar = () => {\n        if (initLoading || getAfterSurroundingDataLoading) {\n            return (\n                <div\n                    className={css`\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        width: 100%;\n                    `}\n                >\n                    <LoadingBar width={100} />\n                </div>\n            );\n        }\n        return null;\n    };\n\n    const renderSubComponent = ({ row }: { row: Row<any> }) => {\n        // processObject copied/adapted from discover-content to normalize stringified JSON inside fields\n        const processObject = (obj: any): any => {\n            if (typeof obj !== 'object' || obj === null) {\n                return obj;\n            }\n\n            const result: any = {};\n            for (const key in obj) {\n                if (obj.hasOwnProperty(key)) {\n                    let value = obj[key];\n\n                    if (typeof value === 'string') {\n                        let cleanValue = value.trim();\n\n                        // check for escaped double quotes\n                        if (cleanValue.includes('\\\\\"')) {\n                            try {\n                                cleanValue = JSON.parse(`\"${cleanValue}\"`);\n                            } catch (e) {\n                                // if parsing fails, keep the original value\n                            }\n                        }\n\n                        // check for JSON\n                        if ((cleanValue.startsWith('{') && cleanValue.endsWith('}')) || (cleanValue.startsWith('[') && cleanValue.endsWith(']'))) {\n                            try {\n                                const parsed = JSON.parse(cleanValue);\n                                value = processObject(parsed);\n                            } catch (e) {\n                                value = obj[key];\n                            }\n                        } else {\n                            value = obj[key];\n                        }\n                    } else if (Array.isArray(value)) {\n                        value = value.map(item => {\n                            if (typeof item === 'string') {\n                                let cleanItem = item.trim();\n\n                                if (cleanItem.includes('\\\\\"')) {\n                                    try {\n                                        cleanItem = JSON.parse(`\"${cleanItem}\"`);\n                                    } catch (e) { }\n                                }\n\n                                if ((cleanItem.startsWith('{') && cleanItem.endsWith('}')) || (cleanItem.startsWith('[') && cleanItem.endsWith(']'))) {\n                                    try {\n                                        const parsed = JSON.parse(cleanItem);\n                                        return processObject(parsed);\n                                    } catch {\n                                        return item;\n                                    }\n                                }\n                                return item;\n                            }\n                            return typeof item === 'object' && item !== null ? processObject(item) : item;\n                        });\n                    } else if (typeof value === 'object' && value !== null) {\n                        value = processObject(value);\n                    }\n\n                    result[key] = value;\n                }\n            }\n            return result;\n        };\n\n        const processedData = processObject(row.original._original);\n\n        const subTableData = Object.keys(processedData).map(key => {\n            return {\n                field: key,\n                value: row.original._original[key],\n            };\n        });\n\n        return (\n            <div\n                className={css`\n                    position: relative;\n                `}\n            >\n                <TabsBar\n                    className={css`\n                        ${theme.isDark ? 'background-color: hsl(var(--n9) / 0.4);' : 'background-color: hsl(var(--b1) / 0.6);'}\n                    `}\n                >\n                    {state.map((tab, index) => {\n                        return (\n                            <Tab\n                                key={index}\n                                label={tab.label}\n                                active={tab.active}\n                                onChangeTab={() =>\n                                    updateState(\n                                        state.map((tab, idx) => ({\n                                            ...tab,\n                                            active: idx === index,\n                                        })),\n                                    )\n                                }\n                                counter={subTableData.length}\n                            />\n                        );\n                    })}\n                </TabsBar>\n                <TabContent>\n                    {state[0].active && (\n                        <table className=\"bg-b1/20 pl-4 backdrop-blur-md dark:bg-n9/60\">\n                            <tbody>\n                                {subTableData.map((item: any) => {\n                                    let fieldValue = item.value;\n                                    const fieldName = item.field;\n                                    if (typeof fieldValue === 'object') {\n                                        fieldValue = JSON.stringify(fieldValue);\n                                    }\n                                    const tableRowStyle = css`\n                                        &:hover {\n                                            .filter-table-content {\n                                                visibility: visible;\n                                            }\n                                        }\n                                    `;\n                                    return (\n                                        <tr className={`${tableRowStyle}`} key={fieldName}>\n                                            <td\n                                                className={css`\n                                                    height: 32px;\n                                                    width: 70px;\n                                                `}\n                                            >\n                                                <div\n                                                    className={`filter-table-content ${css`\n                                                        visibility: hidden;\n                                                    `}`}\n                                                >\n                                                    <SurroundingContentTableActions fieldName={fieldName} fieldValue={fieldValue} />\n                                                </div>\n                                            </td>\n                                            <td className=\"h-8 text-xs\">{fieldName || '-'}</td>\n                                            <td className=\"h-8 whitespace-normal text-xs\">\n                                                <div className=\"w-full break-all\">{fieldValue || '-'}</div>\n                                            </td>\n                                        </tr>\n                                    );\n                                })}\n                            </tbody>\n                        </table>\n                    )}\n                    {state[1].active && (\n                        <div>\n                            <pre\n                                className={css`\n                                    padding: 16px;\n                                    margin: 0;\n                                    overflow-x: auto;\n                                    white-space: pre-wrap;\n                                    word-break: break-all;\n                                    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n                                    font-size: 12px;\n                                    line-height: 1.5;\n                                    ${theme.isDark ? 'background-color: #1e1e1e; color: #d4d4d4;' : 'background-color: #f5f5f5; color: #333;'}\n                                    border-radius: 4px;\n                                    max-height: 400px;\n                                    overflow-y: auto;\n                                `}\n                            >\n                                {JSON.stringify(processedData, null, 2)}\n                            </pre>\n                        </div>\n                    )}\n                </TabContent>\n                {/* Surrounding Logs link is handled by parent (DiscoverContent). No action here. */}\n             </div>\n         );\n     };\n\n     function generateSurroundingResult(result: any, timeField: string) {\n        const sortedResult = sortBy(result, timeField);\n        const _sourceResult = sortedResult.map((item: any) => {\n            let itemSource = '';\n            for (const key in item) {\n                let highlightValue = item[key];\n                //  Variant \n                if (typeof highlightValue === 'object') {\n                    highlightValue = JSON.stringify(highlightValue);\n                }\n                itemSource += `<span style=\"background-color: ${theme.isDark ? '#3F3F4F' : '#BED8FD'\n                    } ; padding: 0px 4px 2px; margin-right: 4px; border-radius: 4px;\">${key}:</span>${highlightValue} `;\n            }\n            return {\n                _original: item,\n                _source: itemSource,\n            };\n        });\n\n        return _sourceResult;\n    }\n\n    const columns = useMemo<Array<ColumnDef<any>>>(() => {\n        let dynamicColumns: Array<ColumnDef<any>> = [\n            {\n                accessorKey: 'collapse',\n                header: ``,\n                cell: ({ row, getValue }) => {\n                    return (\n                        row.getCanExpand() && (\n                            <div>\n                                {row.getIsExpanded() ? (\n                                    <IconButton onClick={row.getToggleExpandedHandler()} name=\"arrow-down\" tooltip=\"Collapse\" />\n                                ) : (\n                                    <IconButton onClick={row.getToggleExpandedHandler()} name=\"arrow-right\" tooltip=\"Expand\" />\n                                )}\n                                <div className=\"ml-1\">{getValue<string>()}</div>\n                            </div>\n                        )\n                    );\n                },\n            },\n            {\n                header: 'Time',\n                accessorKey: 'time',\n                cell: ({ row, getValue }) => {\n                    const fieldValue = getValue<string>();\n                    const fieldName = currentTimeField;\n                    const fieldType = 'DATE';\n                    const timeField = formatTimestampToDateTime(fieldValue);\n                    return (\n                        <div\n                            className={`${css`\n                                width: 230px;\n                            `} ${HoverStyle}`}\n                        >\n                            <div\n                                className={css`\n                                    display: flex;\n                                    align-items: center;\n                                `}\n                            >\n                                {timeField}\n                                <div\n                                    className={`filter-content ${css`\n                                        visibility: hidden;\n                                    `}`}\n                                >\n                                    <SurroundingContentItem fieldName={fieldName} fieldValue={fieldValue} fieldType={fieldType} />\n                                </div>\n                            </div>\n                        </div>\n                    );\n                },\n            },\n        ];\n        if (!hasSelectedFields) {\n            dynamicColumns.push({\n                accessorKey: '_source',\n                header: '_source',\n                cell: ({ row, getValue }) => {\n                    function createMarkup() {\n                        return { __html: getValue<string>() };\n                    }\n                    return (\n                        <div\n                            className={css`\n                                padding-top: 0.5rem;\n                                padding-bottom: 0.5rem;\n                                font-size: 0.875rem;\n                                line-height: 1.25rem;\n                            `}\n                        >\n                            <ColumnStyleWrapper\n                                className={css`\n                                    .field-key {\n                                        background-color: ${theme.isDark ? '#3f3f4f' : 'rgb(191, 217, 253)'};\n                                    }\n                                `}\n                            >\n                                <div\n                                    dangerouslySetInnerHTML={createMarkup()}\n                                    className={css`\n                                        max-height: 12rem;\n                                        overflow: auto;\n                                        word-break: break-all;\n                                        white-space: pre-wrap;\n                                    `}\n                                />\n                            </ColumnStyleWrapper>\n                        </div>\n                    );\n                },\n            });\n        } else {\n            dynamicColumns = [\n                ...dynamicColumns,\n                ...selectedSurroundingFields.map((field: any) => {\n                    return {\n                        accessorKey: field.Field,\n                        header: () => (\n                            <div\n                                className={css`\n                                    display: flex;\n                                    align-items: center;\n                                `}\n                            >\n                                <div>{field.Field}</div>\n                                <IconButton\n                                    name=\"times\"\n                                    tooltip=\"Remove\"\n                                    style={{\n                                        marginLeft: '8px',\n                                        cursor: 'pointer',\n                                        marginTop: '2px',\n                                    }}\n                                    onClick={e => {\n                                        handleRemove(field);\n                                        e.preventDefault();\n                                        e.stopPropagation();\n                                    }}\n                                />\n                            </div>\n                        ),\n                        cell: ({ row, getValue }: any) => {\n                            // let fieldValue = row.original._original[field.Field];\n                            let fieldValue = get(row.original._original, field.Field);\n                            const fieldName = field.Field;\n                            const fieldType = field.Type;\n                            if (typeof fieldValue === 'object') {\n                                fieldValue = JSON.stringify(fieldValue);\n                            }\n                            return (\n                                <div\n                                    className={`${HoverStyle} ${css`\n                                        display: flex;\n                                        align-items: center;\n                                        min-height: 48px;\n                                    `}`}\n                                >\n                                    <div className={`max-h-48 overflow-auto`}>\n                                        <div className=\"flex items-center break-all py-4\">\n                                            {field.value === 'trace_id' && fieldValue ? <Button>{fieldValue}</Button> : <span className=\"text-xs\">{fieldValue}</span>}\n                                        </div>\n                                    </div>\n                                    {\n                                        fieldValue ? <div\n                                            className={`filter-content ${css`\n                                            visibility: hidden;\n                                        `}`}\n                                        >\n                                            <SurroundingContentItem fieldName={fieldName} fieldValue={fieldValue} fieldType={fieldType} />\n                                        </div> : null\n                                    }\n\n                                </div>\n                            );\n                        },\n                    };\n                }),\n            ];\n        }\n        return dynamicColumns;\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [currentTimeField, handleRemove, hasSelectedFields, selectedSurroundingFields]);\n\n    return (\n        <div>\n            <SurroundingDiscoverFilter dataFilter={surroundingDataFilter} />\n            <div className=\"h-[2px] bg-b1 dark:bg-black\" />\n            <div style={{ position: 'relative' }}>\n                <SurroundingLogsActions\n                    getSurroundingData={getBeforeSurroundingData}\n                    getSurroundingDataLoading={getBeforeSurroundingDataLoading}\n                    time={beforeTime}\n                    type=\"before\"\n                    timeFieldPageSize={beforeTimeFieldPageSize}\n                    setTimeFieldPageSize={setBeforeTimeFieldPageSize}\n                    tips=\"Old records\"\n                    count={beforeCount}\n                />\n                {renderBeforeLoadingBar()}\n            </div>\n            <div style={{ height: 'calc(100vh - 220px)', overflow: 'auto', position: 'relative' }}>\n                <div className=\"mx-6 border\">\n                    <SDCollapsibleTable data={fields} columns={columns} getRowCanExpand={() => true} renderSubComponent={renderSubComponent} />\n                </div>\n                {/* {initLoading ? (\n                    <LoadingBar width={100} />\n                ) : (\n                    {renderBeforeLoadingBar}\n                    <div className=\"mx-6 border\">\n                        <SDCollapsibleTable data={fields} columns={columns} getRowCanExpand={() => true} renderSubComponent={renderSubComponent} />\n                    </div>\n                )} */}\n            </div>\n            <div style={{ position: 'relative' }}>\n                {renderAfterLoadingBar()}\n                <SurroundingLogsActions\n                    getSurroundingData={getAfterSurroundingData}\n                    getSurroundingDataLoading={getAfterSurroundingDataLoading}\n                    time={afterTime}\n                    type=\"after\"\n                    timeFieldPageSize={afterTimeFieldPageSize}\n                    setTimeFieldPageSize={setAfterTimeFieldPageSize}\n                    tips={`New records`}\n                    count={afterCount}\n                />\n            </div>\n        </div>\n    );\n}\n","'use client';\nimport { ColumnDef, Row } from '@tanstack/react-table';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useAtom, useAtomValue, useSetAtom } from 'jotai';\nimport { Drawer, IconButton, Pagination, Tab, TabContent, TabsBar, useTheme2 } from '@grafana/ui';\nimport {\n    tableTotalCountAtom,\n    tableDataAtom,\n    selectedFieldsAtom,\n    selectedRowAtom,\n    surroundingTableDataAtom,\n    pageSizeAtom,\n    pageAtom,\n    afterCountAtom,\n    beforeCountAtom,\n    surroundingDataFilterAtom,\n    currentTimeFieldAtom,\n    discoverCurrentAtom,\n    selectedDatasourceAtom,\n    tableFieldsAtom\n} from 'store/discover';\nimport { get } from 'lodash-es';\nimport { Button as AntButton } from 'antd';\nimport SDCollapsibleTable from 'components/selectdb-ui/sd-collapsible-table';\nimport { ColumnStyleWrapper, HoverStyle } from './discover-content.style';\nimport { css } from '@emotion/css';\nimport { ContentTableActions } from './content-table-actions';\nimport { ContentItem } from './content-item';\nimport SurroundingLogs from 'components/surrounding-logs';\nimport TraceDetail from 'components/trace-detail';\nimport { usePluginContext } from '@grafana/data';\nimport type { AppPluginSettings } from 'components/AppConfig/AppConfig';\nimport { formatTimestampToDateTime, isValidTimeFieldType  } from 'utils/data';\n\n\nexport default function DiscoverContent({ fetchNextPage, getTraceData }: { fetchNextPage: (page: number) => void; getTraceData: (traceId: string, table?: string, callback?: Function) => any }) {\n    const theme = useTheme2();\n    const [fields, setFields] = useState<any[]>([]);\n    const tableTotalCount = useAtomValue(tableTotalCountAtom);\n    const [tableData, _setTableData] = useAtom(tableDataAtom);\n    const [selectedFields, setSelectedFields] = useAtom(selectedFieldsAtom);\n    const hasSelectedFields = selectedFields.length > 0;\n    const currentTimeField = useAtomValue(currentTimeFieldAtom);\n    // const [surroundingOpen, setSurroundingOpen] = useState(false);\n    const [selectedRow, setSelectedRow] = useAtom(selectedRowAtom);\n    const setSurroundingTableData = useSetAtom(surroundingTableDataAtom);\n    const setSurroundingDataFilter = useSetAtom(surroundingDataFilterAtom);\n    const setBeforeCount = useSetAtom(beforeCountAtom);\n    const setAfterCount = useSetAtom(afterCountAtom);\n    const [pageSize, _setPageSize] = useAtom(pageSizeAtom);\n    const [page, setPage] = useAtom(pageAtom);\n    const [drawerOpen, setDrawerOpen] = useState(false);\n    const [surroundingLogsOpen, setSurroundingLogsOpen] = useState(false);\n    const [_fieldKeyBg, setFieldKeyBg] = useState<string>('#3f3f4f');\n    const discoverCurrent = useAtomValue(discoverCurrentAtom);\n    const currentDatasource = useAtomValue(selectedDatasourceAtom);\n    const tableFields = useAtomValue(tableFieldsAtom);\n    const context = usePluginContext();\n    // user settings\n    const jsonData = context.meta.jsonData || {};\n    console.log('jsonData',jsonData);\n    \n    const { logsConfig = {} } = jsonData as AppPluginSettings;\n    const { database = \"\", datasource = {}, logsTable = \"\", targetTraceTable = \"\" } = logsConfig;\n    // local input state for page-jump control\n    const [jumpPage, setJumpPage] = useState<string>(String(page));\n\n    useEffect(() => {\n        setJumpPage(String(page));\n    }, [page]);\n\n    const isTargetLogTable = discoverCurrent.table === logsTable && discoverCurrent.database === database && currentDatasource?.id === datasource?.id;\n\n    useEffect(() => {\n        if (theme.isDark) {\n            setFieldKeyBg('#3f3f4f');\n        } else {\n            setFieldKeyBg('rgb(191, 217, 253)');\n        }\n    }, [theme.isDark]);\n\n    const [state, updateState] = useState([\n        {\n            label: 'Table',\n            value: 'Table',\n            active: true,\n        },\n        {\n            label: 'JSON',\n            value: 'JSON',\n            active: false,\n        },\n    ]);\n\n    useEffect(() => {\n        const data = tableData.map(item => {\n            return {\n                _original: item._original,\n                time: item._original?.[currentTimeField] || '',\n                _source: item._source,\n                _uid: item?._uid,\n            };\n        });\n        setFields(data);\n    }, [tableData, currentTimeField]);\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    const handleRemove = React.useCallback(\n        (field: any) => {\n            const index = selectedFields.findIndex((item: any) => item.Field === field.Field);\n            selectedFields.splice(index, 1);\n            setSelectedFields([...selectedFields]);\n        },\n        [selectedFields, setSelectedFields],\n    );\n\n    const renderSubComponent = ({ row }: { row: Row<any> }) => {\n        // process object\n        const processObject = (obj: any): any => {\n            if (typeof obj !== 'object' || obj === null) {\n                return obj;\n            }\n\n            const result: any = {};\n            for (const key in obj) {\n                if (obj.hasOwnProperty(key)) {\n                    let value = obj[key];\n\n                    if (typeof value === 'string') {\n                        let cleanValue = value.trim();\n\n                        // check for escaped double quotes\n                        if (cleanValue.includes('\\\\\"')) {\n                            try {\n                                cleanValue = JSON.parse(`\"${cleanValue}\"`);\n                            } catch (e) {\n                                // if parsing fails, keep the original value\n                            }\n                        }\n\n                        // check for JSON\n                        if ((cleanValue.startsWith('{') && cleanValue.endsWith('}')) || (cleanValue.startsWith('[') && cleanValue.endsWith(']'))) {\n                            try {\n                                const parsed = JSON.parse(cleanValue);\n                                value = processObject(parsed);\n                            } catch (e) {\n                                value = obj[key];\n                            }\n                        } else {\n                            value = obj[key];\n                        }\n                    } else if (Array.isArray(value)) {\n                        value = value.map(item => {\n                            if (typeof item === 'string') {\n                                let cleanItem = item.trim();\n\n                                if (cleanItem.includes('\\\\\"')) {\n                                    try {\n                                        cleanItem = JSON.parse(`\"${cleanItem}\"`);\n                                    } catch (e) { }\n                                }\n\n                                if ((cleanItem.startsWith('{') && cleanItem.endsWith('}')) || (cleanItem.startsWith('[') && cleanItem.endsWith(']'))) {\n                                    try {\n                                        const parsed = JSON.parse(cleanItem);\n                                        return processObject(parsed);\n                                    } catch {\n                                        return item;\n                                    }\n                                }\n                                return item;\n                            }\n                            return typeof item === 'object' && item !== null ? processObject(item) : item;\n                        });\n                    } else if (typeof value === 'object' && value !== null) {\n                        value = processObject(value);\n                    }\n\n                    result[key] = value;\n                }\n            }\n            return result;\n        };\n\n        const processedData = processObject(row.original._original);\n\n        const subTableData = Object.keys(processedData).map(key => {\n            return {\n                field: key,\n                value: row.original._original[key],\n            };\n        });\n        return (\n            <div\n                className={css`\n                    position: relative;\n                `}\n            >\n                <TabsBar\n                    className={css`\n                        ${theme.isDark ? 'background-color: hsl(var(--n9) / 0.4);' : 'background-color: hsl(var(--b1) / 0.6);'}\n                    `}\n                >\n                    {state.map((tab, index) => {\n                        return (\n                            <Tab\n                                key={index}\n                                label={tab.label}\n                                active={tab.active}\n                                onChangeTab={() =>\n                                    updateState(\n                                        state.map((tab, idx) => ({\n                                            ...tab,\n                                            active: idx === index,\n                                        })),\n                                    )\n                                }\n                                counter={subTableData.length}\n                            />\n                        );\n                    })}\n                </TabsBar>\n\n                <TabContent>\n                    {state[0].active && (\n                        <table\n                            // className=\"bg-b1/20 pl-4 backdrop-blur-md dark:bg-n9/60\"\n                            className={css`\n                                padding-left: 16px;\n                                backdrop-filter: blur(12px);\n                                -webkit-backdrop-filter: blur(12px);\n                                width: 100%;\n                                ${theme.isDark ? 'background-color: hsl(var(--n9) / 0.6);' : 'background-color: hsl(var(--b1) / 0.2)'}\n                            `}\n                        >\n                            <tbody>\n                                {subTableData.map((item: any) => {\n                                    let fieldValue = item.value;\n                                    const fieldName = item.field;\n                                    if (typeof fieldValue === 'object') {\n                                        fieldValue = JSON.stringify(fieldValue);\n                                    }\n                                    const tableRowStyle = css`\n                                        &:hover {\n                                            .filter-table-content {\n                                                visibility: visible;\n                                            }\n                                        }\n                                    `;\n                                    return (\n                                        <tr className={`${tableRowStyle}`} key={fieldName}>\n                                            <td\n                                                className={css`\n                                                    height: 32px;\n                                                    width: 70px;\n                                                `}\n                                            >\n                                                <div\n                                                    className={`filter-table-content ${css`\n                                                        visibility: hidden;\n                                                    `}`}\n                                                >\n                                                    <ContentTableActions fieldName={fieldName} fieldValue={fieldValue} />\n                                                </div>\n                                            </td>\n                                            <td\n                                                className={css`\n                                                    height: 32px;\n                                                    font-size: 12px;\n                                                `}\n                                            >\n                                                {fieldName || '-'}\n                                            </td>\n                                            <td\n                                                className={css`\n                                                    height: 32px;\n                                                    font-size: 12px;\n                                                    white-space: normal;\n                                                `}\n                                            >\n                                                <div\n                                                    className={css`\n                                                        width: 100%;\n                                                        word-break: break-all;\n                                                    `}\n                                                >\n                                                    {fieldValue || '-'}\n                                                </div>\n                                            </td>\n                                        </tr>\n                                    );\n                                })}\n                            </tbody>\n                        </table>\n                    )}\n                    {state[1].active && (\n                        <div>\n                            <pre\n                                className={css`\n                                    padding: 16px;\n                                    margin: 0;\n                                    overflow-x: auto;\n                                    white-space: pre-wrap;\n                                    word-break: break-all;\n                                    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n                                    font-size: 12px;\n                                    line-height: 1.5;\n                                    ${theme.isDark ? 'background-color: #1e1e1e; color: #d4d4d4;' : 'background-color: #f5f5f5; color: #333;'}\n                                    border-radius: 4px;\n                                    max-height: 400px;\n                                    overflow-y: auto;\n                                `}\n                            >\n                                {JSON.stringify(processedData, null, 2)}\n                            </pre>\n                        </div>\n                    )}\n                </TabContent>\n                <a\n                    onClick={() => {\n                        console.log('row', row);\n                        setSurroundingLogsOpen(true);\n                        setSelectedRow(row.original);\n                    }}\n                    className={css`\n                        position: absolute;\n                        right: 1rem;\n                        top: 0;\n                        cursor: pointer;\n                        padding-top: 0.5rem;\n                        &:hover {\n                            color: #3D71D9;\n                        }\n                    `}\n                >\n                    Surrounding Logs\n                </a>\n            </div>\n        );\n    };\n\n    const callback = (status: number) => {\n        if (status >= 200 && status <= 299) {\n            setDrawerOpen(true)\n        }\n    }\n\n    const openTraceDrawer = (traceId: string, table?: string) => {\n        // request\n        getTraceData(traceId, table, callback);\n    };\n\n    const columns = useMemo<Array<ColumnDef<any>>>(() => {\n        let dynamicColumns: Array<ColumnDef<any>> = [\n            {\n                accessorKey: 'collapse',\n                header: ``,\n                cell: ({ row, getValue }) => {\n                    return (\n                        row.getCanExpand() && (\n                            <div className=\"flex items-center\">\n                                {row.getIsExpanded() ? (\n                                    <IconButton onClick={row.getToggleExpandedHandler()} name=\"arrow-down\" tooltip=\"Collapse\" />\n                                ) : (\n                                    <IconButton onClick={row.getToggleExpandedHandler()} name=\"arrow-right\" tooltip=\"Expand\" />\n                                )}\n                                <div className=\"ml-1\">{getValue<string>()}</div>\n                            </div>\n                        )\n                    );\n                },\n            },\n            {\n                header: () => currentTimeField || 'Time',\n                accessorKey: 'time',\n                cell: ({ row, getValue }) => {\n                    const fieldValue = getValue<string>();\n                    const fieldName = currentTimeField;\n                    // try to find field type from tableFields\n                    const fieldInfo = tableFields.find((f: any) => f.value === currentTimeField);\n                    const fieldType = fieldInfo?.Type || '';\n                    let timeField: any = fieldValue;\n\n                    // If this field is a valid time field type, try to format it\n                    try {\n                        if (fieldInfo && isValidTimeFieldType(String(fieldInfo.Type).toUpperCase())) {\n                            // if numeric timestamp, convert\n                            const num = Number(fieldValue);\n                            if (!Number.isNaN(num)) {\n                                timeField = formatTimestampToDateTime(num);\n                            } else {\n                                // otherwise keep raw string (or attempt Date parse)\n                                timeField = String(fieldValue || '');\n                            }\n                        }\n                    } catch (e) {\n                        // fallback to raw\n                        timeField = fieldValue;\n                    }\n                     return (\n                         <div\n                             className={`${css`\n                                 width: 240px;\n                             `} ${HoverStyle}`}\n                         >\n                             <div\n                                 className={css`\n                                     display: flex;\n                                     align-items: center;\n                                 `}\n                             >\n                                 {timeField}\n                                 <div\n                                     className={`filter-content ${css`\n                                         visibility: hidden;\n                                     `}`}\n                                 >\n                                     <ContentItem fieldName={fieldName} fieldValue={fieldValue} fieldType={fieldType} />\n                                 </div>\n                             </div>\n                         </div>\n                     );\n                 },\n             },\n        ];\n        if (!hasSelectedFields) {\n            dynamicColumns.push({\n                accessorKey: '_source',\n                header: '_source',\n                cell: ({ row, getValue, ...rest }) => {\n                    const html = getValue<string>();\n                    const handleClick: React.MouseEventHandler<HTMLDivElement> = e => {\n                        const target = e.target as HTMLElement | null;\n                        if (!target) {\n                            return;\n                        }\n\n                        const link = target.closest<HTMLElement>('[data-trace-id]');\n                        if (!link) {\n                            return;\n                        }\n\n                        const traceId = link.getAttribute('data-trace-id');\n                        if (!traceId) {\n                            return;\n                        }\n\n                        e.preventDefault();\n                        if (isTargetLogTable && targetTraceTable) {\n                            openTraceDrawer(traceId, targetTraceTable);\n                        } else {\n                            openTraceDrawer(traceId);\n                        }\n                    };\n\n                    return (\n                        <div\n                            className={css`\n                                padding-top: 0.5rem;\n                                padding-bottom: 0.5rem;\n                                font-size: 0.875rem;\n                                line-height: 1.25rem;\n                            `}\n                        >\n                            <ColumnStyleWrapper\n                                className={css`\n                                    & .field-key {\n                                        background-color: ${theme.isDark ? '#3f3f4f' : 'rgb(191, 217, 253)'};\n                                    }\n                                    & .trace-link {\n                                        cursor: pointer;\n                                        text-decoration: underline;\n                                        color: #3D71D9;\n                                    }\n                                `}\n                            >\n                                <div\n                                    onClick={handleClick}\n                                    dangerouslySetInnerHTML={{ __html: html }}\n                                    className={css`\n                                        max-height: 12rem;\n                                        overflow: auto;\n                                        word-break: break-all;\n                                        white-space: pre-wrap;\n                                    `}\n                                />\n                            </ColumnStyleWrapper>\n                        </div>\n                    );\n                },\n            });\n        } else {\n            dynamicColumns = [\n                ...dynamicColumns,\n                ...selectedFields.map((field: any) => {\n                    return {\n                        accessorKey: field.Field,\n                        header: () => (\n                            <div\n                                className={css`\n                                    display: flex;\n                                    align-items: center;\n                                `}\n                            >\n                                <div>{field.Field}</div>\n                                <IconButton\n                                    name=\"times\"\n                                    tooltip=\"Remove\"\n                                    style={{\n                                        marginLeft: '8px',\n                                        cursor: 'pointer',\n                                        marginTop: '2px',\n                                    }}\n                                    onClick={e => {\n                                        handleRemove(field);\n                                        e.preventDefault();\n                                        e.stopPropagation();\n                                    }}\n                                />\n                            </div>\n                        ),\n                        cell: ({ row, getValue }: any) => {\n                            // let fieldValue = row.original._original[field.Field];\n                            let fieldValue = get(row.original._original, field.Field);\n                            const fieldName = field.Field;\n                            const fieldType = field.Type;\n                            if (typeof fieldValue === 'object') {\n                                fieldValue = JSON.stringify(fieldValue);\n                            }\n                            return (\n                                <div\n                                    className={`${HoverStyle} ${css`\n                                        display: flex;\n                                        align-items: center;\n                                        min-height: 48px;\n                                    `}`}\n                                >\n                                    <div\n                                        className={css`\n                                            max-height: 192px;\n                                            overflow: auto;\n                                        `}\n                                    >\n                                        <div\n                                            className={css`\n                                                display: flex;\n                                                align-items: center;\n                                                padding: 16px 16px 16px 0;\n                                                word-break: break-all;\n                                            `}\n                                        >\n                                            {field.value === 'trace_id' ? <AntButton\n                                                className={css`padding-left: 0px;`}\n                                                onClick={() => {\n                                                    if (isTargetLogTable && targetTraceTable) {\n                                                        openTraceDrawer(fieldValue, targetTraceTable)\n                                                    } else {\n                                                        openTraceDrawer(fieldValue);\n                                                    }\n                                                }}\n                                                type=\"link\">\n                                                {fieldValue}\n                                            </AntButton> : (\n                                                <span\n                                                    className={css`\n                                                        font-size: 12px;\n                                                        white-space: nowrap;\n                                                        text-overflow: ellipsis;\n                                                        overflow: hidden;\n                                                        max-width: 200px;\n                                                    `}\n                                                >\n                                                    {fieldValue}\n                                                </span>\n                                            )}\n                                        </div>\n                                    </div>\n                                    <div\n                                        className={`filter-content ${css`\n                                            visibility: hidden;\n                                        `}`}\n                                    >\n                                        <ContentItem fieldName={fieldName} fieldValue={fieldValue} fieldType={fieldType} />\n                                    </div>\n                                </div>\n                            );\n                        },\n                    };\n                }),\n            ];\n        }\n        return dynamicColumns;\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [currentTimeField, handleRemove, hasSelectedFields, selectedFields, theme.isDark]);\n\n    return (\n        <div\n            className={css`\n                overflow-x: scroll;\n            `}\n        >\n            {/* {\n                loading.getTableDataCharts && <LoadingBar width={100} />\n            } */}\n            <SDCollapsibleTable\n                className={css`\n                    width: 100%;\n                `}\n                data={fields}\n                columns={columns}\n                getRowCanExpand={() => true}\n                renderSubComponent={renderSubComponent}\n            />\n            <div\n                className={css`\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    padding: 0.5rem 1rem;\n                    padding-bottom: 20px;\n                `}\n            >\n                <div>Total {tableTotalCount} rows</div>\n                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\n                    <Pagination\n                        currentPage={page}\n                        numberOfPages={Math.ceil(tableTotalCount / pageSize) || 1}\n                        onNavigate={toPage => {\n                            setPage(toPage);\n                        }}\n                    />\n                    {/* Page jump input */}\n                    <div\n                        className={css`\n                            display: flex;\n                            align-items: center;\n                            gap: 8px;\n                        `}\n                    >\n                        {/* local controlled input for typing page number */}\n                        <input\n                            type=\"number\"\n                            min={1}\n                            step={1}\n                            value={jumpPage}\n                            onChange={e => {\n                                setJumpPage(e.target.value);\n                            }}\n                            onKeyDown={e => {\n                                if (e.key === 'Enter') {\n                                    const num = Number(jumpPage);\n                                    const total = Math.max(Math.ceil(tableTotalCount / pageSize) || 1, 1);\n                                    if (!Number.isNaN(num)) {\n                                        const target = Math.min(Math.max(1, Math.floor(num)), total);\n                                        setPage(target);\n                                        try {\n                                            fetchNextPage && fetchNextPage(target);\n                                        } catch {}\n                                        setJumpPage(String(target));\n                                    } else {\n                                        // reset to current page if invalid\n                                        setJumpPage(String(page));\n                                    }\n                                }\n                            }}\n                            className={css`\n                                width: 72px;\n                                padding: 6px 8px;\n                                border-radius: 4px;\n                                border: 1px solid rgba(0,0,0,0.15);\n                            `}\n                        />\n                        <button\n                            onClick={() => {\n                                const num = Number(jumpPage);\n                                const total = Math.max(Math.ceil(tableTotalCount / pageSize) || 1, 1);\n                                if (!Number.isNaN(num)) {\n                                    const target = Math.min(Math.max(1, Math.floor(num)), total);\n                                    setPage(target);\n                                    try {\n                                        fetchNextPage && fetchNextPage(target);\n                                    } catch {}\n                                    setJumpPage(String(target));\n                                } else {\n                                    setJumpPage(String(page));\n                                }\n                            }}\n                            className={css`\n                                padding: 6px 10px;\n                                border-radius: 4px;\n                                border: 1px solid rgba(0,0,0,0.15);\n                                background: transparent;\n                                cursor: pointer;\n                            `}\n                        >Go</button>\n                     </div>\n                 </div>\n              </div>\n            <TraceDetail onClose={() => setDrawerOpen(false)} open={drawerOpen} traceId={selectedRow?.trace_id} traceTable=\"otel_traces\" />\n\n            {surroundingLogsOpen && (\n                <Drawer\n                    size=\"lg\"\n                    title=\"Surrounding Logs\"\n                    onClose={() => {\n                        setSurroundingTableData([]);\n                        setSurroundingDataFilter([]);\n                        setBeforeCount(0);\n                        setAfterCount(0);\n                        // setSelectedSurroundingFields([]);\n                        setSurroundingLogsOpen(false);\n                    }}\n                >\n                    <SurroundingLogs />\n                </Drawer>\n            )}\n        </div>\n    );\n}\n","import { css } from '@emotion/css';\nimport styled from '@emotion/styled';\n\nexport const DiscoverHeaderSearch = styled.div`\n    flex: 2;\n    display: flex;\n    border-radius: 6px;\n    align-items: center;\n    margin-right: 8px;\n    .ant-select-open {\n        .ant-select-arrow {\n            .anticon {\n                transform: rotate(-180deg);\n            }\n        }\n    }\n    .select-database {\n        width: 160px;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n    }\n    .ant-select-single {\n        height: 30px;\n    }\n`;\n\nexport const DiscoverHeaderTimeSelect = styled.div`\n    flex: 1;\n    display: flex;\n    border-radius: 6px;\n    align-items: center;\n    margin-right: 8px;\n\n    div.trp-time-label {\n        border: 0px;\n    }\n`;\n\nexport const CascaderStyle = css`\n    width: 184px;\n    .ant-select-selector {\n        padding: 0 16px 0 40px !important;\n    }\n    .ant-select-selection-placeholder,\n    .ant-select-selection-item {\n        margin-top: 2px;\n    }\n    .ant-select-selector>.ant-select-selection-search>.ant-select-selection-search-input {\n        margin-left: 1.8rem;\n    }\n`;\n","import { useAtom, useAtomValue, useSetAtom } from 'jotai';\nimport React from 'react';\nimport { currentIndexAtom, disabledOptionsAtom, indexesAtom, searchTypeAtom, searchValueAtom, selectedIndexesAtom } from 'store/discover';\nimport { useTheme2, ActionMeta, Icon, MultiSelect, RadioButtonGroup, Toggletip } from '@grafana/ui';\nimport { css } from '@emotion/css';\nimport { SelectableValue } from '@grafana/data';\nimport { useTranslation } from 'react-i18next';\n\nexport default function SearchType() {\n    const { t } = useTranslation();\n    const [searchType, setSearchType] = useAtom(searchTypeAtom);\n    const setSearchValue = useSetAtom(searchValueAtom);\n    const disabledOptions = useAtomValue(disabledOptionsAtom);\n    const indexes = useAtomValue(indexesAtom);\n    const setSelectedIndexes = useSetAtom(selectedIndexesAtom);\n    const [currentIndex, setCurrentIndex] = useAtom(currentIndexAtom);\n    const searchMode = searchType === 'Search';\n    const theme = useTheme2();\n       \n    const options = [\n        {\n            label: t`Search`,\n            value: 'Search',\n            disabled: indexes.length === 0,\n            tips: t`Discover.SearchType.Search.DisabledText`,\n        },\n        { label: 'SQL', value: 'SQL' },\n        { label: 'Lucene', value: 'Lucene' },\n    ];\n\n    function DropdownQueryType() {\n        return (\n            <div className=\"w-[232px]\">\n                <RadioButtonGroup\n                    options={options}\n                    disabledOptions={disabledOptions}\n                    value={searchType}\n                    onChange={val => {\n                        setSearchType(val as 'Search' | 'SQL' | 'Lucene');\n                        setSearchValue('');\n                    }}\n                />\n                {indexes && searchMode ? (\n                    <div className=\"mt-4\">\n                        <MultiSelect\n                            options={indexes.filter((item: any) => item.type === 'INVERTED')}\n                            value={currentIndex}\n                            onChange={(item: Array<SelectableValue<any>>, actionMeta: ActionMeta) => {\n                                const selectedIndexes: any[] = [];\n                                item.forEach(selectedValue => {\n                                    indexes.forEach((item: any) => {\n                                        if (item.value === selectedValue) {\n                                            selectedIndexes.push(item);\n                                        }\n                                    });\n                                });\n                                setSelectedIndexes(selectedIndexes);\n                                setCurrentIndex(item as any);\n                            }}\n                        />\n                    </div>\n                ) : (\n                    <></>\n                )}\n            </div>\n        );\n    }\n    return (\n        <>\n            <Toggletip closeButton={false} content={<DropdownQueryType />} placement=\"bottom\">\n                <div\n                    className={css`\n                        cursor: pointer;\n                        border: 1px solid rgba(204, 204, 220, 0.2);\n                        width: 80px;\n                        height: 32px;\n                        line-height: 32px;\n                        background-color: ${theme.isDark ? 'rgb(17, 18, 23)' : '#FFF'};\n                        padding-left: 8px;\n                        border-radius: 2px;\n                        display: flex;\n                        justify-content: space-between;\n                    `}\n                >\n                    <span >{searchType}</span>\n                    <span style={{ marginRight: 6 }}>\n                        <Icon name=\"angle-down\" />\n                    </span>\n                </div>\n            </Toggletip>\n        </>\n    );\n}\n","import React, { CSSProperties } from 'react';\nimport { useAtom, useAtomValue } from 'jotai';\n// import { useTranslation } from 'react-i18next';\n// import { SQL_OPERATORS } from 'utils/data';\n// import { cn } from 'utils/tailwind';\nimport {\n  searchTypeAtom,\n  searchValueAtom,\n  // currentTimeFieldAtom,\n} from 'store/discover';\nimport { Input } from '@grafana/ui';\n// import { CodeEditor, CodeEditorSuggestionItem, ReactMonacoEditor } from '@grafana/ui';\n\n\nexport default function SQLSearch({ style, onQuerying }: { style?: CSSProperties; onQuerying: () => void }) {\n  const searchType = useAtomValue(searchTypeAtom);\n  // const setSearchFocus = useSetAtom(searchFocusAtom);\n  // const [tableFields, setTableFields] = useAtom(tableFieldsAtom);\n  const [searchValue, setSearchValue] = useAtom(searchValueAtom);\n  // const currentTimeField = useAtomValue(currentTimeFieldAtom);\n  if (process.env.NODE_ENV !== 'production') {\n    searchValueAtom.debugLabel = 'searchValue';\n  }\n  // const [options, setOptions] = useState<Array<{ value: string; label: string }>>([]);\n  // const inputRef = useRef<any>(null);\n\n  // let disableEnter = false;\n\n  //   const getSuggestions = (): CodeEditorSuggestionItem[] => {\n  //     return [];\n  //   };\n\n  return (\n    <Input\n      value={searchValue}\n      onChange={(e: any) => {\n        console.log(e);\n        setSearchValue(e.target?.value);\n      }}\n      onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => {\n        // Ignore composition (IME) events\n        const native = (e as any).nativeEvent;\n        if (e.key === 'Enter' && !(native && native.isComposing)) {\n          // Trigger query callback if provided\n          try {\n            onQuerying?.();\n          } catch (err) {\n            // swallow errors from callback to avoid breaking the input\n            // eslint-disable-next-line no-console\n            console.error('onQuerying handler error:', err);\n          }\n        }\n      }}\n      placeholder={\n        searchType === 'SQL' ? \"SQL WHERE. e.g.(event_type = 'ForkApplyEvent AND action = 'none')\" : 'Keyword'\n      }\n      style={style}\n    />\n    // <CodeEditor language=\"mysql\" value={searchValue} height={28} width={600} getSuggestions={getSuggestions} showMiniMap={false} showLineNumbers={false} />\n    // <AutoComplete\n    //     className=\"h-8\"\n    //     popupClassName={cn(AutoCompletePopupStyle)}\n    //     options={\n    //         searchType === 'SQL'\n    //             ? options.length > 0\n    //                 ? options\n    //                 : [\n    //                       ...tableFields.map((e: any) => {\n    //                           return { label: e.Field, value: e.Field };\n    //                       }),\n    //                       ...SQL_OPERATORS.map(e => {\n    //                           return { label: e, value: e };\n    //                       }),\n    //                   ]\n    //             : []\n    //     }\n    //     onSelect={value => {\n    //         disableEnter = true;\n    //         const pos = inputRef.current?.input?.selectionStart;\n    //         if (pos !== null && pos !== undefined) {\n    //             const [posL, posR] = getWordPosLR(searchValue, pos - 1);\n    //             let res = '';\n    //             if (posL !== -1) {res += searchValue.substring(0, posL) + ' ';}\n    //             res += value;\n    //             if (posR !== searchValue.length) {res += ' ' + searchValue.substring(posR + 1);}\n    //             setSearchValue(res);\n    //         } else {\n    //             setSearchValue(searchValue + value);\n    //         }\n    //     }}\n    //     value={searchValue}\n    //     onChange={e => {\n    //         setSearchValue(e);\n    //     }}\n    //     onKeyDown={e => {\n    //         if (e.key === 'Enter' && !e.nativeEvent.isComposing && !disableEnter) {\n    //             if (currentTimeField) {\n    //                 onQuerying();\n    //             } else {\n    //                 message.warning(t`Discover.SQLSearch.NoTimeField.Tips`);\n    //             }\n    //         }\n    //     }}\n    //     filterOption={(inputValue, option) => {\n    //         const pos = inputRef.current?.input?.selectionStart;\n    //         if (pos !== null && pos !== undefined) {\n    //             const [posL, posR] = getWordPosLR(searchValue, pos - 1);\n    //             const str = inputValue.substring(posL + 1, posR);\n    //             return option?.value.toUpperCase().indexOf(str.toUpperCase()) !== -1;\n    //         }\n    //         const inputArr = inputValue.split(' ');\n    //         const value = inputArr[inputArr.length - 1];\n    //         return option?.value.toUpperCase().indexOf(value.toUpperCase()) !== -1;\n    //     }}\n    //     style={style}\n    // >\n    //     <Input\n    //         onBlur={() => setSearchFocus(false)}\n    //         onFocus={() => setSearchFocus(true)}\n    //         className=\"-mt-[2px] h-[32px] border-none hover:placeholder:text-n1 focus:placeholder:text-n6\"\n    //         ref={inputRef}\n    //         placeholder={searchType === 'SQL' ? \"SQL WHERE. e.g.(event_type = 'ForkApplyEvent AND action = 'none')\" : 'Keyword'}\n    //     />\n    // </AutoComplete>\n  );\n}\n","import React from 'react';\nimport { useAtom } from 'jotai';\nimport { searchValueAtom } from 'store/discover';\nimport { Input } from '@grafana/ui';\n\nexport default function Lucene({ onQuerying }: { onQuerying?: () => void }) {\n    const [searchValue, setSearchValue] = useAtom(searchValueAtom);\n    if (process.env.NODE_ENV !== 'production') {\n        searchValueAtom.debugLabel = 'searchValue';\n    }\n\n    return (\n        <Input\n            value={searchValue}\n            onChange={(e: any) => {\n                console.log(e);\n                setSearchValue(e.target?.value);\n            }}\n            onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => {\n                const native = (e as any).nativeEvent;\n                if (e.key === 'Enter' && !(native && native.isComposing)) {\n                    try {\n                        onQuerying?.();\n                    } catch (err) {\n                        // eslint-disable-next-line no-console\n                        console.error('onQuerying handler error:', err);\n                    }\n                }\n            }}\n            placeholder=\"usage: field:value AND field2:value2\"\n        />\n    );\n}\n","'use client';\nimport React, { PropsWithChildren, useEffect } from 'react';\nimport dayjs from 'dayjs';\nimport { DiscoverHeaderSearch } from './discover-header.style';\nimport SearchType from './search-type';\nimport SQLSearch from './sql-search';\nimport { useAtom, useAtomValue, useSetAtom } from 'jotai';\nimport { DataSourcePicker } from '@grafana/runtime';\nimport { css } from '@emotion/css';\nimport {\n    indexesAtom,\n    searchTypeAtom,\n    discoverCurrentAtom,\n    locationAtom,\n    // currentClusterAtom,\n    tableFieldsAtom,\n    timeFieldsAtom,\n    currentDateAtom,\n    currentTimeFieldAtom,\n    currentIndexAtom,\n    searchFocusAtom,\n    activeShortcutAtom,\n    datasourcesAtom,\n    selectedDatasourceAtom,\n    timeRangeAtom,\n    databasesAtom,\n    tablesAtom,\n    currentTableAtom,\n} from 'store/discover';\nimport { getLatestTime, isValidTimeFieldType } from 'utils/data';\nimport { Select, Field, Button, useTheme2, TimeRangeInput } from '@grafana/ui';\nimport { FORMAT_DATE } from '../../constants';\nimport { getDatabases, getFieldsService, getIndexesService, getTablesService } from 'services/metaservice';\nimport { Subscription } from 'rxjs';\nimport { toDataFrame } from '@grafana/data';\nimport Lucene from './lucene';\n\nexport default function DiscoverHeader(\n    props: PropsWithChildren & {\n        onQuerying: () => void;\n        loading: boolean;\n    },\n) {\n    // const catalog = 'internal';\n    // const catalogs = useAtomValue(catalogAtom);\n    const setIndexes = useSetAtom(indexesAtom);\n    // const setSearchType = useSetAtom(searchTypeAtom);\n    const [discoverCurrent, setDiscoverCurrent] = useAtom(discoverCurrentAtom);\n    if (process.env.NODE_ENV !== 'production') {\n        discoverCurrentAtom.debugLabel = 'current';\n    }\n    const [_loc, setLoc] = useAtom(locationAtom);\n    // const [currentCluster, setCurrentCluster] = useAtom(currentClusterAtom);\n    const setTableFields = useSetAtom(tableFieldsAtom);\n    const [timeFields, setTimeFields] = useAtom(timeFieldsAtom);\n    const [_currentDate, setCurrentDate] = useAtom(currentDateAtom);\n    const currentTimeField = useAtomValue(currentTimeFieldAtom);\n    const [, setCurrentIndex] = useAtom(currentIndexAtom);\n    const searchFocus = useAtomValue(searchFocusAtom);\n    // const { databaseList } = useDatabaseList();\n    const [activeItem, _setActiveItem] = useAtom(activeShortcutAtom);\n    // const [clusters, setClusters] = useState<any[]>([]);\n    // const database = loc.searchParams?.get('database');\n    // const table = loc.searchParams?.get('table');\n    // const cluster = loc.searchParams?.get('cluster');\n    // const startTime = loc.searchParams?.get('startTime');\n    // const endTime = loc.searchParams?.get('endTime');\n    const [selectedDatasource, setSelectedDatasource] = useAtom(selectedDatasourceAtom);\n    const [timeRange, setTimeRange] = useAtom(timeRangeAtom);\n    const [currentTable, setCurrentTable] = useAtom(currentTableAtom);\n    const [databases, setDatabases] = useAtom(databasesAtom);\n    const [tables, setTables] = useAtom(tablesAtom);\n    const [_datasources] = useAtom(datasourcesAtom);\n    const searchType = useAtomValue(searchTypeAtom);\n    const searchMode = searchType === 'Search';\n\n    const selectdbDS = useAtomValue(selectedDatasourceAtom);\n    const theme = useTheme2();\n\n    const fetchDatabases = React.useCallback((ds: any) => {\n        if (!ds) {\n            return undefined;\n        }\n\n        return getDatabases(ds).subscribe({\n            next: (resp: any) => {\n                const { data, ok } = resp;\n                if (ok) {\n                    const frame = toDataFrame(data.results.getDatabases.frames[0]);\n                    const values = Array.from(frame.fields[0].values);\n                    const options = values.map((item: string) => ({ label: item, value: item }));\n                    setDatabases(options);\n                }\n            },\n            error: (err: any) => console.log('Fetch Error', err),\n        });\n    }, [setDatabases]);\n\n    useEffect(() => {\n        if (!selectdbDS) {\n            return;\n        }\n\n        const subscription: Subscription | undefined = fetchDatabases(selectdbDS);\n\n        return () => subscription?.unsubscribe();\n    }, [selectdbDS, fetchDatabases]);\n\n    function getFields(selectedTable: any) {\n        getFieldsService({\n            selectdbDS,\n            database: discoverCurrent.database,\n            table: selectedTable.value,\n        }).subscribe({\n            next: ({ data, ok }: any) => {\n                if (ok) {\n                    const frame = toDataFrame(data.results.getFields.frames[0]);\n                    console.log('frame', frame);\n                    const values = Array.from(frame.fields[0].values);\n                    const fieldTypes = Array.from(frame.fields[1].values);\n\n                    const tableFields = values.map((item: any, index: number) => {\n                        return {\n                            label: item,\n                            Field: item,\n                            value: item,\n                            Type: fieldTypes[index],\n                        };\n                    });\n\n                    setTableFields(tableFields);\n\n                    if (values) {\n                        const options = values\n                            .filter((field: any, index: number) => {\n                                return isValidTimeFieldType(fieldTypes[index].toUpperCase());\n                            })\n                            .map((item: any) => {\n                                return {\n                                    label: item,\n                                    value: item,\n                                };\n                            });\n                            console.log('bbb,',discoverCurrent);\n                            \n                        setDiscoverCurrent({\n                            ...discoverCurrent,\n                            table: selectedTable.value,\n                            timeField: options[0]?.value || '',\n                        });\n                        setTimeFields(options);\n                    }\n                }\n            },\n            error: (err: any) => {\n                console.log('Fetch Error', err);\n            },\n        });\n    }\n\n    function getIndexes(selectedTable: any) {\n        getIndexesService({\n            selectdbDS,\n            database: discoverCurrent.database,\n            table: selectedTable.value,\n        }).subscribe({\n            next: ({ data, ok }: any) => {\n                if (ok) {\n                    const frame = toDataFrame(data.results.getIndexes.frames[0]);\n                    const values = Array.from(frame.fields[2].values);\n                    const columnNames = Array.from(frame.fields[4].values);\n                    const indexesTypes = Array.from(frame.fields[10].values);\n\n                    if (!values || values.length === 0) {\n                        setIndexes([]);\n                        setCurrentIndex([]);\n                        return;\n                    }\n\n                    const tableIndexes = values?.map((item: any, index: number) => {\n                        return {\n                            label: item,\n                            value: item,\n                            type: indexesTypes[index],\n                            columnName: columnNames[index],\n                        };\n                    });\n\n                    setIndexes(tableIndexes);\n\n                    if (tableIndexes) {\n                        setCurrentIndex(tableIndexes);\n                    }\n                }\n            },\n            error: (err: any) => {\n                console.log('Fetch Error', err);\n            },\n        });\n    }\n\n    return (\n        <div\n            className={css`\n                padding: 1rem;\n                padding-top: 1.5rem;\n                background-color: ${theme.isDark ? 'rgb(24, 27, 31)' : '#FFF'};\n                display: flex;\n                border-radius: 0.25rem 0.25rem 0 0;\n            `}\n        >\n            <DiscoverHeaderSearch className=\"h-8 rounded border border-solid border-n9 dark:border-n7\">\n                <Field label=\"Datasource\">\n                    {/* filter  */}\n                    <DataSourcePicker\n                         width={20}\n                         type={'mysql'}\n                         current={selectedDatasource}\n                         placeholder=\"Choose\"\n                         noDefault\n                         filter={ds => ds.type === 'mysql'}\n                         onChange={item => {\n                             console.log('item', item);\n                             setSelectedDatasource(item);\n                             // Always fetch databases even if the same datasource is selected\n                             fetchDatabases(item);\n                         }}\n                     />\n                 </Field>\n                {/*  */}\n                <Field label=\"Database\" style={{ marginLeft: 8 }}>\n                    <Select\n                        width={15}\n                        options={databases}\n                        value={discoverCurrent.database}\n                        onChange={(selectedDatabase: any) => {\n                            setDiscoverCurrent({\n                                ...discoverCurrent,\n                                database: selectedDatabase.value,\n                            });\n                            getTablesService({\n                                selectdbDS,\n                                database: selectedDatabase.value,\n                            }).subscribe({\n                                next: (resp: any) => {\n                                    const { data, ok } = resp;\n                                    if (ok) {\n                                        const frame = toDataFrame(data.results.getTables.frames[0]);\n                                        const values = Array.from(frame.fields[0].values);\n                                        const options = values.map((item: string) => ({ label: item, value: item }));\n                                        setTables(options);\n                                    }\n                                },\n                                error: (err: any) => console.log('Fetch Error', err),\n                            });\n                        }}\n                    ></Select>\n                </Field>\n\n                <Field label=\"Table\" style={{ marginLeft: 8 }}>\n                    <Select\n                        options={tables}\n                        width={15}\n                        value={currentTable}\n                        onChange={(selectedTable: any) => {\n                            console.log('selectedTable.value',selectedTable.value);\n                            \n                            setDiscoverCurrent({\n                                ...discoverCurrent,\n                                table: selectedTable.value,\n                            });\n                            setCurrentTable(selectedTable.value);\n                            getFields(selectedTable);\n                            getIndexes(selectedTable);\n                        }}\n                    />\n                </Field>\n                <Field label=\"Mode\" style={{ marginLeft: 8, marginRight: 8, width: '120px' }}>\n                    <SearchType />\n                </Field>\n                {searchType === 'Lucene' ? (\n                    <Field label=\"Lucene\" style={{ width: '100%' }}>\n                        <Lucene onQuerying={() => props?.onQuerying()} />\n                    </Field>\n                ) : (\n                    <Field label={searchMode ? 'Search' : 'SQL'} style={{ width: '100%' }}>\n                        <SQLSearch\n                            style={{ flex: '1' }}\n                            onQuerying={() => {\n                                props?.onQuerying();\n                            }}\n                        />\n                    </Field>\n                )}\n            </DiscoverHeaderSearch>\n            {!searchFocus && (\n                <>\n                    <Field label=\"Time Field\">\n                        <Select\n                            value={currentTimeField}\n                            options={timeFields}\n                            onChange={(selectdbTimeFiled: any) => {\n                                setDiscoverCurrent({\n                                    ...discoverCurrent,\n                                    timeField: selectdbTimeFiled.value,\n                                });\n                                setLoc((prev: any) => {\n                                    const searchParams = prev.searchParams;\n                                    searchParams?.set('timeField', selectdbTimeFiled.value);\n                                    return {\n                                        ...prev,\n                                        searchParams,\n                                    };\n                                });\n                            }}\n                            placeholder={'Time Field'}\n                        />\n                    </Field>\n                    <Field label=\"Time Range\" style={{ marginLeft: 8, marginRight: 8 }}>\n                        <TimeRangeInput\n                            isReversed={false}\n                            onChange={timeRange => {\n                                const start = dayjs(timeRange.from.toDate());\n                                const end = dayjs(timeRange.to.toDate());\n                                setLoc(prev => {\n                                    const searchParams = prev.searchParams;\n                                    searchParams?.set('startTime', start.format(FORMAT_DATE));\n                                    searchParams?.set('endTime', end.format(FORMAT_DATE));\n                                    return {\n                                        ...prev,\n                                        searchParams,\n                                    };\n                                });\n                                setCurrentDate([start, end]);\n                                setTimeRange(timeRange);\n                            }}\n                            value={timeRange}\n                        />\n                    </Field>\n                </>\n            )}\n            <Field label=\"\">\n                <Button\n                    onClick={() => {\n                        const latestTime = getLatestTime(activeItem?.key as string);\n                        if (latestTime) {\n                            const [latestStartTime, latestEndTime] = latestTime;\n                            setLoc(prev => {\n                                const searchParams = prev.searchParams;\n                                searchParams?.set('startTime', dayjs(latestStartTime).format(FORMAT_DATE));\n                                searchParams?.set('endTime', dayjs(latestEndTime).format(FORMAT_DATE));\n                                return {\n                                    ...prev,\n                                    searchParams,\n                                };\n                            });\n                        }\n                        props?.onQuerying();\n                    }}\n                    variant=\"primary\"\n                    className=\"h-8\"\n                    icon={props?.loading ? 'fa fa-spinner' : 'sync'}\n                    disabled={!currentTimeField}\n                >\n                    {`Query`}\n                </Button>\n            </Field>\n        </div>\n    );\n}\n","export function encodeSpecialTokens(query: string): string {\n    return query\n        .replace(/\\\\\\\\/g, 'HDX_BACKSLASH_LITERAL')\n        .replace('http://', 'http_COLON_//')\n        .replace('https://', 'https_COLON_//')\n        .replace(/localhost:(\\d{1,5})/, 'localhost_COLON_$1')\n        .replace(/\\\\:/g, 'HDX_COLON');\n}\n\nexport function decodeSpecialTokens(query: string): string {\n    return query\n        .replace(/\\\\\"/g, '\"')\n        .replace(/HDX_BACKSLASH_LITERAL/g, '\\\\')\n        .replace('http_COLON_//', 'http://')\n        .replace('https_COLON_//', 'https://')\n        .replace(/localhost_COLON_(\\d{1,5})/, 'localhost:$1')\n        .replace(/HDX_COLON/g, ':');\n}\n","export const IMPLICIT_FIELD = '<implicit>';\n\nexport const CLICK_HOUSE_JSON_NUMBER_TYPES = [\n    'Int8',\n    'Int16',\n    'Int32',\n    'Int64',\n    'Int128',\n    'Int256',\n    'UInt8',\n    'UInt16',\n    'UInt32',\n    'UInt64',\n    'UInt128',\n    'UInt256',\n    'Float32',\n    'Float64',\n];\n","type Primitive = string | number | boolean | bigint | null | undefined | Date;\n\ntype RawSql = {\n    __raw: true;\n    value: string;\n};\n\nconst RAW_FLAG = '__raw';\n\nconst escapeString = (value: string): string => {\n    const escaped = value.replace(/\\\\/g, '\\\\\\\\').replace(/'/g, \"\\\\'\");\n    return `'${escaped}'`;\n};\n\nconst formatDate = (value: Date): string => {\n    const pad = (input: number) => input.toString().padStart(2, '0');\n    const year = value.getFullYear();\n    const month = pad(value.getMonth() + 1);\n    const day = pad(value.getDate());\n    const hours = pad(value.getHours());\n    const minutes = pad(value.getMinutes());\n    const seconds = pad(value.getSeconds());\n\n    return `'${year}-${month}-${day} ${hours}:${minutes}:${seconds}'`;\n};\n\nconst escapePrimitive = (value: Primitive | RawSql): string => {\n    if (isRaw(value)) {\n        return value.value;\n    }\n\n    if (value === null || value === undefined) {\n        return 'NULL';\n    }\n\n    if (value instanceof Date) {\n        return formatDate(value);\n    }\n\n    switch (typeof value) {\n        case 'number':\n        case 'bigint':\n            return `${value}`;\n        case 'boolean':\n            return value ? '1' : '0';\n        default:\n            return escapeString(String(value));\n    }\n};\n\nconst escapeIdentifier = (identifier: string | RawSql): string => {\n    if (isRaw(identifier)) {\n        return identifier.value;\n    }\n\n    return identifier\n        .split('.')\n        .map(part => {\n            if (part === '*') {\n                return '*';\n            }\n            return `\\`${part.replace(/`/g, '``')}\\``;\n        })\n        .join('.');\n};\n\nconst escapeValue = (value: any): string => {\n    if (isRaw(value)) {\n        return value.value;\n    }\n\n    if (Array.isArray(value)) {\n        const list = value.map(item => escapeValue(item));\n        return `(${list.join(', ')})`;\n    }\n\n    if (value && typeof value === 'object' && !(value instanceof Date)) {\n        return escapeString(JSON.stringify(value));\n    }\n\n    return escapePrimitive(value as Primitive);\n};\n\nconst isRaw = (value: unknown): value is RawSql => Boolean(value && typeof value === 'object' && RAW_FLAG in (value as any));\n\nconst format = (sql: string, values?: any[]): string => {\n    if (!values || values.length === 0) {\n        return sql;\n    }\n\n    let index = 0;\n\n    return sql.replace(/\\?\\?|\\?/g, placeholder => {\n        if (index >= values.length) {\n            return placeholder;\n        }\n\n        const value = values[index++];\n\n        if (placeholder === '??') {\n            if (Array.isArray(value)) {\n                return value.map(v => escapeIdentifier(v)).join(', ');\n            }\n            return escapeIdentifier(value);\n        }\n\n        return escapeValue(value);\n    });\n};\n\nconst raw = (value: string): RawSql => ({\n    __raw: true,\n    value,\n});\n\nconst SqlString = {\n    format,\n    raw,\n};\n\nexport default SqlString;\n","export enum JSDataType {\n    Array = 'array',\n    Date = 'date',\n    Map = 'map',\n    Number = 'number',\n    String = 'string',\n    Tuple = 'tuple',\n    Bool = 'bool',\n    JSON = 'json',\n    Dynamic = 'dynamic', // json type will store anything as Dynamic type by default\n}\n\nexport const convertCHDataTypeToJSType = (dataType: string): JSDataType | null => {\n    if (dataType.startsWith('Date')) {\n        return JSDataType.Date;\n    } else if (dataType.startsWith('Tuple')) {\n        return JSDataType.Tuple;\n    } else if (dataType.startsWith('Map')) {\n        return JSDataType.Map;\n    } else if (dataType.startsWith('Array')) {\n        return JSDataType.Array;\n    } else if (\n        dataType.startsWith('Int') ||\n        dataType.startsWith('UInt') ||\n        dataType.startsWith('Float') ||\n        // Nullable types are possible (charts)\n        dataType.startsWith('Nullable(Int') ||\n        dataType.startsWith('Nullable(UInt') ||\n        dataType.startsWith('Nullable(Float')\n    ) {\n        return JSDataType.Number;\n    } else if (\n        dataType.startsWith('String') ||\n        dataType.startsWith('FixedString') ||\n        dataType.startsWith('Enum') ||\n        dataType.startsWith('UUID') ||\n        dataType.startsWith('IPv4') ||\n        dataType.startsWith('IPv6')\n    ) {\n        return JSDataType.String;\n    } else if (dataType === 'Bool') {\n        return JSDataType.Bool;\n    } else if (dataType.startsWith('JSON')) {\n        return JSDataType.JSON;\n    } else if (dataType.startsWith('Dynamic')) {\n        return JSDataType.Dynamic;\n    } else if (dataType.startsWith('LowCardinality')) {\n        return convertCHDataTypeToJSType(dataType.slice(15, -1));\n    }\n\n    return null;\n};\n\nexport const convertCHTypeToPrimitiveJSType = (dataType: string) => {\n    const jsType = convertCHDataTypeToJSType(dataType);\n\n    if (jsType === JSDataType.Map || jsType === JSDataType.Array || jsType === JSDataType.Tuple) {\n        throw new Error('Map, Array or Tuple type is not a primitive type');\n    } else if (jsType === JSDataType.Date) {\n        return JSDataType.Number;\n    }\n\n    return jsType;\n};\n","// Replace splitAndTrimCSV, should remove splitAndTrimCSV later\nexport function splitAndTrimWithBracket(input: string): string[] {\n    let parenCount = 0;\n    let squareCount = 0;\n    let inSingleQuote = false;\n    let inDoubleQuote = false;\n\n    const res: string[] = [];\n    let cur = '';\n    for (const c of input + ',') {\n        if (c === '\"' && !inSingleQuote) {\n            inDoubleQuote = !inDoubleQuote;\n            cur += c;\n            continue;\n        }\n\n        if (c === \"'\" && !inDoubleQuote) {\n            inSingleQuote = !inSingleQuote;\n            cur += c;\n            continue;\n        }\n        // Only count brackets when not in quotes\n        if (!inSingleQuote && !inDoubleQuote) {\n            if (c === '(') {\n                parenCount++;\n            } else if (c === ')') {\n                parenCount--;\n            } else if (c === '[') {\n                squareCount++;\n            } else if (c === ']') {\n                squareCount--;\n            }\n        }\n\n        if (c === ',' && parenCount === 0 && squareCount === 0 && !inSingleQuote && !inDoubleQuote) {\n            const trimString = cur.trim();\n            if (trimString) {\n                res.push(trimString)\n            };\n            cur = '';\n        } else {\n            cur += c;\n        }\n    }\n    return res;\n}\n","// @ts-ignore: no type declarations for '@hyperdx/lucene'\nimport lucene from '@hyperdx/lucene';\nimport SqlString from './sqlstring-browser';\nimport { getColumn as getColumnMetadata, getInvertedIndexColumns } from '../../services/metaservice';\nimport { convertCHTypeToPrimitiveJSType, JSDataType } from './enums';\nimport { splitAndTrimWithBracket } from './utils';\nimport { CLICK_HOUSE_JSON_NUMBER_TYPES, IMPLICIT_FIELD } from './constants';\n\nexport type ColumnLookup = {\n    name: string;\n    type: string;\n    dataType?: string;\n    columnType?: string;\n};\n\nexport type LegacyMetadataProvider = {\n    getColumn: (params: {\n        databaseName: string;\n        tableName: string;\n        column: string;\n        connectionId: string;\n    }) => Promise<{ name: string; type: string } | null>;\n};\n\ntype ImplicitTextSearchTarget = {\n    column: string;\n    sourceColumn: string;\n    propertyType?: JSDataType;\n    supportsTextSearch?: boolean;\n};\n\nexport interface Serializer {\n    operator(op: lucene.Operator): string;\n    eq(field: string, term: string, isNegatedField: boolean): Promise<string>;\n    isNotNull(field: string, isNegatedField: boolean): Promise<string>;\n    gte(field: string, term: string): Promise<string>;\n    lte(field: string, term: string): Promise<string>;\n    lt(field: string, term: string): Promise<string>;\n    gt(field: string, term: string): Promise<string>;\n    fieldSearch(\n        field: string,\n        term: string,\n        isNegatedField: boolean,\n        prefixWildcard: boolean,\n        suffixWildcard: boolean,\n        isPhrase: boolean,\n    ): Promise<string>;\n    range(field: string, start: string, end: string, isNegatedField: boolean): Promise<string>;\n}\n\nexport class EnglishSerializer implements Serializer {\n    private translateField(field: string) {\n        if (field === IMPLICIT_FIELD) {\n            return 'event';\n        }\n\n        return `'${field}'`;\n    }\n\n    operator(op: lucene.Operator) {\n        switch (op) {\n            case 'NOT':\n            case 'AND NOT':\n                return 'AND NOT';\n            case 'OR NOT':\n                return 'OR NOT';\n            // @ts-ignore TODO: Types need to be fixed upstream\n            case '&&':\n            case '<implicit>':\n            case 'AND':\n                return 'AND';\n            // @ts-ignore TODO: Types need to be fixed upstream\n            case '||':\n            case 'OR':\n                return 'OR';\n            default:\n                throw new Error(`Unexpected operator. ${op}`);\n        }\n    }\n\n    async eq(field: string, term: string, isNegatedField: boolean) {\n        return `${this.translateField(field)} ${isNegatedField ? 'is not' : 'is'} ${term}`;\n    }\n\n    async isNotNull(field: string, isNegatedField: boolean) {\n        return `${this.translateField(field)} ${isNegatedField ? 'is null' : 'is not null'}`;\n    }\n\n    async gte(field: string, term: string) {\n        return `${this.translateField(field)} is greater than or equal to ${term}`;\n    }\n\n    async lte(field: string, term: string) {\n        return `${this.translateField(field)} is less than or equal to ${term}`;\n    }\n\n    async lt(field: string, term: string) {\n        return `${this.translateField(field)} is less than ${term}`;\n    }\n\n    async gt(field: string, term: string) {\n        return `${this.translateField(field)} is greater than ${term}`;\n    }\n\n    async fieldSearch(\n        field: string,\n        term: string,\n        isNegatedField: boolean,\n        prefixWildcard: boolean,\n        suffixWildcard: boolean,\n        isPhrase: boolean,\n    ) {\n        if (field === IMPLICIT_FIELD) {\n            return `${this.translateField(field)} ${\n                prefixWildcard && suffixWildcard\n                    ? isNegatedField\n                        ? 'does not contain'\n                        : 'contains'\n                    : prefixWildcard\n                      ? isNegatedField\n                          ? 'does not end with'\n                          : 'ends with'\n                      : suffixWildcard\n                        ? isNegatedField\n                            ? 'does not start with'\n                            : 'starts with'\n                        : isNegatedField\n                          ? 'does not have whole word'\n                          : 'has whole word'\n            } ${term}`;\n        }\n\n        return `${this.translateField(field)} ${isNegatedField ? 'does not contain' : 'contains'} ${term}`;\n    }\n\n    async range(field: string, start: string, end: string, isNegatedField: boolean) {\n        return `${field} ${isNegatedField ? 'is not' : 'is'} between ${start} and ${end}`;\n    }\n}\n\nexport abstract class SQLSerializer implements Serializer {\n    private NOT_FOUND_QUERY = '(1 = 0)';\n\n    abstract getColumnForField(field: string): Promise<{\n        column?: string;\n        columnJSON?: { string: string; number: string };\n        propertyType?: JSDataType;\n        supportsTextSearch?: boolean;\n        sourceColumn?: string;\n        implicitTargets?: ImplicitTextSearchTarget[];\n        found: boolean;\n    }>;\n\n    operator(op: lucene.Operator) {\n        switch (op) {\n            case 'NOT':\n            case 'AND NOT':\n                return 'AND NOT';\n            case 'OR NOT':\n                return 'OR NOT';\n            // @ts-ignore TODO: Types need to be fixed upstream\n            case '&&':\n            case '<implicit>':\n            case 'AND':\n                return 'AND';\n            // @ts-ignore TODO: Types need to be fixed upstream\n            case '||':\n            case 'OR':\n                return 'OR';\n            default:\n                throw new Error(`Unexpected operator. ${op}`);\n        }\n    }\n\n    async eq(field: string, term: string, isNegatedField: boolean) {\n        const { column, columnJSON, found, propertyType, supportsTextSearch, sourceColumn } =\n            await this.getColumnForField(field);\n        if (!found) {\n            return this.NOT_FOUND_QUERY;\n        }\n        if (propertyType === JSDataType.Bool) {\n            const normTerm = `${term}`.trim().toLowerCase();\n            return SqlString.format(`(?? ${isNegatedField ? '!' : ''}= ?)`, [\n                column,\n                normTerm === 'true' ? 1 : normTerm === 'false' ? 0 : parseInt(normTerm, 10),\n            ]);\n        } else if (propertyType === JSDataType.Number) {\n            return SqlString.format(`(${column} ${isNegatedField ? '!' : ''}= CAST(?, 'Float64'))`, [term]);\n        } else if (propertyType === JSDataType.JSON) {\n            return SqlString.format(`(${columnJSON?.string} ${isNegatedField ? '!' : ''}= ?)`, [term]);\n        } else if (propertyType === JSDataType.String && supportsTextSearch) {\n            const searchTarget = column && column.length > 0 ? column : sourceColumn;\n            if (!searchTarget) {\n                return this.NOT_FOUND_QUERY;\n            }\n            return SqlString.format(`(? ${isNegatedField ? 'NOT ' : ''}MATCH_PHRASE ?)`, [\n                SqlString.raw(searchTarget),\n                term,\n            ]);\n        }\n        return SqlString.format(`(${column} ${isNegatedField ? '!' : ''}= ?)`, [term]);\n    }\n\n    async isNotNull(field: string, isNegatedField: boolean) {\n        const { column, columnJSON, found, propertyType } = await this.getColumnForField(field);\n        if (!found) {\n            return this.NOT_FOUND_QUERY;\n        }\n        if (propertyType === JSDataType.JSON) {\n            return `notEmpty(${columnJSON?.string}) ${isNegatedField ? '!' : ''}= 1`;\n        }\n        return `notEmpty(${column}) ${isNegatedField ? '!' : ''}= 1`;\n    }\n\n    async gte(field: string, term: string) {\n        const { column, columnJSON, found, propertyType } = await this.getColumnForField(field);\n        if (!found) {\n            return this.NOT_FOUND_QUERY;\n        }\n        if (propertyType === JSDataType.JSON) {\n            return SqlString.format(`(${columnJSON?.number} >= ?)`, [term]);\n        }\n        return SqlString.format(`(${column} >= ?)`, [term]);\n    }\n\n    async lte(field: string, term: string) {\n        const { column, columnJSON, found, propertyType } = await this.getColumnForField(field);\n        if (!found) {\n            return this.NOT_FOUND_QUERY;\n        }\n        if (propertyType === JSDataType.JSON) {\n            return SqlString.format(`(${columnJSON?.number} <= ?)`, [term]);\n        }\n        return SqlString.format(`(${column} <= ?)`, [term]);\n    }\n\n    async lt(field: string, term: string) {\n        const { column, columnJSON, found, propertyType } = await this.getColumnForField(field);\n        if (!found) {\n            return this.NOT_FOUND_QUERY;\n        }\n        if (propertyType === JSDataType.JSON) {\n            return SqlString.format(`(${columnJSON?.number} < ?)`, [term]);\n        }\n        return SqlString.format(`(${column} < ?)`, [term]);\n    }\n\n    async gt(field: string, term: string) {\n        const { column, columnJSON, found, propertyType } = await this.getColumnForField(field);\n        if (!found) {\n            return this.NOT_FOUND_QUERY;\n        }\n        if (propertyType === JSDataType.JSON) {\n            return SqlString.format(`(${columnJSON?.number} > ?)`, [term]);\n        }\n        return SqlString.format(`(${column} > ?)`, [term]);\n    }\n\n    private attemptToParseNumber(term: string): string | number {\n        const number = Number.parseFloat(term);\n        if (Number.isNaN(number)) {\n            return term;\n        }\n        return number;\n    }\n\n    private tokenizeTerm(term: string): string[] {\n        return term.split(/[ -/:-@[-`{-~\\t\\n\\r]+/).filter(t => t.length > 0);\n    }\n\n    private termHasSeperators(term: string): boolean {\n        return term.match(/[ -/:-@[-`{-~\\t\\n\\r]+/) != null;\n    }\n\n    async fieldSearch(\n        field: string,\n        term: string,\n        isNegatedField: boolean,\n        prefixWildcard: boolean,\n        suffixWildcard: boolean,\n        isPhrase: boolean,\n    ) {\n        const isImplicitField = field === IMPLICIT_FIELD;\n        const { column, found, propertyType, supportsTextSearch, sourceColumn, implicitTargets } =\n            await this.getColumnForField(field);\n        if (!found) {\n            return this.NOT_FOUND_QUERY;\n        }\n\n        if (propertyType === JSDataType.Bool) {\n            const normTerm = `${term}`.trim().toLowerCase();\n            return SqlString.format(`(?? ${isNegatedField ? '!' : ''}= ?)`, [\n                column,\n                normTerm === 'true' ? 1 : normTerm === 'false' ? 0 : parseInt(normTerm, 10),\n            ]);\n        } else if (propertyType === JSDataType.Number) {\n            return SqlString.format(`(?? ${isNegatedField ? '!' : ''}= CAST(?, 'Float64'))`, [column, term]);\n        } else if (propertyType === JSDataType.JSON && supportsTextSearch === false) {\n            return this.NOT_FOUND_QUERY;\n        }\n\n        if (term.length === 0) {\n            return '(1=1)';\n        }\n\n        if (isImplicitField) {\n            if (implicitTargets && implicitTargets.length > 0) {\n                const usePhrasePrefix = !isPhrase && suffixWildcard && !prefixWildcard;\n                const matchTerm = isPhrase\n                    ? term\n                    : usePhrasePrefix\n                        ? term\n                        : `${prefixWildcard ? '*' : ''}${term}${suffixWildcard ? '*' : ''}`;\n                const clauses = implicitTargets\n                    .map(target => {\n                        if (!target) {\n                            return null;\n                        }\n\n                        if (\n                            isPhrase &&\n                            target.propertyType !== JSDataType.String &&\n                            target.propertyType !== JSDataType.JSON\n                        ) {\n                            return null;\n                        }\n\n                        if (\n                            (target.propertyType === JSDataType.String || target.propertyType === JSDataType.JSON) &&\n                            target.supportsTextSearch\n                        ) {\n                            const identifier = target.sourceColumn ?? target.column;\n                            if (!identifier) {\n                                return null;\n                            }\n                            const operator = isPhrase\n                                ? 'MATCH_PHRASE'\n                                : usePhrasePrefix\n                                    ? 'MATCH_PHRASE_PREFIX'\n                                    : 'MATCH_ANY';\n                            return SqlString.format(`(?? ${operator} ?)`, [identifier, matchTerm]);\n                        }\n\n                        if (target.propertyType === JSDataType.Number) {\n                            const identifier = target.sourceColumn ?? target.column;\n                            if (!identifier) {\n                                return null;\n                            }\n                            return SqlString.format(`(?? = CAST(?, 'Float64'))`, [identifier, term]);\n                        }\n\n                        if (target.propertyType === JSDataType.Bool) {\n                            const identifier = target.sourceColumn ?? target.column;\n                            if (!identifier) {\n                                return null;\n                            }\n                            const normTerm = `${term}`.trim().toLowerCase();\n                            const boolValue =\n                                normTerm === 'true' ? 1 : normTerm === 'false' ? 0 : parseInt(normTerm, 10);\n                            return SqlString.format(`(?? = ?)`, [identifier, boolValue]);\n                        }\n\n                        return null;\n                    })\n                    .filter((clause): clause is string => clause != null);\n\n                if (clauses.length === 0) {\n                    return this.NOT_FOUND_QUERY;\n                }\n\n                const orClause = clauses.join(' OR ');\n                const wrapped = clauses.length === 1 ? clauses[0] : `(${orClause})`;\n\n                if (isNegatedField) {\n                    return `(NOT ${wrapped})`;\n                }\n\n                return wrapped;\n            }\n\n            if (column) {\n                if (prefixWildcard || suffixWildcard) {\n                    return SqlString.format(\n                        `(lower(?) ${isNegatedField ? 'NOT ' : ''}LIKE lower(?))`,\n                        [\n                            SqlString.raw(column ?? ''),\n                            `${prefixWildcard ? '%' : ''}${term}${suffixWildcard ? '%' : ''}`,\n                        ],\n                    );\n                } else {\n                    const hasSeperators = this.termHasSeperators(term);\n                    if (hasSeperators) {\n                        const tokens = this.tokenizeTerm(term);\n                        return `(${isNegatedField ? 'NOT (' : ''}${[\n                            ...tokens.map(token =>\n                                SqlString.format(`hasToken(lower(?), lower(?))`, [SqlString.raw(column ?? ''), token]),\n                            ),\n                            SqlString.format(`(lower(?) LIKE lower(?))`, [SqlString.raw(column ?? ''), `%${term}%`]),\n                        ].join(' AND ')}${isNegatedField ? ')' : ''})`;\n                    }\n\n                    return SqlString.format(\n                        `(${isNegatedField ? 'NOT ' : ''}hasToken(lower(?), lower(?)))`,\n                        [SqlString.raw(column ?? ''), term],\n                    );\n                }\n            }\n\n            return this.NOT_FOUND_QUERY;\n        } else {\n            if (supportsTextSearch === false) {\n                return this.NOT_FOUND_QUERY;\n            }\n\n            const searchTarget = column && column.length > 0 ? column : sourceColumn;\n            if (!searchTarget) {\n                return this.NOT_FOUND_QUERY;\n            }\n\n            const usePhrasePrefix = !isPhrase && suffixWildcard && !prefixWildcard;\n            const matchTerm = isPhrase\n                ? term\n                : usePhrasePrefix\n                    ? term\n                    : `${prefixWildcard ? '*' : ''}${term}${suffixWildcard ? '*' : ''}`;\n            const operator = isPhrase\n                ? 'MATCH_PHRASE'\n                : usePhrasePrefix\n                    ? 'MATCH_PHRASE_PREFIX'\n                    : 'MATCH_ANY';\n            return SqlString.format(`(? ${isNegatedField ? 'NOT ' : ''}${operator} ?)`, [\n                SqlString.raw(searchTarget),\n                matchTerm,\n            ]);\n        }\n    }\n\n    async range(field: string, start: string, end: string, isNegatedField: boolean) {\n        const { column, found } = await this.getColumnForField(field);\n        if (!found) {\n            return this.NOT_FOUND_QUERY;\n        }\n        return SqlString.format(`(${column} ${isNegatedField ? 'NOT ' : ''}BETWEEN ? AND ?)`, [\n            this.attemptToParseNumber(start),\n            this.attemptToParseNumber(end),\n        ]);\n    }\n}\n\nexport type CustomSchemaConfig = {\n    databaseName: string;\n    implicitColumnExpression?: string;\n    tableName: string;\n    connectionId: string;\n    datasourceType?: string;\n};\n\nexport class CustomSchemaSQLSerializerV2 extends SQLSerializer {\n    private tableName: string;\n    private databaseName: string;\n    private implicitColumnExpression?: string;\n    private connectionId: string;\n    private datasourceType?: string;\n    private legacyMetadataProvider?: LegacyMetadataProvider;\n    private columnMetadataCache = new Map<string, ColumnLookup | null>();\n    private invertedIndexColumns?: Set<string>;\n    private invertedIndexColumnsPromise?: Promise<Set<string>>;\n\n    constructor({\n        metadata,\n        databaseName,\n        tableName,\n        connectionId,\n        implicitColumnExpression,\n        datasourceType,\n    }: { metadata?: LegacyMetadataProvider } & CustomSchemaConfig) {\n        super();\n        this.legacyMetadataProvider = metadata;\n        this.databaseName = databaseName;\n        this.tableName = tableName;\n        this.implicitColumnExpression = implicitColumnExpression;\n        this.connectionId = connectionId;\n        this.datasourceType = datasourceType;\n    }\n\n    private async fetchColumnMetadata(column: string): Promise<ColumnLookup | null> {\n        if (this.columnMetadataCache.has(column)) {\n            return this.columnMetadataCache.get(column) ?? null;\n        }\n\n        let resolved: ColumnLookup | null = null;\n\n        try {\n            const result = await getColumnMetadata({\n                connectionId: this.connectionId,\n                database: this.databaseName,\n                table: this.tableName,\n                column,\n                datasourceType: this.datasourceType,\n            });\n\n            if (result) {\n                resolved = {\n                    name: result.name,\n                    type: result.normalizedType || result.columnType || result.dataType || 'Unknown',\n                    dataType: result.dataType,\n                    columnType: result.columnType,\n                };\n            }\n        } catch (error) {\n            // ignore service errors and fallback to legacy metadata provider if available\n        }\n\n        if (!resolved && this.legacyMetadataProvider?.getColumn) {\n            try {\n                const legacy = await this.legacyMetadataProvider.getColumn({\n                    databaseName: this.databaseName,\n                    tableName: this.tableName,\n                    column,\n                    connectionId: this.connectionId,\n                });\n\n                if (legacy) {\n                    resolved = {\n                        name: legacy.name,\n                        type: legacy.type || 'Unknown',\n                    };\n                }\n            } catch (legacyError) {\n                // swallow legacy metadata errors\n            }\n        }\n\n        this.columnMetadataCache.set(column, resolved);\n        return resolved;\n    }\n\n    private async loadInvertedIndexColumns(): Promise<Set<string>> {\n        if (this.invertedIndexColumns) {\n            return this.invertedIndexColumns;\n        }\n\n        if (!this.invertedIndexColumnsPromise) {\n            this.invertedIndexColumnsPromise = (async () => {\n                try {\n                    const columns = await getInvertedIndexColumns({\n                        connectionId: this.connectionId,\n                        database: this.databaseName,\n                        table: this.tableName,\n                        datasourceType: this.datasourceType,\n                    });\n                    return new Set(columns.map(name => name.toLowerCase()));\n                } catch (error) {\n                    return new Set<string>();\n                }\n            })();\n        }\n\n        const resolved = await this.invertedIndexColumnsPromise;\n        this.invertedIndexColumns = resolved;\n        return resolved;\n    }\n\n    private async columnHasInvertedIndex(column: string): Promise<boolean> {\n        if (!column) {\n            return false;\n        }\n\n        const indexes = await this.loadInvertedIndexColumns();\n        return indexes.has(column.toLowerCase());\n    }\n\n    private async buildColumnExpressionFromField(field: string) {\n        const exactMatch = await this.fetchColumnMetadata(field);\n\n        if (exactMatch) {\n            return {\n                found: true,\n                columnType: exactMatch.type,\n                columnExpression: exactMatch.name,\n                sourceColumn: exactMatch.name,\n            };\n        }\n\n        const fieldPrefix = field.split('.')[0];\n        const prefixMatch = await this.fetchColumnMetadata(fieldPrefix);\n\n        if (prefixMatch) {\n            const fieldPostfix = field.split('.').slice(1).join('.');\n\n            if (prefixMatch.type.startsWith('Map')) {\n                const valueType = prefixMatch.type.match(/,\\s+(\\w+)\\)$/)?.[1];\n                return {\n                    found: true,\n                    columnExpression: SqlString.format(`??[?]`, [prefixMatch.name, fieldPostfix]),\n                    columnType: valueType ?? 'Unknown',\n                    sourceColumn: prefixMatch.name,\n                };\n            } else if (prefixMatch.type.startsWith('JSON')) {\n                return {\n                    found: true,\n                    columnExpression: '',\n                    columnExpressionJSON: {\n                        string: SqlString.format(`toString(??)`, [field]),\n                        number: SqlString.format(`dynamicType(??) in (?) and ??`, [\n                            field,\n                            CLICK_HOUSE_JSON_NUMBER_TYPES,\n                            field,\n                        ]),\n                    },\n                    columnType: 'JSON',\n                    sourceColumn: prefixMatch.name,\n                };\n            } else if (prefixMatch.type === 'String') {\n                const nestedPaths = fieldPostfix.split('.');\n                return {\n                    found: true,\n                    columnExpression: SqlString.format(\n                        `JSONExtractString(??, ${Array(nestedPaths.length).fill('?').join(',')})`,\n                        [prefixMatch.name, ...nestedPaths],\n                    ),\n                    columnType: 'String',\n                    sourceColumn: prefixMatch.name,\n                };\n            }\n\n            throw new Error('Unsupported column type for prefix match');\n        }\n\n        return {\n            found: true,\n            columnExpression: field,\n            columnType: 'Unknown',\n            sourceColumn: field,\n        };\n    }\n\n    async getColumnForField(field: string) {\n        if (field === IMPLICIT_FIELD) {\n            if (!this.implicitColumnExpression) {\n                throw new Error('Can not search bare text without an implicit column set.');\n            }\n\n            const expressions = splitAndTrimWithBracket(this.implicitColumnExpression);\n            const implicitFieldCandidates = Array.from(\n                new Set(\n                    expressions\n                        .reduce<string[]>((acc, expression) => {\n                            acc.push(...this.extractFieldNamesFromExpression(expression));\n                            return acc;\n                        }, [])\n                        .filter((name): name is string => !!name),\n                ),\n            );\n\n            const implicitTargets: any[] = (\n                await Promise.all(\n                    implicitFieldCandidates.map(async candidate => {\n                        try {\n                            const candidateExpression = await this.buildColumnExpressionFromField(candidate);\n                            const candidatePropertyType =\n                                convertCHTypeToPrimitiveJSType(candidateExpression.columnType) ?? undefined;\n\n                            let candidateSupportsTextSearch: boolean | undefined;\n                            if (\n                                (candidatePropertyType === JSDataType.String ||\n                                    candidatePropertyType === JSDataType.JSON) &&\n                                candidateExpression.sourceColumn &&\n                                candidateExpression.columnExpression === candidateExpression.sourceColumn\n                            ) {\n                                candidateSupportsTextSearch = await this.columnHasInvertedIndex(\n                                    candidateExpression.sourceColumn,\n                                );\n                            } else if (\n                                candidatePropertyType === JSDataType.String ||\n                                candidatePropertyType === JSDataType.JSON\n                            ) {\n                                candidateSupportsTextSearch = false;\n                            }\n\n                            return {\n                                column: candidateExpression.columnExpression,\n                                sourceColumn: candidateExpression.sourceColumn ?? candidate,\n                                propertyType: candidatePropertyType,\n                                supportsTextSearch: candidateSupportsTextSearch,\n                            };\n                        } catch (error) {\n                            return null;\n                        }\n                    }),\n                )\n            ).filter((target) => target !== null);\n\n            return {\n                column:\n                    expressions.length > 1\n                        ? `concatWithSeparator(';',${expressions.join(',')})`\n                        : this.implicitColumnExpression,\n                columnJSON: undefined,\n                propertyType: JSDataType.String,\n                supportsTextSearch: undefined,\n                sourceColumn: undefined,\n                implicitTargets,\n                found: true,\n            };\n        }\n\n        const expression = await this.buildColumnExpressionFromField(field);\n        const propertyType = convertCHTypeToPrimitiveJSType(expression.columnType) ?? undefined;\n\n        let supportsTextSearch: boolean | undefined;\n        if (\n            (propertyType === JSDataType.String || propertyType === JSDataType.JSON) &&\n            expression.sourceColumn &&\n            expression.columnExpression === expression.sourceColumn\n        ) {\n            supportsTextSearch = await this.columnHasInvertedIndex(expression.sourceColumn);\n        } else if (propertyType === JSDataType.String || propertyType === JSDataType.JSON) {\n            supportsTextSearch = false;\n        }\n\n        return {\n            column: expression.columnExpression,\n            columnJSON: expression?.columnExpressionJSON,\n            propertyType,\n            supportsTextSearch,\n            sourceColumn: expression.sourceColumn,\n            implicitTargets: undefined,\n            found: expression.found,\n        };\n    }\n\n    private extractFieldNamesFromExpression(expression: string): string[] {\n        const matches = expression.match(/`([^`]+)`/g);\n        if (!matches) {\n            return [];\n        }\n        return matches.map(match => match.slice(1, -1));\n    }\n}\n","// @ts-ignore: no type declarations for '@hyperdx/lucene'\nimport lucene from '@hyperdx/lucene';\nimport { decodeSpecialTokens, encodeSpecialTokens } from './tokenUtils';\nimport { IMPLICIT_FIELD } from './constants';\nimport { EnglishSerializer, Serializer } from './serializers';\n\nexport function parse(query: string): lucene.AST {\n    return lucene.parse(encodeSpecialTokens(query));\n}\n\nasync function nodeTerm(node: lucene.Node, serializer: Serializer): Promise<string> {\n    const field = node.field[0] === '-' ? node.field.slice(1) : node.field;\n    let isNegatedField = node.field[0] === '-';\n    const isImplicitField = node.field === IMPLICIT_FIELD;\n\n    if ((node as lucene.NodeTerm).term != null) {\n        const nodeTermInstance = node as lucene.NodeTerm;\n        let term = decodeSpecialTokens(nodeTermInstance.term);\n        if (isImplicitField && nodeTermInstance.prefix === '-') {\n            isNegatedField = true;\n        }\n        if (!isImplicitField && nodeTermInstance.prefix === '-') {\n            term = nodeTermInstance.prefix + decodeSpecialTokens(nodeTermInstance.term);\n        }\n\n        if (nodeTermInstance.quoted && !isImplicitField) {\n            return serializer.eq(field, term, isNegatedField);\n        }\n\n        if (!nodeTermInstance.quoted && term === '*') {\n            return serializer.isNotNull(field, isNegatedField);\n        }\n\n        if (!nodeTermInstance.quoted && term.substring(0, 2) === '>=') {\n            if (isNegatedField) {\n                return serializer.lt(field, term.slice(2));\n            }\n            return serializer.gte(field, term.slice(2));\n        }\n        if (!nodeTermInstance.quoted && term.substring(0, 2) === '<=') {\n            if (isNegatedField) {\n                return serializer.gt(field, term.slice(2));\n            }\n            return serializer.lte(field, term.slice(2));\n        }\n        if (!nodeTermInstance.quoted && term[0] === '>') {\n            if (isNegatedField) {\n                return serializer.lte(field, term.slice(1));\n            }\n            return serializer.gt(field, term.slice(1));\n        }\n        if (!nodeTermInstance.quoted && term[0] === '<') {\n            if (isNegatedField) {\n                return serializer.gte(field, term.slice(1));\n            }\n            return serializer.lt(field, term.slice(1));\n        }\n\n        let prefixWildcard = false;\n        let suffixWildcard = false;\n        if (!nodeTermInstance.quoted && term[0] === '*') {\n            prefixWildcard = true;\n            term = term.slice(1);\n        }\n        if (!nodeTermInstance.quoted && term[term.length - 1] === '*') {\n            suffixWildcard = true;\n            term = term.slice(0, -1);\n        }\n\n        return serializer.fieldSearch(field, term, isNegatedField, prefixWildcard, suffixWildcard, nodeTermInstance.quoted);\n    }\n\n    if ((node as lucene.NodeRangedTerm).inclusive != null) {\n        const rangedTerm = node as lucene.NodeRangedTerm;\n        return serializer.range(field, rangedTerm.term_min, rangedTerm.term_max, isNegatedField);\n    }\n\n    throw new Error(`Unexpected Node type. ${node}`);\n}\n\nasync function serialize(ast: lucene.AST | lucene.Node, serializer: Serializer): Promise<string> {\n    if ((ast as lucene.NodeTerm).term != null) {\n        return await nodeTerm(ast as lucene.NodeTerm, serializer);\n    }\n    if ((ast as lucene.NodeRangedTerm).inclusive != null) {\n        return await nodeTerm(ast as lucene.NodeTerm, serializer);\n    }\n\n    if ((ast as lucene.BinaryAST).right != null) {\n        const binaryAST = ast as lucene.BinaryAST;\n        const operator = serializer.operator(binaryAST.operator);\n        const parenthesized = binaryAST.parenthesized;\n        return `${parenthesized ? '(' : ''}${await serialize(binaryAST.left, serializer)} ${operator} ${await serialize(\n            binaryAST.right,\n            serializer,\n        )}${parenthesized ? ')' : ''}`;\n    }\n\n    if ((ast as lucene.LeftOnlyAST).left != null) {\n        const leftOnlyAST = ast as lucene.LeftOnlyAST;\n        const parenthesized = leftOnlyAST.parenthesized;\n        return `${parenthesized ? '(' : ''}${\n            leftOnlyAST.start !== undefined ? `${leftOnlyAST.start} ` : ''\n        }${await serialize(leftOnlyAST.left, serializer)}${parenthesized ? ')' : ''}`;\n    }\n\n    return '';\n}\n\nexport async function genWhereSQL(ast: lucene.AST, serializer: Serializer): Promise<string> {\n    return await serialize(ast, serializer);\n}\n\nexport async function genEnglishExplanation(query: string): Promise<string> {\n    try {\n        const parsedQ = parse(query);\n\n        if (parsedQ) {\n            const serializer = new EnglishSerializer();\n            return await serialize(parsedQ, serializer);\n        }\n    } catch (e) {\n        console.warn('Parse failure', query, e);\n    }\n\n    return `Message containing ${query}`;\n}\n","import { genWhereSQL, parse } from './ast';\nimport { SQLSerializer } from './serializers';\n\nexport { parse, genWhereSQL, genEnglishExplanation } from './ast';\nexport { SQLSerializer, CustomSchemaSQLSerializerV2 } from './serializers';\n\nexport class SearchQueryBuilder {\n    private readonly searchQ: string;\n    private readonly conditions: string[];\n    private serializer: SQLSerializer;\n\n    constructor(searchQ: string, serializer: SQLSerializer) {\n        this.conditions = [];\n        this.searchQ = searchQ;\n        this.serializer = serializer;\n    }\n\n    setSerializer(serializer: SQLSerializer) {\n        this.serializer = serializer;\n        return this;\n    }\n\n    getSerializer() {\n        return this.serializer;\n    }\n\n    private async genSearchQuery() {\n        if (!this.searchQ) {\n            return '';\n        }\n\n        const parsedQ = parse(this.searchQ);\n\n        return await genWhereSQL(parsedQ, this.serializer);\n    }\n\n    and(condition: string) {\n        if (condition && condition.trim()) {\n            this.conditions.push(`(${condition})`);\n        }\n        return this;\n    }\n\n    async build() {\n        const searchQuery = await this.genSearchQuery();\n        if (this.searchQ) {\n            this.and(searchQuery);\n        }\n        return this.conditions.join(' AND ');\n    }\n}\n","import { CustomSchemaSQLSerializerV2, genWhereSQL, parse } from 'utils/query-parser/query-parser';\n\ntype GetWhereSQLParams = {\n    query: string;\n    databaseName: string;\n    tableName: string;\n    connectionId: string;\n    implicitColumnExpression?: string;\n    datasourceType?: string;\n};\n\nexport async function getWhereSQLViaLucene({ query, databaseName, tableName, connectionId, implicitColumnExpression, datasourceType }: GetWhereSQLParams): Promise<string> {\n    const trimmedQuery = query?.trim();\n    if (!trimmedQuery) {\n        return '';\n    }\n\n    const serializer = new CustomSchemaSQLSerializerV2({\n        databaseName,\n        tableName,\n        connectionId,\n        implicitColumnExpression,\n        datasourceType,\n    });\n\n    try {\n        const ast = parse(trimmedQuery);\n        const whereSQL =  await genWhereSQL(ast, serializer);\n        console.log({\n            query,\n            whereSQL,\n        });\n        return whereSQL;\n    } catch (error) {\n        console.error('Failed to generate Lucene WHERE SQL', error);\n        throw error;\n    }\n}\n","import { useCallback } from 'react';\nimport { useAtomValue } from 'jotai';\nimport {\n    currentDatabaseAtom,\n    currentTableAtom,\n    currentTimeFieldAtom,\n    searchTypeAtom,\n    searchValueAtom,\n    selectedDatasourceAtom,\n    tableFieldsAtom,\n} from 'store/discover';\nimport { getWhereSQLViaLucene } from 'services/lucene';\n\nexport function useLuceneWhereClause() {\n    const searchType = useAtomValue(searchTypeAtom);\n    const searchValue = useAtomValue(searchValueAtom);\n    const currentTable = useAtomValue(currentTableAtom);\n    const currentDatabase = useAtomValue(currentDatabaseAtom);\n    const selectdbDS = useAtomValue(selectedDatasourceAtom);\n    const tableFields = useAtomValue(tableFieldsAtom);\n    const currentTimeField = useAtomValue(currentTimeFieldAtom);\n\n    return useCallback(async (): Promise<string> => {\n        if (searchType !== 'Lucene') {\n            return '';\n        }\n\n        const trimmedQuery = searchValue?.trim();\n        if (!trimmedQuery || !currentTable || !currentDatabase || !selectdbDS) {\n            return '';\n        }\n\n        const candidateFieldNames = (tableFields || [])\n            .map((field: any) => {\n                const rawName = field?.Field ?? field?.value ?? field?.name;\n                const type = String(field?.Type ?? '').toUpperCase();\n                if (!rawName) {\n                    return null;\n                }\n\n                if (!type) {\n                    return rawName;\n                }\n\n                return /(CHAR|TEXT|STRING|JSON|VARIANT)/.test(type) ? rawName : null;\n            })\n            .filter(Boolean) as string[];\n\n        const implicitExpressions = candidateFieldNames.slice(0, 10).map(name => `coalesce(\\`${name}\\`, '')`);\n\n        let implicitColumnExpression: string | undefined;\n        if (implicitExpressions.length > 0) {\n            implicitColumnExpression = implicitExpressions.join(',\\n');\n        } else if (currentTimeField) {\n            implicitColumnExpression = `coalesce(\\`${currentTimeField}\\`, '')`;\n        }\n\n        return await getWhereSQLViaLucene({\n            query: trimmedQuery,\n            databaseName: currentDatabase,\n            tableName: currentTable,\n            connectionId: selectdbDS.uid,\n            datasourceType: selectdbDS.type,\n            implicitColumnExpression,\n        });\n    }, [currentDatabase, currentTable, currentTimeField, searchType, searchValue, selectdbDS, tableFields]);\n}\n","import { useCallback, useEffect } from 'react';\nimport { Dayjs } from 'dayjs';\nimport { useAtom, useAtomValue, useSetAtom } from 'jotai';\nimport {\n    currentCatalogAtom,\n    currentDatabaseAtom,\n    currentDateAtom,\n    currentIndexAtom,\n    currentTableAtom,\n    currentTimeFieldAtom,\n    dataFilterAtom,\n    discoverLoadingAtom,\n    intervalAtom,\n    pageAtom,\n    pageSizeAtom,\n    searchTypeAtom,\n    searchValueAtom,\n    selectedDatasourceAtom,\n    tableDataAtom,\n    tableDataChartsAtom,\n    tableFieldsAtom,\n    tableTotalCountAtom,\n    tableTracesDataAtom,\n    topDataAtom,\n} from 'store/discover';\nimport { getTableDataChartsService, getTableDataCountService, getTableDataService, getTopDataService } from 'services/discover';\nimport { getTableDataTraceService } from 'services/traces';\nimport {\n    encodeBase64,\n    getChartsData,\n    convertColumnToRow,\n    convertColumnToRowViaFieldsType,\n    generateHighlightedResults,\n    formatTracesResData,\n    getIndexesStatement,\n} from 'utils/data';\nimport { generateTableDataUID } from 'utils/utils';\nimport { message } from 'antd';\nimport { FORMAT_DATE, getAutoInterval, IntervalEnum } from '../../constants';\nimport { toDataFrame } from '@grafana/data';\nimport { useLuceneWhereClause } from './useLuceneWhereClause';\n\ntype RefreshOptions = {\n    skipPageReset?: boolean;\n};\n\nexport function useDiscoverData() {\n    const [page, setPage] = useAtom(pageAtom);\n    const pageSize = useAtomValue(pageSizeAtom);\n    const setTableData = useSetAtom(tableDataAtom);\n    const setTableDataCharts = useSetAtom(tableDataChartsAtom);\n    const selectdbDS = useAtomValue(selectedDatasourceAtom);\n    const currentTimeField = useAtomValue(currentTimeFieldAtom);\n    const interval = useAtomValue(intervalAtom);\n    const currentIndexes = useAtomValue(currentIndexAtom);\n    const tableFields = useAtomValue(tableFieldsAtom);\n    const searchType = useAtomValue(searchTypeAtom);\n    const dataFilter = useAtomValue(dataFilterAtom);\n    const searchValue = useAtomValue(searchValueAtom);\n    const setTopData = useSetAtom(topDataAtom);\n    const currentTable = useAtomValue(currentTableAtom);\n    const currentCatalog = useAtomValue(currentCatalogAtom);\n    const currentDatabase = useAtomValue(currentDatabaseAtom);\n    const currentDate = useAtomValue(currentDateAtom);\n    const setTableTotalCount = useSetAtom(tableTotalCountAtom);\n    const setTraceData = useSetAtom(tableTracesDataAtom);\n    const [loading, setLoading] = useAtom(discoverLoadingAtom);\n    const buildLuceneWhereClause = useLuceneWhereClause();\n\n    const getTableData = useCallback(async () => {\n        if (!currentTable || !currentDatabase || !selectdbDS) {\n            return;\n        }\n        setLoading(prev => ({ ...prev, getTableData: true }));\n        const indexesStatement = getIndexesStatement(currentIndexes, tableFields, searchValue);\n        const payload: any = {\n            catalog: currentCatalog,\n            database: currentDatabase,\n            table: currentTable,\n            timeField: currentTimeField,\n            startDate: currentDate[0]?.format(FORMAT_DATE),\n            endDate: (currentDate[1] as Dayjs).format(FORMAT_DATE),\n            cluster: '',\n            sort: 'DESC',\n            search_type: searchType,\n            indexes: '',\n            page: page,\n            page_size: pageSize,\n        };\n\n        if (searchType === 'Search') {\n            payload.indexes_statement = indexesStatement;\n        }\n        payload.data_filters = dataFilter.length > 0 ? dataFilter : [];\n\n        if (searchType === 'Lucene') {\n            try {\n                const luceneWhere = await buildLuceneWhereClause();\n                if (luceneWhere) {\n                    payload.lucene_where = luceneWhere;\n                }\n            } catch (error) {\n                setLoading(prev => ({ ...prev, getTableData: false }));\n                setTableData([]);\n                console.error('Lucene query build failed', error);\n                return;\n            }\n        }\n\n        if (searchValue && searchType !== 'Lucene') {\n            payload.search_value = searchType === 'Search' ? encodeBase64(searchValue) : searchValue;\n        }\n\n        getTableDataService({\n            selectdbDS,\n            ...payload,\n        }).subscribe({\n            next: async ({ data, ok }: any) => {\n                setLoading(prev => ({ ...prev, getTableData: false }));\n                if (!ok) {\n                    // Clear table data when backend reports failure so UI does not display stale results\n                    setTableData([]);\n                    return;\n                }\n                const frames = data?.results?.getTableData?.frames;\n                if (!frames || !frames[0]) {\n                    setTableData([]);\n                    return;\n                }\n                const rowsData = convertColumnToRow(frames[0]);\n                const resData = generateHighlightedResults(\n                    {\n                        search_value: searchValue,\n                        indexes: currentIndexes || [],\n                    },\n                    rowsData,\n                );\n\n                const rowsDataWithUid = await generateTableDataUID(resData);\n                setTableData(rowsDataWithUid);\n            },\n            error: (err: any) => {\n                setLoading(prev => ({ ...prev, getTableData: false }));\n                // Clear table data on network / connection errors to ensure UI refreshes\n                setTableData([]);\n                console.log('Fetch Error', err);\n            },\n        });\n    }, [\n        buildLuceneWhereClause,\n        currentCatalog,\n        currentDate,\n        currentDatabase,\n        currentIndexes,\n        currentTable,\n        currentTimeField,\n        dataFilter,\n        page,\n        pageSize,\n        searchType,\n        searchValue,\n        selectdbDS,\n        setLoading,\n        setTableData,\n        tableFields,\n    ]);\n\n    const getTableDataCharts = useCallback(async () => {\n        if (!currentTable || !currentDatabase || !selectdbDS) {\n            return;\n        }\n        setLoading(prev => ({ ...prev, getTableDataCharts: true }));\n        const autoInterval = getAutoInterval(currentDate as any);\n        const timeInterval = interval === IntervalEnum.Auto ? autoInterval.interval_unit : interval;\n        const timeIntervalValue = interval === IntervalEnum.Auto ? autoInterval.interval_value : 1;\n        const indexesStatement = getIndexesStatement(currentIndexes, tableFields, searchValue);\n        const payload: any = {\n            catalog: 'internal',\n            database: currentDatabase,\n            table: currentTable,\n            timeField: currentTimeField,\n            startDate: currentDate[0]?.format(FORMAT_DATE),\n            endDate: (currentDate[1] as Dayjs).format(FORMAT_DATE),\n            cluster: '',\n            data_filters: [],\n            sort: 'DESC',\n            interval: timeInterval,\n            interval_value: timeIntervalValue,\n            search_type: searchType,\n            indexes: indexesStatement,\n        };\n\n        if (dataFilter.length > 0) {\n            payload.data_filters = dataFilter;\n        }\n\n        if (searchType === 'Lucene') {\n            try {\n                const luceneWhere = await buildLuceneWhereClause();\n                if (luceneWhere) {\n                    payload.lucene_where = luceneWhere;\n                }\n            } catch (error) {\n                setLoading(prev => ({ ...prev, getTableDataCharts: false }));\n                setTableDataCharts([]);\n                console.error('Lucene query build failed', error);\n                return;\n            }\n        }\n\n        if (searchValue && searchType !== 'Lucene') {\n            payload.search_value = searchType === 'Search' ? encodeBase64(searchValue) : searchValue;\n        }\n\n        getTableDataChartsService({\n            selectdbDS,\n            ...payload,\n        }).subscribe({\n            next: ({ data, ok }: any) => {\n                setLoading(prev => ({ ...prev, getTableDataCharts: false }));\n                if (!ok) {\n                    // Clear charts when backend reports failure\n                    setTableDataCharts([]);\n                    return;\n                }\n                const frame = toDataFrame(data.results.getTableDataCharts.frames[0]);\n                const times = Array.from(frame?.fields[0]?.values || []);\n                const values = Array.from(frame?.fields[1]?.values || []);\n                if (!times.length || !values.length) {\n                    setTableDataCharts([]);\n                    return;\n                }\n                const tableDataCharts = times.map((item: any, index: number) => ({\n                    TT: item,\n                    'sum(cnt)': values[index],\n                }));\n                const chartsData = getChartsData(tableDataCharts, currentDate as [Dayjs, Dayjs]);\n                setTableDataCharts(chartsData);\n            },\n            error: (err: any) => {\n                setLoading(prev => ({ ...prev, getTableDataCharts: false }));\n                // Clear charts on network / connection errors\n                setTableDataCharts([]);\n                console.log('Fetch Error', err);\n            },\n        });\n    }, [\n        buildLuceneWhereClause,\n        currentDate,\n        currentDatabase,\n        currentIndexes,\n        currentTable,\n        currentTimeField,\n        dataFilter,\n        interval,\n        searchType,\n        searchValue,\n        selectdbDS,\n        setLoading,\n        setTableDataCharts,\n        tableFields,\n    ]);\n\n    const getTopData = useCallback(async () => {\n        if (!currentTable || !currentDatabase || !selectdbDS) {\n            return;\n        }\n        const indexesStatement = getIndexesStatement(currentIndexes, tableFields, searchValue);\n        const payload: any = {\n            catalog: currentCatalog,\n            database: currentDatabase,\n            table: currentTable,\n            timeField: currentTimeField,\n            startDate: currentDate[0]?.format(FORMAT_DATE),\n            endDate: (currentDate[1] as Dayjs).format(FORMAT_DATE),\n            cluster: '',\n            sort: 'DESC',\n            search_type: searchType,\n            indexes: '',\n            page: page,\n            page_size: 500,\n        };\n\n        if (searchType === 'Search') {\n            payload.indexes_statement = indexesStatement;\n        }\n        payload.data_filters = dataFilter.length > 0 ? dataFilter : [];\n\n        if (searchValue && searchType !== 'Lucene') {\n            payload.search_value = searchType === 'Search' ? encodeBase64(searchValue) : searchValue;\n        }\n\n        if (searchType === 'Lucene') {\n            try {\n                const luceneWhere = await buildLuceneWhereClause();\n                if (luceneWhere) {\n                    payload.lucene_where = luceneWhere;\n                }\n            } catch (error) {\n                console.error('Lucene query build failed', error);\n                setTopData([]);\n                return;\n            }\n        }\n\n        getTopDataService({\n            selectdbDS,\n            ...payload,\n        }).subscribe({\n            next: ({ data, ok }: any) => {\n                if (!ok) {\n                    return;\n                }\n                const frames = data?.results?.getTableTopData?.frames;\n                if (!frames || !frames[0]) {\n                    setTopData([]);\n                    return;\n                }\n                const rowsData = convertColumnToRowViaFieldsType(frames[0], tableFields);\n                setTopData(rowsData);\n            },\n            error: (err: any) => {\n                console.log('Fetch Error', err);\n                setTopData([]);\n            },\n        });\n    }, [\n        buildLuceneWhereClause,\n        currentCatalog,\n        currentDate,\n        currentDatabase,\n        currentIndexes,\n        currentTable,\n        currentTimeField,\n        dataFilter,\n        page,\n        searchType,\n        searchValue,\n        selectdbDS,\n        setTopData,\n        tableFields,\n    ]);\n\n    const getTableDataCount = useCallback(async () => {\n        if (!currentTable || !currentDatabase || !selectdbDS) {\n            return;\n        }\n        const autoInterval = getAutoInterval(currentDate as any);\n        const timeInterval = interval === IntervalEnum.Auto ? autoInterval.interval_unit : interval;\n        const timeIntervalValue = interval === IntervalEnum.Auto ? autoInterval.interval_value : 1;\n        const indexesStatement = getIndexesStatement(currentIndexes, tableFields, searchValue);\n        const payload: any = {\n            catalog: 'internal',\n            database: currentDatabase,\n            table: currentTable,\n            timeField: currentTimeField,\n            startDate: currentDate[0]?.format(FORMAT_DATE),\n            endDate: (currentDate[1] as Dayjs).format(FORMAT_DATE),\n            cluster: '',\n            sort: 'DESC',\n            interval: timeInterval,\n            data_filters: [],\n            interval_value: timeIntervalValue,\n            search_type: searchType,\n            indexes: indexesStatement,\n        };\n\n        if (dataFilter.length > 0) {\n            payload.data_filters = dataFilter;\n        }\n\n        if (searchType === 'Lucene') {\n            try {\n                const luceneWhere = await buildLuceneWhereClause();\n                if (luceneWhere) {\n                    payload.lucene_where = luceneWhere;\n                }\n            } catch (error) {\n                console.error('Lucene query build failed', error);\n                setTableTotalCount(0);\n                return;\n            }\n        }\n\n        if (searchValue && searchType !== 'Lucene') {\n            payload.search_value = searchType === 'Search' ? encodeBase64(searchValue) : searchValue;\n        }\n\n        getTableDataCountService({\n            selectdbDS,\n            ...payload,\n        }).subscribe({\n            next: ({ data, ok }: any) => {\n                setLoading(prev => ({ ...prev, getTableDataCount: false }));\n                if (!ok) {\n                    // Clear count when backend reports failure\n                    setTableTotalCount(0);\n                    return;\n                }\n                const frame = toDataFrame(data.results.getTableCountData.frames[0]);\n                const totalCount = frame.fields[0]?.values[0] as number;\n                if (!totalCount) {\n                    setTableTotalCount(0);\n                    return;\n                }\n                setTableTotalCount(totalCount);\n            },\n            error: (err: any) => {\n                // Ensure we clear the count on error so UI doesn't keep previous value\n                setTableTotalCount(0);\n                console.log('Fetch Error', err);\n            },\n        });\n    }, [\n        buildLuceneWhereClause,\n        currentDate,\n        currentDatabase,\n        currentIndexes,\n        currentTable,\n        currentTimeField,\n        dataFilter,\n        interval,\n        searchType,\n        searchValue,\n        selectdbDS,\n        setTableTotalCount,\n        tableFields,\n    ]);\n\n    const getTraceData = useCallback(\n        (trace_id: string, table?: string, callback?: Function) => {\n            const indexesStatement = getIndexesStatement(currentIndexes, tableFields, searchValue);\n            const payload: any = {\n                catalog: currentCatalog,\n                database: currentDatabase,\n                table: table || currentTable || 'otel_traces',\n                timeField: currentTimeField,\n                startDate: currentDate[0]?.format(FORMAT_DATE),\n                endDate: (currentDate[1] as Dayjs).format(FORMAT_DATE),\n                cluster: '',\n                sort: 'DESC',\n                search_type: searchType,\n                indexes: '',\n                page: page,\n                page_size: pageSize,\n                trace_id,\n            };\n            if (searchType === 'Search') {\n                payload.indexes_statement = indexesStatement;\n            }\n\n            payload.data_filters = dataFilter.length > 0 ? dataFilter : [];\n\n            if (searchValue) {\n                payload.search_value = encodeBase64(searchValue);\n            }\n\n            getTableDataTraceService({\n                selectdbDS,\n                ...payload,\n            }).subscribe({\n                next: ({ data, ok }: any) => {\n                    callback && callback(data.results.getTableDataTrace.status)\n                    if (!ok) {\n                        message.error('Failed to request trace');\n                        return;\n                    }\n                    const formattedData = formatTracesResData(data.results.getTableDataTrace.frames[0]);\n                    setTraceData(formattedData);\n                },\n                error: (err: any) => {\n                    // Clear trace data on error\n                    setTraceData([]);\n                    console.log('Fetch Error', err);\n                    callback && callback(err.status)\n                    message.error('Failed to request trace');\n                    setTraceData(null);\n                },\n            });\n        },\n        [\n            currentCatalog,\n            currentDate,\n            currentDatabase,\n            currentIndexes,\n            currentTable,\n            currentTimeField,\n            dataFilter,\n            page,\n            pageSize,\n            searchType,\n            searchValue,\n            selectdbDS,\n            setTraceData,\n            tableFields,\n        ],\n    );\n\n    const clearData = useCallback(() => {\n        setTableDataCharts([]);\n        setTableTotalCount(0);\n        setTableData([]);\n        setTopData([]);\n    }, [setTableData, setTableDataCharts, setTableTotalCount, setTopData]);\n\n    const refreshData = useCallback(\n        ({ skipPageReset = false }: RefreshOptions = {}) => {\n            if (!skipPageReset) {\n                setPage(1);\n            }\n            if (!currentTimeField) {\n                clearData();\n                return;\n            }\n            void getTableDataCharts();\n            void getTableDataCount();\n            void getTableData();\n            void getTopData();\n        },\n        [\n            clearData,\n            currentTimeField,\n            getTableData,\n            getTableDataCharts,\n            getTableDataCount,\n            getTopData,\n            setPage,\n        ],\n    );\n\n    const handleQuerying = useCallback(() => {\n        if (!currentTimeField) {\n            clearData();\n            return;\n        }\n        refreshData();\n    }, [clearData, currentTimeField, refreshData]);\n\n    useEffect(() => {\n        if (!currentTimeField) {\n            return;\n        }\n        void getTableData();\n        void getTopData();\n        void getTableDataCharts();\n        void getTableDataCount();\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [currentTimeField, page]);\n\n    useEffect(() => {\n        refreshData({ skipPageReset: false });\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [currentDate, currentTimeField, dataFilter, interval]);\n\n    return {\n        loading,\n        onQuerying: handleQuerying,\n        getTraceData,\n    };\n}\n","import React from 'react';\nimport { css } from '@emotion/css';\nimport { PluginPage } from '@grafana/runtime';\nimport { LoadingBar, useTheme2 } from '@grafana/ui';\n\nimport DiscoverFilter from 'components/discover-filter';\nimport DiscoverSidebar from 'components/discover-sidebar';\nimport { DiscoverHistogram } from 'components/discover-histogram';\nimport DiscoverContent from 'components/discover-content';\nimport DiscoverHeader from '../components/discover-header';\nimport { testIds } from '../components/testIds';\nimport { useDiscoverData } from './PageDiscover/useDiscoverData';\n\nexport default function PageDiscover() {\n    const theme = useTheme2();\n    const { loading, onQuerying, getTraceData } = useDiscoverData();\n\n    return (\n        <div\n            className={css`\n                & > div > div {\n                    background-color: ${theme.isDark ? '#111217' : '#F4F5F5'};\n                    padding: 0 1rem;\n                }\n            `}\n        >\n            <PluginPage pageNav={{ text: '' }}>\n                <div data-testid={testIds.pageTwo.container}>\n                    <DiscoverHeader onQuerying={onQuerying} loading={loading.getTableData || loading.getTableDataCharts} />\n                    <DiscoverFilter />\n                </div>\n                <section\n                    className={css`\n                        display: grid;\n                        grid-template-columns: 2fr 8fr;\n                        grid-template-rows: 1fr;\n                        grid-template-areas: 'sidebar content';\n                        padding-top: 0.5rem;\n                        gap: 0.5rem;\n                    `}\n                >\n                    <div\n                        style={{\n                            height: 'calc(100vh - 210px)',\n                        }}\n                    >\n                        <DiscoverSidebar />\n                    </div>\n                    <div\n                        className={css`\n                            grid-area: content;\n                            display: flex;\n                            flex-direction: column;\n                            overflow: auto;\n                            height: calc(100vh - 210px);\n                            background-color: ${theme.isDark ? 'rgb(24, 27, 31)' : '#FFF'};\n                            position: relative;\n                            padding: 16px 0;\n                        `}\n                    >\n                        <div style={{ position: 'absolute', top: 0, width: '100%' }}>{loading.getTableDataCharts && <LoadingBar width={100} />}</div>\n                        <DiscoverHistogram />\n                        <div\n                            className={css`\n                                margin-top: 24px;\n                            `}\n                        >\n                            <DiscoverContent getTraceData={getTraceData} fetchNextPage={() => {}} />\n                        </div>\n                    </div>\n                </section>\n            </PluginPage>\n        </div>\n    );\n}\n"],"names":["LoadingState","PanelRenderer","Drawer","LoadingPlaceholder","useAtom","useAtomValue","React","useEffect","getTableDataTraceService","currentCatalogAtom","currentDatabaseAtom","tableTracesDataAtom","selectedDatasourceAtom","selectedRowAtom","currentTraceTableAtom","formatTracesResData","TraceDetail","props","currentTable","currentCatalog","currentDatabase","traceData","setTraceData","selectedRow","selectdbDS","traceTable","loading","setLoading","useState","open","traceId","getTraceData","useCallback","payload","catalog","database","table","cluster","sort","trace_id","subscribe","next","data","ok","formatedData","results","getTableDataTrace","frames","error","err","console","log","renderTracePanel","title","width","height","pluginId","options","state","Loading","Done","series","timeRange","from","Date","now","to","raw","onClose","size","text","getQueryTableTraceSQL","params","sql","parseDuration","input","endsWith","parseFloat","replace","tagsToDorisSQLConditions","tags","conditions","regex","match","exec","key","val","push","length","join","buildTraceAggSQLFromParams","timeFilter","timeField","startDate","endDate","serviceFilter","service_name","operationFilter","operation","statusFilter","statusCode","minDuration","maxDuration","durationFilter","tagsFilter","rootSpansFilter","limit","page_size","offset","Math","max","page","rowNumberOrderBy","sortBy","query","getServiceListSQL","getOperationListSQL","getBackendSrv","rest","traceSQL","fetch","url","method","queries","refId","datasource","type","uid","rawSql","format","credentials","getTracesService","getTracesSQL","getServiceListService","serviceListSQL","getOperationListService","operationListSQL","DEFAULT_OPERATION","DEFAULT_SERVICE","atom","currentServiceAtom","currentOperationAtom","currentSortAtom","tagsAtom","tracesAtom","tracesServicesAtom","traceOperationsAtom","minDurationAtom","maxDurationAtom","testIds","appConfig","apiKey","apiUrl","submit","pageOne","container","navigateToFour","pageTwo","pageThree","pageFour","navigateBack","css","styled","DiscoverFilterWrapper","div","containerStyle","rowStyle","colStyle","footerStyle","nanoid","Select","InlineField","InlineFieldRow","InlineSwitch","Button","Input","Field","tableFieldsAtom","dataFilterAtom","tableFieldValuesAtom","tableDataAtom","OPERATORS","getFieldType","Controller","useForm","uniqBy","FilterContent","onHide","dataFilterValue","errors","tableFields","dataFilter","setDataFilter","tableFieldValue","setTableFieldValue","tableData","control","handleSubmit","watch","register","setValue","formState","defaultValues","field","label","fieldName","value","operator","minValue","Array","isArray","maxValue","showLabel","id","prev","changed","updated","map","f","selectedFieldType","useMemo","tf","find","Type","isNumberField","isBooleanField","isTimeField","operatorOptions","normalized","op","textMatchOps","allowed","Set","filter","opItem","has","String","isNumberOrTime","v","toLowerCase","includes","getValue","isNaN","convertValue","undefined","onSubmit","formValues","opField","current","opValue","newValue","newItem","renderFiledComponent","currentOperator","className","invalid","message","required","validate","name","rules","render","isMulti","item","placeholder","onChange","selected","s","form","_original","variant","onClick","e","preventDefault","useRef","useTranslation","locationAtom","getFilterSQL","Badge","Icon","IconButton","Toggletip","useTheme2","DiscoverFilter","setOpen","dataFilterOpen","setDataFilterOpen","discoverFilterRef","t","_loc","setLoc","theme","ref","isDark","index","toString","show","onOpen","closeButton","content","placement","span","data_filters","searchParams","set","JSON","stringify","color","tooltip","style","marginLeft","FIELD_TYPES","icon","complex","getFieldIcon","columnType","currentColumnType","some","toLocaleUpperCase","clsx","twMerge","cn","inputs","Progress","get","topDataAtom","tableTotalCountAtom","isComplexType","countValueDistribution","jsonArray","valueCountMap","Map","forEach","obj","result","times","valueStr","TopData","topData","tableTotalCount","canDisplayTopData","toUpperCase","res","Object","entries","a","b","count","small","toFixed","percent","status","showInfo","stopPropagation","FieldItem","children","colors","background","secondary","primary","onAdd","onRemove","searchableAtom","aggregatableAtom","fieldTypeAtom","AGGREGATABLE","SEARCHABLE","RadioButtonGroup","searchable","setSearchable","aggregatable","setAggregatable","fieldType","setFieldType","selectedFieldsAtom","indexesAtom","surroundingSelectedFieldsAtom","AggregatableEnum","SearchableEnum","FieldTypeEnum","CollapsableSection","DiscoverSidebar","selectedFields","setSelectedFields","selectedSurroundingFields","setSelectedSurroundingFields","_setSearchable","_setAggregatable","_setFieldType","searchValue","setSearchValue","indexes","filteredFields","ANY","YES","NO","hasSelectedFields","availableFields","filed","handleAdd","handleRemove","findIndex","splice","surIndex","target","isOpen","fill","fullWidth","ReactECharts","useSetAtom","dayjs","IntervalEnum","TIME_INTERVALS","getAutoInterval","FORMAT_DATE","translationDateIntervalType","currentDateAtom","discoverCurrentAtom","activeShortcutAtom","tableDataChartsAtom","intervalAtom","pageSizeAtom","pageAtom","timeRangeAtom","DiscoverHistogram","currentDate","setCurrentDate","ReactEChartsInstance","discoverCurrent","setDiscoverCurrent","setActiveItem","tableDataCharts","process","env","NODE_ENV","debugLabel","interval_value","setInterval_value","interval","setInterval","_timeRange","setTimeRange","_pageSize","setPageSize","setPage","timeInterval","Auto","base","oneDay","random","i","round","subtext","left","top","grid","right","bottom","containLabel","xAxis","axisLabel","fontSize","fontStyle","fontWeight","axisLine","lineStyle","axisTick","toolbox","brush","xAxisIndex","yAxis","nameTextStyle","align","padding","splitLine","trigger","axisPointer","borderWidth","backgroundColor","formatter","html","barWidth","animation","chart","handler","areas","startIndex","endIndex","coordRange","interval_unit","chartsEndDate","add","date","getEchartsInstance","dispatchAction","command","ele","brushOption","brushType","on","off","selectdbInterval","option","Fragment","flexRender","getCoreRowModel","getExpandedRowModel","useReactTable","EmptySearchResult","SDCollapsibleTable","columns","renderSubComponent","getRowCanExpand","thead","getHeaderGroups","headerGroup","tr","headers","header","th","colSpan","isLight","isPlaceholder","column","columnDef","getContext","tbody","getRowModel","rows","row","original","getIsExpanded","getVisibleCells","cell","td","HoverStyle","ColumnStyleWrapper","ContentTableActions","fieldValue","hasField","filterValue","display","justifyContent","ContentItem","surroundingDataFilterAtom","SurroundingContentItem","surroundingDataFilter","setSurroundingDataFilter","SurroundingLogsActions","getSurroundingData","getSurroundingDataLoading","time","timeFieldPageSize","tips","aria-label","currentShowLabel","SurroundingDiscoverFilter","getQueryTableResultSQL","indexesStatement","indexes_statement","statement","search_type","reduce","curr","addSqlFilter","search_value","lucene_where","getQueryTableChartsSQL","getQueryTableResultCountSQL","getSurroundingSQL","orderSymbol","pageSize","valueString","transformedFieldName","transformFieldPath","fieldPath","parts","split","slice","part","getTableDataService","QueryTableResultSQL","response","getTableDataChartsService","QueryTableChartsSQL","getTopDataService","getTableDataCountService","QueryTableResultCountSQL","getSurroundingDataService","surroundingSQL","SurroundingContentTableActions","useRequest","LoadingBar","Tab","TabContent","TabsBar","currentTimeFieldAtom","currentClusterAtom","currentTableAtom","surroundingTableDataAtom","afterCountAtom","afterTimeAtom","afterTimeFieldPageSizeAtom","beforeCountAtom","beforeTimeAtom","beforeTimeFieldPageSizeAtom","lastValueFrom","convertColumnToRow","formatTimestampToDateTime","generateTableDataUID","SurroundingLogs","currentTimeField","fields","setFields","currentCluster","surroundingTableData","setSurroundingTableData","beforeCount","setBeforeCount","afterCount","setAfterCount","beforeTimeFieldPageSize","setBeforeTimeFieldPageSize","afterTimeFieldPageSize","setAfterTimeFieldPageSize","beforeTime","setBeforeTime","afterTime","setAfterTime","updateState","active","getAfterResultWrap","_","newResult","getAfterSurroundingDataLoading","run","getAfterSurroundingData","getQueryParams","manual","onSuccess","rowsData","generateSurroundingResult","getBeforeSurroundingDataLoading","getBeforeSurroundingData","unshift","scrollToSelectedRow","selectedElement","document","getElementById","scrollIntoView","block","behavior","initLoading","prevTimeParams","afterTimeParams","Promise","all","refreshDeps","rowsData1","rowsData2","result1","result2","selectedResult","rowsDataWithUID","setTimeout","onError","_source","_uid","renderBeforeLoadingBar","renderAfterLoadingBar","processObject","hasOwnProperty","cleanValue","trim","parse","startsWith","parsed","cleanItem","processedData","subTableData","keys","tab","onChangeTab","idx","counter","tableRowStyle","pre","sortedResult","_sourceResult","itemSource","highlightValue","dynamicColumns","accessorKey","getCanExpand","getToggleExpandedHandler","createMarkup","__html","dangerouslySetInnerHTML","cursor","marginTop","position","setTimeFieldPageSize","overflow","Pagination","AntButton","usePluginContext","isValidTimeFieldType","DiscoverContent","fetchNextPage","_setTableData","setSelectedRow","_setPageSize","drawerOpen","setDrawerOpen","surroundingLogsOpen","setSurroundingLogsOpen","_fieldKeyBg","setFieldKeyBg","currentDatasource","context","jsonData","meta","logsConfig","logsTable","targetTraceTable","jumpPage","setJumpPage","isTargetLogTable","callback","openTraceDrawer","fieldInfo","num","Number","handleClick","link","closest","getAttribute","alignItems","gap","currentPage","numberOfPages","ceil","onNavigate","toPage","min","step","onKeyDown","total","floor","button","DiscoverHeaderSearch","DiscoverHeaderTimeSelect","CascaderStyle","currentIndexAtom","disabledOptionsAtom","searchTypeAtom","searchValueAtom","selectedIndexesAtom","MultiSelect","SearchType","searchType","setSearchType","disabledOptions","setSelectedIndexes","currentIndex","setCurrentIndex","searchMode","disabled","DropdownQueryType","actionMeta","selectedIndexes","selectedValue","marginRight","SQLSearch","onQuerying","native","nativeEvent","isComposing","Lucene","DataSourcePicker","timeFieldsAtom","searchFocusAtom","datasourcesAtom","databasesAtom","tablesAtom","getLatestTime","TimeRangeInput","getDatabases","getFieldsService","getIndexesService","getTablesService","toDataFrame","DiscoverHeader","setIndexes","setTableFields","timeFields","setTimeFields","_currentDate","searchFocus","activeItem","_setActiveItem","selectedDatasource","setSelectedDatasource","setCurrentTable","databases","setDatabases","tables","setTables","_datasources","fetchDatabases","ds","resp","frame","values","subscription","unsubscribe","getFields","selectedTable","fieldTypes","getIndexes","columnNames","indexesTypes","tableIndexes","columnName","noDefault","selectedDatabase","getTables","flex","selectdbTimeFiled","isReversed","start","toDate","end","latestTime","latestStartTime","latestEndTime","encodeSpecialTokens","decodeSpecialTokens","IMPLICIT_FIELD","CLICK_HOUSE_JSON_NUMBER_TYPES","RAW_FLAG","escapeString","escaped","formatDate","pad","padStart","year","getFullYear","month","getMonth","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","escapePrimitive","isRaw","escapeIdentifier","identifier","escapeValue","list","Boolean","__raw","SqlString","JSDataType","convertCHDataTypeToJSType","dataType","convertCHTypeToPrimitiveJSType","jsType","Error","splitAndTrimWithBracket","parenCount","squareCount","inSingleQuote","inDoubleQuote","cur","c","trimString","getColumn","getColumnMetadata","getInvertedIndexColumns","EnglishSerializer","translateField","eq","term","isNegatedField","isNotNull","gte","lte","lt","gt","fieldSearch","prefixWildcard","suffixWildcard","isPhrase","range","SQLSerializer","columnJSON","found","propertyType","supportsTextSearch","sourceColumn","getColumnForField","NOT_FOUND_QUERY","Bool","normTerm","parseInt","string","searchTarget","number","attemptToParseNumber","tokenizeTerm","termHasSeperators","isImplicitField","implicitTargets","usePhrasePrefix","matchTerm","clauses","boolValue","clause","orClause","wrapped","hasSeperators","tokens","token","CustomSchemaSQLSerializerV2","fetchColumnMetadata","columnMetadataCache","resolved","connectionId","databaseName","tableName","datasourceType","normalizedType","legacyMetadataProvider","legacy","legacyError","loadInvertedIndexColumns","invertedIndexColumns","invertedIndexColumnsPromise","columnHasInvertedIndex","buildColumnExpressionFromField","exactMatch","columnExpression","fieldPrefix","prefixMatch","fieldPostfix","valueType","columnExpressionJSON","nestedPaths","implicitColumnExpression","expressions","implicitFieldCandidates","acc","expression","extractFieldNamesFromExpression","candidate","candidateExpression","candidatePropertyType","candidateSupportsTextSearch","matches","metadata","lucene","nodeTerm","node","serializer","nodeTermInstance","prefix","quoted","substring","inclusive","rangedTerm","term_min","term_max","serialize","ast","binaryAST","parenthesized","leftOnlyAST","genWhereSQL","genEnglishExplanation","parsedQ","warn","SearchQueryBuilder","setSerializer","getSerializer","genSearchQuery","searchQ","and","condition","build","searchQuery","getWhereSQLViaLucene","trimmedQuery","whereSQL","useLuceneWhereClause","candidateFieldNames","rawName","test","implicitExpressions","discoverLoadingAtom","encodeBase64","getChartsData","convertColumnToRowViaFieldsType","generateHighlightedResults","getIndexesStatement","useDiscoverData","setTableData","setTableDataCharts","currentIndexes","setTopData","setTableTotalCount","buildLuceneWhereClause","getTableData","luceneWhere","resData","rowsDataWithUid","getTableDataCharts","autoInterval","timeIntervalValue","TT","chartsData","getTopData","getTableTopData","getTableDataCount","getTableCountData","totalCount","formattedData","clearData","refreshData","skipPageReset","handleQuerying","PluginPage","PageDiscover","pageNav","data-testid","section"],"sourceRoot":""}